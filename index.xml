<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>flx.cat</title>
<link>https://www.flx.cat/</link>
<atom:link href="https://www.flx.cat/index.xml" rel="self" type="application/rss+xml"/>
<description>El bloc de Fèlix</description>
<generator>quarto-1.6.43</generator>
<lastBuildDate>Wed, 31 Mar 2021 22:00:00 GMT</lastBuildDate>
<item>
  <title>Arguments i modificadors en shell-scripts</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2021-04-01-arguments-i-modificadors-en-shell-scripts/</link>
  <description><![CDATA[ 





<section id="requeriments" class="level2">
<h2 class="anchored" data-anchor-id="requeriments">Requeriments</h2>
<p>Un <strong>bon <em>shell-script</em></strong>, o si més no aquell que incorpori unes quantes variacions del seu objectiu original, haurà de presentar <strong>diversos <em>switch</em></strong> (modificadors).</p>
<p>Alguns d’aquests modificadors potser necessiten un <strong>valor o dada</strong> que els acompanyi (número de línies, color, longitud, ruta d’arxiu, etc.).</p>
<p>Fins i tot voldrem que els modificadors presentin diversos <strong>noms alternatius</strong>. Normalment una variant curta per als més comuns o utilitzats. Per exemple, si hem de definir un modificador de color, potser triarem el nom llarg <code>--color</code>, i per al cas curt una simple <code>-c</code> ja ens bastaria.</p>
<p>El <em>shell-script</em> <strong>potser també rebrà arguments convencionals</strong>, que no venen donats o emmarcats en un modificador, sinó que seran posicionals. Per exemple, si el programa sempre rep el nom d’un arxiu com a únic argument.</p>
</section>
<section id="cas-bàsic--h---help" class="level2">
<h2 class="anchored" data-anchor-id="cas-bàsic--h---help">Cas bàsic <code>-h</code>, <code>--help</code></h2>
<p>Evidentment la forma d’implementar aquest cas és simple, podríem mirar el valor del primer argument i comparar-lo manualment amb les cadenes corresponents a aquests modificadors. Si hi són, mostrem l’ajuda. Si no hi són, el programa no els ha rebut i podem executar la seva funció principal:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>example1.sh</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="example1.sh" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> showHelp()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb1-3">  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">PROGNAME</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">basename</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb1-4">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PROGNAME</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> [-h|--help]"</span></span>
<span id="cb1-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... echo more help text</span></span>
<span id="cb1-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-h"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">-o</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--help"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb1-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb1-10">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">showHelp</span></span>
<span id="cb1-11">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span> 0</span>
<span id="cb1-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rest of the script...</span></span></code></pre></div>
</div>
<p>Aquesta implementació la deixaria només per al cas en què:</p>
<ol type="1">
<li>El programa <strong>NO</strong> rep cap argument d’entrada (executa un procés fix, com un backup o una neteja d’arxius)</li>
<li>Només volem donar un <strong>ÚNIC</strong> modificador d’ajuda que ens “recordi” què fa el programa i què esperar d’ell</li>
</ol>
<p>I és que en el cas de diversos modificadors amb o sense dada, caldria programar un analitzador que comprovi els següents casos:</p>
<ul>
<li>Sense modificador: <code>programa</code></li>
<li>Amb modificador : <code>programa --color red</code></li>
<li>Amb modificador curt : <code>programa -c red</code></li>
<li>Amb el modificador mal escrit : <code>programa --color</code> o <code>programa -c</code></li>
<li>Amb el modificador d’ajuda: <code>programa -h</code> o <code>programa --help</code></li>
<li>Amb el modificador i un argument posicional: <code>programa -c red "Hello"</code></li>
<li>Només l’argument posicional: <code>programa "Hello"</code></li>
<li>…</li>
</ul>
<p>Com es pot veure les opcions es disparen, sense pensar en el cas que s’hagi intentat escriure un modificador inexistent, que existeixin diversos modificadors que es puguin donar en qualsevol ordre, etc… I tot només mirant <code>$1</code>, <code>$2</code>, … Una barbaritat!</p>
</section>
<section id="getopts-al-rescat" class="level2">
<h2 class="anchored" data-anchor-id="getopts-al-rescat"><code>getopts</code> al rescat!</h2>
<p>La <strong>utilitat <code>getopts</code></strong> normalment la trobarem com a <em>shell built-in</em>, és a dir, com a comanda integrada dins de la mateixa shell i no com a programa extern. Algunes implementacions de <em>shell</em> poden requerir que s’instal·li separadament, però ve integrada en la majoria de <em>shells</em> modernes.</p>
<p>Aquesta utilitat ens permet <strong>analitzar fàcilment</strong> els modificadors, quan aquests són d’un sol caràcter (modificadors curts), i normalment la trobem en blocs de codi com aquest:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>example2.sh</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="example2.sh" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> showHelp()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb2-3">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">PROGNAME</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">basename</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb2-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PROGNAME</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> [-h] [-v] [-c color]"</span></span>
<span id="cb2-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># echo more help</span></span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">COLOR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>transparent</span>
<span id="cb2-9"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">VERBOSITY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0</span>
<span id="cb2-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getopts</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hvc:"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">opt</span></span>
<span id="cb2-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span></span>
<span id="cb2-12">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">case</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$opt</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span></span>
<span id="cb2-13">    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">h</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>	<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">showHelp</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb2-14">    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">v</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">VERBOSITY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb2-15">    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">c</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>	<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">COLOR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$OPTARG</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb2-16">    <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>	<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">showHelp</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-17">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span> 2<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb2-18">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">esac</span></span>
<span id="cb2-19"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span></span>
<span id="cb2-20"></span>
<span id="cb2-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Verbosity level: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$VERBOSITY</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Requested color: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$COLOR</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-23"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">shift</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(($OPTIND</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb2-24"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Remaining arguments are: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$*</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-25"></span>
<span id="cb2-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here goes more code...</span></span></code></pre></div>
</div>
<p>Aquest programa tal i com està ara mateix ens permetrà executar-lo de les següents maneres:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1">programa -h</span>
<span id="cb3-2">programa -v</span>
<span id="cb3-3">programa -c red</span>
<span id="cb3-4">programa -c red image.png</span>
<span id="cb3-5">programa -v -c red image.png</span>
<span id="cb3-6">programa -vc red image.png</span></code></pre></div>
<p>És a dir, que ens acceptarà qualsevol de les combinacions habituals a què estem acostumats en programes i <em>scripts</em> de Linux, amb opcions curtes que podem escriure juntes (<code>-vc red</code> és equivalent a <code>-v -c red</code>). El programa mostrat també accepta arguments addicionals, que seran posicionals (<code>$1</code>, <code>$2</code>, …) i que seran la resta que quedi després de treure les opcions.</p>
<p><strong>Però com és que funciona així?</strong> Què són <code>OPTARG</code> i <code>OPTIND</code>? Què representa la línia del <code>while</code>? Analitzem com funciona:</p>
<ul>
<li><code>getopts</code> permet l’execució <code>while</code> tal i com es mostra, rebent dos arguments: una <strong>cadena</strong> que especifica les opcions curtes que volem analitzar i el <strong>nom d’una variable</strong> de <em>shell</em> que és on es guardarà l’opció “descoberta”.</li>
<li>En <strong>cada iteració del <code>while</code></strong> la variable <code>opt</code> (el nom es podria canviar si es desitgés) valdrà un dels modificadors passats per l’usuari al programa, per això hem fet un <code>case</code> per analitzar quin dels modificadors és i fer l’acció que correspongui.</li>
<li>El <strong>primer argument</strong> de <code>getopts</code> conté els <strong>modificadors permesos</strong>, tots seguits. Com que volem els modificadors <code>-h</code>, <code>-v</code> i <code>-c</code>, els indiquem seguits. El <strong>signe de <code>:</code></strong> indica que el modificador anterior (en aquest cas la <code>c</code>) rebrà un argument. Això vol dir que podríem haver escrit la cadena de modificadors com s’ha fet (<code>hvc:</code>) o en un altre ordre (<code>c:hv</code>, <code>hc:v</code> o <code>vc:h</code>, per exemple). L’important és que el dos punts sempre segueixi la <code>c</code>, per indicar que aquest modificador requereix d’un argument.</li>
<li>Quan un modificador té argument (indicat pel signe <code>:</code> en la cadena de modificadors de <code>getopts</code>), disposarem d’aquest argument en la variable d’entorn <strong><code>OPTARGS</code></strong>. Per això veieu que s’extreu el color mitjançant aquesta variable. <code>getopts</code> s’encarrega de gestionar-la.</li>
<li>L’altra variable que <code>getopts</code> gestiona per nosaltres és <strong><code>OPTIND</code></strong>, que és un índex que apunta al següent argument passat al programa que s’haurà d’analitzar. Així podem saber en quin punt exacte de la llista d’arguments està analitzant en tot moment.</li>
<li>Usem <strong><code>OPTIND</code></strong> per “saltar” fins a ell i eliminar així tots els modificadors i valors indicats i quedar-nos amb la resta d’arguments del programa, que correspondran als arguments posicionals clàssics (el nom de l’arxiu a processar, el directori on fer l’operació, la cadena de text a tractar, etc.).</li>
</ul>
</section>
<section id="i-què-passa-amb-les-opcions-llargues" class="level1">
<h1>I què passa amb les opcions llargues?</h1>
<p>La utilitat <code>getopts</code> malauradament no és capaç de gestionar modificadors llargs. Però podem fer un “<strong>truc</strong>” bastant interessant, tot i que ens fa més llarga l’escriptura del <em>shell script</em>. Ho veurem amb el mateix exemple ara ampliat:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>example3.sh</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="example3.sh" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> showHelp()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb4-3">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">PROGNAME</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">basename</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb4-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Usage: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PROGNAME</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> [-h|--help] [-v|--verbose] [-c|--color color]"</span></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ...</span></span>
<span id="cb4-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb4-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">COLOR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>transparent</span>
<span id="cb4-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">VERBOSITY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0</span>
<span id="cb4-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getopts</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hvc:-:"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">opt</span></span>
<span id="cb4-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span></span>
<span id="cb4-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">case</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$opt</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span></span>
<span id="cb4-12">    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">-</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">case</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${OPTARG}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span></span>
<span id="cb4-13">          <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">help</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">showHelp</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-14">          <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">verbose</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">VERBOSITY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-15">          <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">color</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>      </span>
<span id="cb4-16">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">COLOR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">OPTIND}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb4-17">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">OPTIND</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$((</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$OPTIND</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">))</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-18"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb4-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unknown option '--</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${OPTARG}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-1</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">esac;;</span></span>
<span id="cb4-22">    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">h</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>	<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">showHelp</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-23">    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">v</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>  <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">VERBOSITY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-24">    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">c</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>	<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">COLOR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$OPTARG</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-25"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>	<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unknown option '-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$opt</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-26"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-1</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span></span>
<span id="cb4-27"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">esac</span></span>
<span id="cb4-28"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span></span>
<span id="cb4-29"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Verbosity level: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$VERBOSITY</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb4-30"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Requested color: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$COLOR</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb4-31"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">shift</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(($OPTIND</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb4-32"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Remaining arguments are: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$*</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb4-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ...</span></span></code></pre></div>
</div>
<p>Ara el programa podrà executar-se amb totes les formes i variants (combinades o no):</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1">programa --help</span>
<span id="cb5-2">programa --verbose --color blue image.png</span>
<span id="cb5-3">programa -v --color blue image.png</span></code></pre></div>
<p>Dependrà de com vulguem que el programa estigui definit que farem una combinació o altra dels <code>case</code> tant per a la part de modificadors “llargs” com a la part de modificadors “curts”. Dit d’una altra manera: ningú ens obliga a implementar els modificadors en els dos modes. Podem crear modificadors només curts, modificadors només llargs i modificadors que tinguin les dues variants. Tot dependrà de nosaltres.</p>
<p>Observi’s que ara s’utilitza <code>OPTARG</code> per a analitzar les opcions llargues, perquè quan escrivim <code>--color</code> en realitat ho processarà com un modificador curt <code>--</code> que ha rebut com a argument la cadena <code>color</code>. De la mateixa manera, usem <code>OPTIND</code> per treure la dada subministrada després a través de la indexació <code>${!OPTIND}</code> com a argument del modificador, i incrementem aquest comptador per saltar l’argument ja capturat.</p>
<p>Veiem doncs una manera bastant senzilla de crear <em>shell scripts</em> que compleixin amb un <strong>mínim estàndard de qualitat</strong> en la forma en què donem opcions i variacions a l’usuari, apropant els nostres <em>scripts</em> una mica al que s’esperaria d’un programa de <em>shell</em> mínimament professional.</p>
<p>Ara ja sabeu com fer correctament l’estructuració d’un <em>shell script</em> de qualitat… però encara us quedarà donar sentit al programa i fer la funcionalitat original que teniu pensada!</p>


</section>

 ]]></description>
  <category>Linux</category>
  <category>featured</category>
  <category>Linux</category>
  <category>shell</category>
  <category>script</category>
  <guid>https://www.flx.cat/posts/2021-04-01-arguments-i-modificadors-en-shell-scripts/</guid>
  <pubDate>Wed, 31 Mar 2021 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2021-04-01-arguments-i-modificadors-en-shell-scripts/images/featured.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>Bucles en un sed</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-12-04-bucles-en-el-sed/</link>
  <description><![CDATA[ 





<section id="cas-dús" class="level2">
<h2 class="anchored" data-anchor-id="cas-dús">Cas d’ús</h2>
<p>Parlant amb un company, em presenta la següent situació:</p>
<blockquote class="blockquote">
<p>Tenim un nombre a l’estil <code>12345678.12</code> i volem que ens insereixi els grups de milers (amb un caràcter de coma) cada tres dígits segons la notació habitual. Requeriment: s’ha de fer amb línia d’ordres i amb l’ordre <code>sed</code>. {: .quotation }</p>
</blockquote>
<p>El problema és que, ho pensi com ho pensi, no trobo la manera de codificar-ho en una única sentència de <code>sed</code> sense fer bucles.</p>
<p>Fer la incorporació de l’últim punt de milers és fàcil. Només cal buscar un bloc de 4 dígits numèrics consecutius abans d’un punt de decimal o milers, i inserir la coma de milers entre el primer i el segon. Quelcom això:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1234567890.12"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-E</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s/([0-9])([0-9]{3,3}[.,])/\1,\2/g'</span></span></code></pre></div>
<p>El resultat obtingut és <code>1234567,890.12</code>.</p>
<p>Però per poder fer la conversió de tota la cadena s’hauria d’implantar un bucle que executi aquest procés mentre quedin blocs de 4 dígits seguits… Lleig!</p>
<p>La solució l’he trobada descobrint que <strong><code>sed</code> accepta un pseudo-llenguatge de programació</strong> que inclou <strong>bucles</strong> en l’expressió a executar!!!</p>
<p>El format d’un bucle és així:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1">: etiqueta</span>
<span id="cb2-2">/condició/ {</span>
<span id="cb2-3">    ordre</span>
<span id="cb2-4">    ordre</span>
<span id="cb2-5">    ...</span>
<span id="cb2-6">    b etiqueta</span>
<span id="cb2-7">}</span></code></pre></div>
<p>La directiva <code>b</code> és la que força que es torni a l’etiqueta inicial, fent un bucle on es valida la condició indicada.</p>
<p>En el cas presentat, la condició és que quedin blocs de 4 dígits seguits. Per tant, la solució a aquest repte és la següent:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1234567890.12"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-E</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb3-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    :loop</span></span>
<span id="cb3-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    /[0-9]{4,4}/ {</span></span>
<span id="cb3-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        s/([0-9])([0-9]{3,3}[.,])/\1,\2/g</span></span>
<span id="cb3-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        b loop</span></span>
<span id="cb3-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb3-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span></code></pre></div>
<p>El resultat és ara el desitjat: <code>1,234,567,890.12</code>.</p>
<p><strong>Repte resolt!</strong></p>
<p>Fonts d’informació addicionals:</p>
<ul>
<li><a href="http://tech.bluesmoon.info/2008/09/programming-patterns-in-sed.html"><em>Programming patterns in sed</em></a></li>
<li><a href="http://www.gnu.org/software/sed/manual/sed.html">Manual en línia de <em>sed</em></a></li>
</ul>


</section>

 ]]></description>
  <category>Linux</category>
  <category>featured</category>
  <category>sed</category>
  <category>Linux</category>
  <guid>https://www.flx.cat/posts/2013-12-04-bucles-en-el-sed/</guid>
  <pubDate>Tue, 03 Dec 2013 23:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-12-04-bucles-en-el-sed/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Guia ràpida de Git</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-11-11-guia-rapida-git/</link>
  <description><![CDATA[ 





<p>Git és una aplicació extraordinària per mantenir el control de versions d’un projecte de desenvolupament. Permet tant el control de versions local com remot, permetent de pas el treball col·laboratiu entre diferents programadors en un mateix projecte. En aquest <em>post</em> intento resumir les funcionalitats bàsiques de Git a través d’uns exemples clars i entenidors dels diferents casos d’ús més habituals.</p>
<section id="ús-bàsic" class="level2">
<h2 class="anchored" data-anchor-id="ús-bàsic">Ús bàsic</h2>
<ol type="1">
<li><p>Construïm un projecte de prova amb alguns arxius:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> testgit/proj</span>
<span id="cb1-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> testgit/proj                             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Com si fos un projecte...</span></span>
<span id="cb1-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hola"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> README.txt                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... amb alguns arxius</span></span>
<span id="cb1-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Altre"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> altre.txt</span>
<span id="cb1-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"// Arxiu de codi font"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Classe.java</span></code></pre></div></li>
<li><p>Consultem la informació que disposa Git sobre nosaltres:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--list</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config user.name                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Només aquesta dada</span></span></code></pre></div>
<p>Podem canviar els paràmetres que volguem:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.name <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linus Torvalds"</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.email linus.torvalds@cesf.es</span></code></pre></div></li>
<li><p>Quan necessitem ajuda sobre qualsevol ordre de Git, podem invocar-la a través de l’ajuda:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> help config</span></code></pre></div></li>
<li><p>Ara afegim la gestió de projectes amb Git:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> init</span></code></pre></div>
<p>Apareix un directori ocult amb nom <code>.git</code> en el directori del projecte.</p></li>
<li><p>Ara podem afegir els arxius que hem creat a la gestió de projectes. Aquest procés s’anomena <strong><em>staging</em></strong>:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add README.txt</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>.java</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .                               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afegeix directori i subdirectoris</span></span></code></pre></div></li>
<li><p>Ara comprovem els arxius pendents de ser gestionats:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span>
<span id="cb7-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"// Segon arxiu font"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Classe.java</span>
<span id="cb7-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Més text"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README.txt </span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status                              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Marca els canvis no gestionats</span></span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span></code></pre></div></li>
<li><p>Un cop afegits els arxius desitjats, ja podem enviar (<strong><em>commit</em></strong>) els canvis disposats per ser processats:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Primera salvaguarda"</span></span></code></pre></div>
<p>Ara aquests canvis han estat processats i el sistema els ha desat. El projecte ara passa a un estat “net”, perquè tots els arxius estan igual que al dipòsit:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span></code></pre></div></li>
<li><p>Podem treballar amb la gestió de tot un directori encara que no volguem que tots els arxius siguin gestionats per Git. Això es pot aconseguir mantenint un arxiu anomenat <code>.gitignore</code> a l’arrel del projecte:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aaa"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Main.class             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Com si s'hagués compilat </span></span>
<span id="cb10-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bbb"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Classe.class           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Com si s'hagués compilat</span></span>
<span id="cb10-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Més text"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README.txt</span>
<span id="cb10-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Surten aquests arxius</span></span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.[oa]"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> .gitignore</span>
<span id="cb10-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*~"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> .gitignore</span>
<span id="cb10-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.class"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> .gitignore</span>
<span id="cb10-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Surt el .gitignore però no els compilats</span></span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .                           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Acceptem tots els canvis i els gestionem</span></span>
<span id="cb10-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span></code></pre></div></li>
<li><p>Podem veure els canvis pendents de ser processats:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> diff <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--staged</span></span></code></pre></div></li>
<li><p>Un cop afegits els arxius desitjats, ja podem enviar (<strong><em>commit</em></strong>) els canvis disposats per ser processats:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Segona salvaguarda: </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div></li>
<li><p>Es poden gestionar els arxius presents al dipòsit Git mitjançant les ordres <code>git rm</code> i <code>git mv</code>:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> rm altre.txt</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> rm <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\*</span>~</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> mv README.txt README</span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span>
<span id="cb13-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tercera: </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -a equival a fer "git add ." abans</span></span></code></pre></div></li>
<li><p>Podem veure l’històric de canvis:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log</span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-2</span></span>
<span id="cb14-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--stat</span></span>
<span id="cb14-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--pretty</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>format:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%h - %an, %ar : %s"</span></span>
<span id="cb14-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--pretty</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>format:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%h %s"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--graph</span></span></code></pre></div></li>
<li><p>Podem controlar els arxius que estan en <em>staging</em> (procés <strong><em>unstaging</em></strong>):</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arxiu auxiliar"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> doc.txt</span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .                               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stage de tot el directori</span></span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span>
<span id="cb15-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> reset HEAD doc.txt                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Treure'l del "staged area" (Unstaging)</span></span>
<span id="cb15-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span>
<span id="cb15-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> doc.txt</span></code></pre></div></li>
<li><p>També podem anular canvis d’un arxiu:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tercera línia"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README</span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--</span> README                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Desfer edició abans del "staging"</span></span>
<span id="cb16-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> README</span>
<span id="cb16-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span></code></pre></div></li>
<li><p>Log bonic:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">alias</span> gl=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git log --graph --abbrev-commit --decorate --date=relative </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb17-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">--format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb17-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">%C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)' </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb17-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">--all"</span></span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span></span></code></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2013-11-11-guia-rapida-git/images/git_log_bonic.png" class="img-fluid figure-img"></p>
<figcaption>Captura d’una sortida de l’àlies gl</figcaption>
</figure>
</div></li>
</ol>
</section>
<section id="diverses-línies-de-desenvolupament" class="level2">
<h2 class="anchored" data-anchor-id="diverses-línies-de-desenvolupament">Diverses línies de desenvolupament</h2>
<p>El desenvolupador principal pot voler generar una branca del projecte on provar alguna tècnica nova.</p>
<ol type="1">
<li><p>Generar una nova branca i activar-la:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> branch prova1                       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Definim la branca, però no l'activem</span></span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout prova1                     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Canviem a aquesta branca</span></span></code></pre></div></li>
<li><p>Fem canvis i mostrem canvis al resum:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> actual.txt</span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb19-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb19-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--pretty</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>format:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%h %s"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--graph</span></span></code></pre></div></li>
<li><p>Si ho mirem des de la branca principal:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout master</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--pretty</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>format:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%h %s"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--graph</span></span></code></pre></div>
<p>Veurem que el darrer canvi no apareix. En aquesta branca no consta el canvi.</p></li>
<li><p>Ara el projecte principal evoluciona:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arxiu"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> nouarxiu.txt             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># L'últim checkout ens ha tornat a "master"</span></span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div></li>
<li><p>Podem veure tot el flux de canvis entre les diferents branques amb modificadors de <code>git log</code>:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--graph</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--oneline</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--all</span></span>
<span id="cb22-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span></span></code></pre></div></li>
<li><p>Si els canvis són compatibles (no hi ha conflictes), les branques poden ser reunificades quan es vulgui:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> merge prova1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reunificació amb branca prova1"</span></span></code></pre></div></li>
<li><p>Ara generarem una situació de conflicte:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> branch prova2</span>
<span id="cb24-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Línia en master"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README</span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb24-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout prova2</span>
<span id="cb24-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Línia en prova2"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README</span>
<span id="cb24-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb24-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout master</span>
<span id="cb24-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> merge prova2 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reunificació amb branca prova2"</span></span></code></pre></div>
<p>L’arxiu README quedarà modificat. Haurem d’editar-lo manualment i definir quina versió de les mostrades és l’acceptada. Un cop editat l’arxiu amb conflicte, s’afegirà al <em>staging</em> i es farà el <em>commit</em> per acceptar-lo a la branca unificada:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add README</span>
<span id="cb25-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reunificació amb branca prova2"</span></span>
<span id="cb25-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span></span></code></pre></div></li>
<li><p>Les branques poden eliminar-se si es desitja. Per fer-ho han d’haver sofert un procés de <code>merge</code> amb la seva branca mare o ens avisarà del fet:</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout master                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tornem a la branca master</span></span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> branch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> prova1                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cap problema</span></span>
<span id="cb26-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> branch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> prova2                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># se'ns queixarà</span></span>
<span id="cb26-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> branch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> prova2                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fem l'eliminació forçada</span></span></code></pre></div></li>
</ol>
</section>
<section id="restauració-darxius" class="level2">
<h2 class="anchored" data-anchor-id="restauració-darxius">Restauració d’arxius</h2>
<p>Si sabem que un determinat arxiu ha estat modificat en algun moment i que hem perdut alguns blocs de codi interessants accidentalment o per descuit, sempre podrem restaurar-lo a aquell estat.</p>
<ol type="1">
<li><p>Generem una situació en què necessitem fer aquesta operació de restauració.</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout prova2</span>
<span id="cb27-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Contingut interessant..."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> nou.txt</span>
<span id="cb27-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb27-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nou arxiu afegit"</span></span>
<span id="cb27-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Contingut perdut!"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> nou.txt</span>
<span id="cb27-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb27-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arxiu malbaratat"</span></span></code></pre></div>
<p>La segona versió de l’arxiu substitueix el contingut que s’havia afegit a la primera versió. Aquí tenim el punt en què necessitem restaurar a la primera versió.</p></li>
<li><p>Per poder restaurar l’arxiu necessitem saber en quin <strong><em>commit</em></strong> de quina <strong>branca</strong> es trobava aquell arxiu. Això ho podem descobrir combinant <code>git log</code> i <code>git diff</code>:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> git log</span>
<span id="cb28-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> ce10391 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">17</span> seconds ago<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">malament</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Fèlix Galindo Allué <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HEAD,</span> prova2<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb28-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> 93c2987 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">36</span> seconds ago<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bo</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Fèlix Galindo Allué</span>
<span id="cb28-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> 616ab1b <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3</span> days ago<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nou</span> arxiu <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Fèlix Galindo Allué <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">prova1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb28-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> 601416b <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4</span> days ago<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dijous,</span>  7 de novembre de 2013, 17:44:37 CET <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Fèlix Ga</span>
<span id="cb28-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> 2026f1d <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4</span> days ago<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dijous,</span>  7 de novembre de 2013, 17:34:52 CET <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Fèlix Ga</span>
<span id="cb28-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> a99796e <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4</span> days ago<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Primera</span> salvaguarda <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Fèlix Galindo Allué</span>
<span id="cb28-8"></span>
<span id="cb28-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> git diff 93c2987</span>
<span id="cb28-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--git</span> a/nou.txt b/nou.txt</span>
<span id="cb28-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">index</span> 6c3a082..25a7eab 100644</span>
<span id="cb28-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---</span> a/nou.txt</span>
<span id="cb28-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++</span> b/nou.txt</span>
<span id="cb28-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@@</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-1</span> +1 @@</span>
<span id="cb28-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-bo</span></span>
<span id="cb28-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+malament</span></span></code></pre></div>
<p>Com veiem, en el <em>commit</em> identificat com a <code>93c2987</code> teníem la pèrdua de línies de l’arxiu. Volem restaurar fins a aquella versió d’aquell arxiu.</p></li>
<li><p>Ara podem restaurar l’arxiu fent ús de <code>git checkout</code>:</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout 93c2987 nou.txt</span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">more</span> nou.txt                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># veurem la versió bona (antiga)</span></span></code></pre></div>
<p>L’arxiu ha estat restaurat a aquell estat. Si volem fixar-lo haurem de fer un nou <em>commit</em>, perquè ara com ara és com si l’haguéssim editat manualment:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ens dirà que hi ha canvis pendents</span></span></code></pre></div>
<p>Si al final no volem desar-lo d’aquella manera i volem tornar a la darrera versió desada, simplement farem:</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> checkout HEAD nou.txt</span>
<span id="cb31-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">more</span> nou.txt                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># veurem la versió dolenta (última)</span></span>
<span id="cb31-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ens dirà que res ha canviat</span></span></code></pre></div></li>
</ol>
</section>
<section id="entorn-de-diversos-desenvolupadors" class="level2">
<h2 class="anchored" data-anchor-id="entorn-de-diversos-desenvolupadors">Entorn de diversos desenvolupadors</h2>
<p>El control de versions de Git vist fins ara és el corresponent a projectes locals (aquells que són realitzats en un sol directori d’una única màquina).</p>
<p>Hem de considerar dues situacions comunes:</p>
<ul>
<li><p>Potser volem que un projecte pugui evolucionar incorporant nous desenvolupadors que desenvolupin mòduls o variants del <em>software</em> independentment i incorporar els seus canvis segons uns objectius o validant les seves característiques afegides al projecte original.</p></li>
<li><p>De vegades, potser un sol desenvolupador pot estar desenvolupant el seu únic projecte en diferents màquines (ordinador fix - ordinador portàtil - ordinador de la feina).</p></li>
</ul>
<p>Tots dos casos ens obliguen a disposar d’un control de versions <strong>remot</strong>, és a dir, que puguem bolcar els nostres canvis a un lloc comú i disponible des de diversos equips i/o ubicacions. Això també és permès amb Git.</p>
<p>Les ubicacions disponibles per al <strong><em>remote</em></strong> del nostre projecte pot prendre diferents formes segons el cas:</p>
<ul>
<li>Un servidor especialitzat amb servei SSH i usuaris definits per a què hi puguin accedir,</li>
<li>Un servidor especialitzat públic, com GitHub o Gitlab, que ofereix servei d’hostatge de projectes públic i/o privats,</li>
<li>Un directori compartit en xarxa, muntat en els diferents equips dels diferents desenvolupadors com a unitat de xarxa,</li>
<li>Un directori vinculat a algun servei d’emmagatzematge en el núvol, com Dropbox o Google Drive.</li>
</ul>
<p>En tots els casos disposarem d’una ruta o camí que indicarà la ubicació del projecte. Serà mitjançant aquesta ruta que el projecte podrà ser duplicat en altres equips per altres desenvolupadors.</p>
<p>Exemples de rutes de projecte:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Tipus</th>
<th style="text-align: left;">Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Gitlab (via HTTPS)</td>
<td style="text-align: left;">https://gitlab.com/felix.galindo/jekyll-liquid-latex-plugin.git</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gitlab (via SSH)</td>
<td style="text-align: left;">git@gitlab.com:felix.galindo/jekyll-liquid-latex-plugin.git</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Servidor SSH privat</td>
<td style="text-align: left;">user:pass@servidor.com:/projectes/projecte.git</td>
</tr>
<tr class="even">
<td style="text-align: left;">Directori local</td>
<td style="text-align: left;">/projectes/projecte.git</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Directori Dropbox</td>
<td style="text-align: left;">~/Dropbox/projectes/project.git</td>
</tr>
</tbody>
</table>
<p>Suposarem ara un projecte ubicat a un directori local privat d’un usuari com a mostra per entendre la funcionalitat bàsica dels <strong><em>remote</em></strong>.</p>
<ol type="1">
<li><p>Creem un projecte buit en el lloc on volem dipositar-lo (<em>remote</em>):</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> ~/Dropbox/remotes</span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> init <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--bare</span> ~/Dropbox/remotes/projecte.git</span>
<span id="cb32-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span> ~/Dropbox/remotes/projecte.git</span></code></pre></div>
<p>Veurem tota una estructura de directoris que allotjaran la versió remota del nostre projecte.</p></li>
<li><p>Ara crearem la versió local on editarem el projecte:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ~/testgit</span>
<span id="cb33-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone ~/Dropbox/remotes/projecte.git</span>
<span id="cb33-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span></span>
<span id="cb33-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> projecte</span>
<span id="cb33-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-la</span>                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Veurem el directori .git habitual</span></span></code></pre></div></li>
<li><p>El projecte queda vinculat al <em>remote</em> origen, de manera que les variables corresponents prenen els valors adients:</p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--list</span>       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Veurem remote.origin.url, per exemple</span></span></code></pre></div>
<p>També existeix l’ordre <code>git remote</code> per controlar les variables remotes. Podem utilitzar-lo per llistar els valors actuals:</p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> remote <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb35-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> remote show origin</span></code></pre></div></li>
<li><p>Ara ja podem començar a treballar en el nostre projecte:</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Documentació"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> README.md</span>
<span id="cb36-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> src</span>
<span id="cb36-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"// Arxiu font"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> src/Main.java</span>
<span id="cb36-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb36-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Commit inicial"</span></span>
<span id="cb36-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span>                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Veurem el nostre commit</span></span></code></pre></div></li>
<li><p>Quan hem acabat d’editar localment, podem “pujar” els canvis al servidor remot amb una operació <strong>push</strong>:</p>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push origin master</span></code></pre></div>
<p>Amb <code>origin</code> indiquem que el <em>push</em> s’ha d’efectuar contra el projecte origen de la clonació, mentre que amb <code>master</code> indiquem que ho faci a la branca principal del projecte. Això és obligatori només la primera vegada que es fa el <em>push</em>. Les següents ho recorda si no ho canviem passant els arguments a <code>git push</code>:</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Millorat"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README.md </span>
<span id="cb38-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb38-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Millores en docs"</span> </span>
<span id="cb38-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push</span></code></pre></div></li>
<li><p>Suposem ara que un segon desenvolupador vol o ha de participar en el projecte de <em>software</em>. Per la seva banda, realitzarà unes tasques similars a les anteriorment descrites:</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.name <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jordi Galindo López"</span></span>
<span id="cb39-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.email <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jordi@flx.cat"</span></span>
<span id="cb39-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ~/testgit</span>
<span id="cb39-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone ~/Dropbox/remotes/projecte.git jordi</span>
<span id="cb39-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> jordi</span>
<span id="cb39-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span></span></code></pre></div>
<p>Ara aquest desenvolupador farà canvis:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hola"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> jordi.txt</span>
<span id="cb40-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb40-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Afegit jordi.txt"</span></span>
<span id="cb40-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push origin master</span>
<span id="cb40-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span></span></code></pre></div></li>
<li><p>El procés d’edició i millora del software pot continuar indefinidament per ambdues bandes. El problema és quan s’intenta fer un <em>push</em> abans d’adquirir els canvis fets per l’altre(s) usuari(s) involucrat al projecte:</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ../projecte</span>
<span id="cb41-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.name <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linus Torvalds"</span></span>
<span id="cb41-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--global</span> user.email <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linus.torvalds@cesf.es"</span></span>
<span id="cb41-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Més documentació"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README.md</span>
<span id="cb41-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb41-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Documentació millorada"</span></span>
<span id="cb41-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GENERARÀ UN ERROR</span></span></code></pre></div>
<p>El primer desenvolupador ha intentat fer un <em>push</em> quan encara no ha descarregat els darrers canvis fets pel segon desenvolupador (que també havia fet un <em>push</em>). En aquests casos, el desenvolupador que intenti fer el segon <em>push</em> ha de descarregar els canvis fets per l’altre primer, amb una operació <strong><em>pull</em></strong>:</p>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> pull            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ens farà editar un missatge específic</span></span>
<span id="cb42-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ARA SÍ FUNCIONARÀ</span></span>
<span id="cb42-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span>                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Veuràs la unió com si fos un "merge"</span></span></code></pre></div>
<p>Podem utilitzar <code>git pull --no-edit</code> per a què faci servir un missatge preconfigurat del tipus “Merge branch … of …”.</p></li>
</ol>
<p>Existeix l’ordre <code>git fetch</code>, que fa el mateix que <code>git pull</code>, però no té en compte les branques del projecte. Normalment es fa servir <code>git pull</code> per ser més potent que l’altra.</p>
</section>
<section id="tags" class="level2">
<h2 class="anchored" data-anchor-id="tags">Tags</h2>
<p>Suposem que el nostre projecte ha arribat a un punt clau del seu desenvolupament. Diguem-ne que tenim una “<strong>versió</strong>” completada o que el punt on estem és un punt important a on potser voldrem tornar més endavant.</p>
<p>En aquests casos podem fer ús dels <strong><em>tags</em></strong> per realitzar etiquetes sobre determinats <strong><em>commits</em></strong> que ens siguin especialment destacables.</p>
<ol type="1">
<li><p>Suposem que continuem en el projecte de <em>software</em> anterior i crearem un <em>tag</em>:</p>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ~/testgit/projecte</span>
<span id="cb43-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span></span>
<span id="cb43-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> tag <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> v1.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Versió 1.0"</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Creem el tag</span></span>
<span id="cb43-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span></span></code></pre></div>
<p>En el <em>log</em> hem d’observar la presència de la forma abreujada <code>v1.0</code> tal i com si fos el nom d’una branca.</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"més edició"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README.md</span>
<span id="cb44-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb44-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"millores"</span></span>
<span id="cb44-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gl</span>                                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Veurem el tag en l'històric</span></span></code></pre></div></li>
<li><p>Podem extreure informació de la versió indicada pel <em>tag</em> fent:</p>
<div class="sourceCode" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> show v1.0</span></code></pre></div></li>
<li><p>Suposem que continuem editant i creant versions:</p>
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> tag <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span> v1.1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Versió 1.1"</span></span>
<span id="cb46-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Més encara"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> README.md </span>
<span id="cb46-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> add .</span>
<span id="cb46-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"més millores"</span></span></code></pre></div></li>
<li><p>En aquest moment ens interessaria veure la llista de <em>tags</em> del nostre projecte:</p>
<div class="sourceCode" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> tag</span></code></pre></div></li>
<li><p>Els <em>tags</em> no són pujats de manera automàtica en fer <em>push</em>. Podem indicar si volem pujar la definició d’un <em>tag</em> afegint el seu nom:</p>
<div class="sourceCode" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push origin v1.1</span></code></pre></div>
<p>O també podem indicar que es pugin tots els <em>tags</em> definits localment:</p>
<div class="sourceCode" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--tags</span></span></code></pre></div></li>
<li><p>És possible que un determinat desenvolupador pugui clonar un projecte concret en l’estat que es trobava en un cert <em>tag</em>. Per fer-ho es farà servir la mateixa notació que si es tractés d’una selecció de branca:</p>
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ~/testgit</span>
<span id="cb50-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone ~/Dropbox/remotes/projecte.git <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> v1.0 projecte_v1.0</span></code></pre></div>
<p>En realitat, això equival a clonar el projecte complet i canviar a la posició del <em>tag</em> indicat mitjançant una operació <code>git checkout</code>.</p></li>
</ol>
</section>
<section id="githubgitlab" class="level2">
<h2 class="anchored" data-anchor-id="githubgitlab">GitHub/Gitlab</h2>
<p>GitHub i Gitlab ens ofereixen la possibilitat d’allotjar projectes de desenvolupament tot definint els nostres <strong><em>remotes</em></strong> en el seu servidor.</p>
<p>Segons el tipus de compte que creem, podrem disposar de projectes públics (versió gratuïta) o privats (versió de pagament).</p>
<p>La diferència principal respecte a tot el que s’ha vist fins ara és que el procés de <strong>push</strong> i <strong>pull</strong> es realitza sobre un únic <em>remote</em>.</p>
<p>Si un desenvolupador vol clonar el projecte de manera pública, podrà fer-ho amb el procés que anomenarem “<strong>fork</strong>”. El procés de <em>fork</em> crearà un projecte nou, clonació del projecte original, on el desenvolupador disposarà de tota la infraestructura per evolucionar el seu clon del projecte original. Es perdrà el seguiment del projecte original, però el desenvolupament serà possible.</p>
<p>Quan aquest desenvolupador vulgui comunicar els canvis que ha fet sobre el projecte original al desenvolupador del projecte principal, ho farà mitjançant una operació de “<strong>pull request</strong>”, en què el desenvolupador original verificarà els canvis fets i validarà si vol o no adquirir-los.</p>
<p>Si el desenvolupador original accepta les modificacions, els canvis seran afegits al projecte original igual que si es tractés d’un <em>merge</em> convencional. El projecte original haurà crescut en complexitat i podrà continuar sent desenvolupat com a <em>línia principal i original</em> del projecte.</p>
</section>
<section id="referències-externes" class="level2">
<h2 class="anchored" data-anchor-id="referències-externes">Referències externes</h2>
<ul>
<li>Lloc oficial de Git: <a href="http://git-scm.com/doc"><code>http://git-scm.com/doc</code></a></li>
<li>Referència ràpida: <a href="http://gitref.org/"><code>http://gitref.org/</code></a></li>
<li>Lloc de GitHub: <a href="https://github.com/"><code>https://github.com/</code></a></li>
<li>Lloc de Gitlab: <a href="https://gitlab.com/"><code>https://gitlab.com/</code></a></li>
</ul>


</section>

 ]]></description>
  <category>desenvolupament</category>
  <category>featured</category>
  <category>git</category>
  <category>github</category>
  <category>gitlab</category>
  <guid>https://www.flx.cat/posts/2013-11-11-guia-rapida-git/</guid>
  <pubDate>Sun, 10 Nov 2013 23:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-11-11-guia-rapida-git/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Liquid-LaTeX Jekyll Plugin</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-11-10-liquid-latex-jekyll-plugin/</link>
  <description><![CDATA[ 





<p>I’ve just finished my second Jekyll plugin: the <strong>jekyll-liquid-latex-plugin</strong>. This plugin for the Jekyll blogging software extends the rendering system allowing you to render <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> pieces of code inside your post. The result will be an image placed instead of the block of <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> code, so you don’t need to access any other software tool to compile <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> inside your posts.</p>
<section id="the-plugin" class="level2">
<h2 class="anchored" data-anchor-id="the-plugin">The plugin</h2>
<p>You can access it’s source code, clone it and/or use it from Gitlab: <a href="https://gitlab.com/felix.galindo/jekyll-liquid-latex-plugin">https://gitlab.com/felix.galindo/jekyll-liquid-latex-plugin</a></p>
<p>This plugin is able to render <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> block code as if you have a complete <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> document. Instead of a full DVI, EPS, or PDF file, this plugin renders the <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> block to PNG and inserts an <code>&lt;img&gt;</code> tag instead.</p>
<p>This, simply put, allows you to write this inside any of your posts:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb1-1">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% latex %}</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\begin</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">eqnarray*</span>}</span>
<span id="cb1-3"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">(A</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cup</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> B)-(C-A) &amp;=&amp; (A</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cup</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> B) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cap</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (C-A)^c</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span></span>
<span id="cb1-4"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&amp;=&amp; (A</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cup</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> B) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cap</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (C </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cap</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> A^c)^c </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span></span>
<span id="cb1-5"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&amp;=&amp; (A</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cup</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> B) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cap</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (C^c </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cup</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> A) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span></span>
<span id="cb1-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&amp;=&amp; A </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cup</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (B</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cap</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> C^c) </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span></span>
<span id="cb1-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&amp;=&amp; A </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\cup</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (B-C)</span></span>
<span id="cb1-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\end</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">eqnarray*</span>}</span>
<span id="cb1-9">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% endlatex %}</span></span></code></pre></div>
<p>And you’ll get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Beqnarray*%7D%0A(A%5Ccup%20B)-(C-A)%20&amp;=&amp;%20(A%5Ccup%20B)%20%5Ccap%20(C-A)%5Ec%5C%5C%0A&amp;=&amp;%20(A%5Ccup%20B)%20%5Ccap%20(C%20%5Ccap%20A%5Ec)%5Ec%20%5C%5C%0A&amp;=&amp;%20(A%5Ccup%20B)%20%5Ccap%20(C%5Ec%20%5Ccup%20A)%20%5C%5C%0A&amp;=&amp;%20A%20%5Ccup%20(B%5Ccap%20C%5Ec)%20%5C%5C%0A&amp;=&amp;%20A%20%5Ccup%20(B-C)%0A%5Cend%7Beqnarray*%7D%0A"></p>
<p>Another example:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb2-1">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% latex density=72 %}</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\begin</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">picture</span>}(100,100)(0,0)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\setlength</span>{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\unitlength</span>}{1pt}</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(20,70){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\circle</span>{30}}  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(20,70){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\circle*</span>{10}}   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% left eye</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(80,70){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\circle</span>{30}}  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(80,70){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\circle*</span>{10}}   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% right eye</span></span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(40,40){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\line</span>(1,2){10}} <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(60,40){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\line</span>(-1,2){10}} <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(40,40){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\line</span>(1,0){20}} <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% nose</span></span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\put</span>(50,20){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\oval</span>(80,10)[b]} <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% mouth</span></span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\multiput</span>(0,90)(4,0){10}{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\line</span>(1,3){4}}  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% left eyebrow</span></span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\multiput</span>(100,90)(-4,0){10}{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\line</span>(-1,3){4}}  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% right eyebrow</span></span>
<span id="cb2-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\end</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">picture</span>}</span>
<span id="cb2-11">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% endlatex %}</span></span></code></pre></div>
<p>And get this:</p>
<p><img src="https://www.flx.cat/posts/2013-11-10-liquid-latex-jekyll-plugin/images/sample2.png" class="img-fluid" alt="Result of the second example">&nbsp;</p>
<p>Another example, you write in your post:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb3-1">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% latex density=100 usepackages=sudoku %}</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\begin</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sudoku</span>}</span>
<span id="cb3-3">| |2| | |3| |9| |7|.</span>
<span id="cb3-4">| |1| | | | | | | |.</span>
<span id="cb3-5">|4| |7| | | |2| |8|.</span>
<span id="cb3-6">| | |5|2| | | |9| |.</span>
<span id="cb3-7">| | | |1|8| |7| | |.</span>
<span id="cb3-8">| |4| | | |3| | | |.</span>
<span id="cb3-9">| | | | |6| | |7|1|.</span>
<span id="cb3-10">| |7| | | | | | | |.</span>
<span id="cb3-11">|9| |3| |2| |6| |5|.</span>
<span id="cb3-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\end</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sudoku</span>}</span>
<span id="cb3-13">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% endlatex %}</span></span></code></pre></div>
<p>The result will be this:</p>
<p><img src="https://www.flx.cat/posts/2013-11-10-liquid-latex-jekyll-plugin/images/sample3.png" class="img-fluid" alt="Result of the third example">&nbsp;</p>
<p>As you can see, this last example depends on the <code>sudoku</code> package to be installed in your system. If you are using TeXLive, you must install it if it’s not already there:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> tlmgr install sudoku</span></code></pre></div>
</section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Just copy the <code>liquid_latex.rb</code> file to the <code>_plugins</code> folder.</p>
</section>
<section id="requirements" class="level2">
<h2 class="anchored" data-anchor-id="requirements">Requirements</h2>
<p>Obviously you must have a LaTeX installation of some kind (like <a href="http://www.tug.org/texlive/">TeXLive</a>) and some additional software capable of transforming a EPS file to its corresponding PNG equivalent (like <a href="http://www.imagemagick.org/">ImageMagick</a>).</p>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<p>There are several configuration parameters that you can define in your <code>_config.yml</code>. Here is a sample of such items:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ...</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... your _config.yml file ...</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ...</span></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Liquid-LaTeX plugin</span></span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">liquid_latex</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">debug</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb5-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb5-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">usepackages</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pst-all,pst-3dplot</span></span>
<span id="cb5-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">output_directory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /res/latex</span></span>
<span id="cb5-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">latex_cmd</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latex -interaction=nonstopmode $texfile &amp;&gt; /dev/null"</span></span>
<span id="cb5-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dvips_cmd</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dvips -E $dvifile -o $epsfile &amp;&gt; /dev/null"</span></span>
<span id="cb5-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">convert_cmd</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"convert -density $density $epsfile $pngfile &amp;&gt; /dev/null"</span></span>
<span id="cb5-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">temp_filename</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latex_temp"</span></span></code></pre></div>
<p>An explanation of those parameters follows:</p>
<p><strong><code>_config.xml</code> parameters for this plugin:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 12%">
<col style="width: 62%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>debug</code></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">Activates the debug mode with which you can see the compilation commands that are executed during build. Default value: <code>false</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>density</code></td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">Density for the conversion of PostScript (EPS) to PNG. Default value:<code>300</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>usepackages</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Name of the packages (as a list of comma-separated) that will be passed globally to each block of <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> code. They will be added individually to their corresponding <code>\usepackage{...}</code> lines in the temporary <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> file. Default value: empty string (no packages)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>output_directory</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Path in which the generated PNG will be placed. Default value: <code>/latex</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>temp_filename</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Name of the temporary file that will be generated for the compilation process. Default value: <code>latex_temp</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>latex_cmd</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Command line to execute for the <code>.tex</code> to <code>.div</code> conversion. Default value: <code>latex -interaction=nonstopmode $texfile &amp;&gt; /dev/null</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>dvips_cmd</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Command line to execute for the <code>.dvi</code> to <code>.eps</code> conversion. Default value: <code>dvips -E $dvifile -o $epsfile &amp;&gt; /dev/null</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>convert_cmd</code></td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Command line to execute for the <code>.eps</code> to <code>.png</code> conversion. Default value: <code>convert -density $density $epsfile $pngfile &amp;&gt; /dev/null</code></td>
</tr>
</tbody>
</table>
<p>In these last three parameters you can use the following variables:</p>
<p><strong>Substitution variables for the command line configurations:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>$texfile</code></td>
<td style="text-align: left;">Name of the LaTeX temporary file</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>$dvifile</code></td>
<td style="text-align: left;">Name of the DVI temporary file</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>$epsfile</code></td>
<td style="text-align: left;">Name of the EPS temporary file</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>$pngfile</code></td>
<td style="text-align: left;">Name of the generated PNG file</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>$density</code></td>
<td style="text-align: left;">Density value that will be used by the conversion</td>
</tr>
</tbody>
</table>
<p>This variables makes you able to choose which software you use for the whole conversion process. The sample shown above, as well as the default parameters, where defined for use with TeXLive and ImageMagick.</p>
<p>If you don’t use a certain parameter, it will take the default value. If you are happy with all the default values you can omit the whole <code>liquid-latex</code> section in your <code>_config.xml</code>.</p>
</section>
<section id="notes" class="level2">
<h2 class="anchored" data-anchor-id="notes">Notes</h2>
<ul>
<li><p>The plugin doesn’t recompile a previously rendered block of <img src="https://latex.codecogs.com/png.latex?%5CLaTeX">. It takes into consideration a change in the text or a change in the arguments (density and packages used). This reduces the total time of the building process.</p>
<p>Aside, you can delete all the contents of your <img src="https://latex.codecogs.com/png.latex?%5CLaTeX"> generated blocks in the source directory if you want to make a backup copy of your site. It will be completelly regenerated when you rebuild your site.</p></li>
<li><p>Also, this plugin keeps the folder of generated images in a clean state. That is, there will be only those images that are used in your site. All previously generated images will be deleted if they are detected as orphaned from the posts.</p></li>
<li><p>If you are trying to generate a picture with PSTricks, I recommend to insert the PSTricks code inside a TeXtoEPS environment. This ensures a perfect crop of the generated image.</p>
<p>For example:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb6-1">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% latex density=72 usepackages=pst-all,pst-eps %}</span></span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\begin</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">TeXtoEPS</span>}</span>
<span id="cb6-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\begin</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pspicture</span>}(0,0)(7,2)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\psframe</span>(0,0)(7,2) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\psline</span>(0,0)(7,2) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\psline</span>(7,0)(0,2)</span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\end</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pspicture</span>}</span>
<span id="cb6-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">\end</span>{<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">TeXtoEPS</span>}</span>
<span id="cb6-7">{<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">% endlatex %}</span></span></code></pre></div></li>
</ul>


</section>

 ]]></description>
  <category>jekyll</category>
  <category>liquid tags</category>
  <category>developing</category>
  <category>ruby</category>
  <category>plugin</category>
  <category>latex</category>
  <guid>https://www.flx.cat/posts/2013-11-10-liquid-latex-jekyll-plugin/</guid>
  <pubDate>Sat, 09 Nov 2013 23:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-11-10-liquid-latex-jekyll-plugin/images/featured.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>Liquid-Lipsum Jekyll Plugin</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-11-09-liquid-lipsum-jekyll-plugin/</link>
  <description><![CDATA[ 





<p>I’ve just finished my first Jekyll plugin: the <strong>jekyll-liquid-lipsum-plugin</strong>. This Jekyll plugin inserts random text inside your posts, in order to test how the a long text will appear. It’s specially useful playing with the CSS of your site.</p>
<section id="the-plugin" class="level2">
<h2 class="anchored" data-anchor-id="the-plugin">The plugin</h2>
<p>You can access it’s source code, clone it and/or use it from Gitlab: <a href="https://gitlab.com/felix.galindo/jekyll-liquid-lipsum-plugin">https://gitlab.com/felix.galindo/jekyll-liquid-lipsum-plugin</a></p>
<p>This plugin allows you to insert random text in your posts, just to test how will appear some new environment or a new CSS class.</p>
</section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Just copy the <code>liquid_lipsum.rb</code> file to the <code>_plugins</code> folder.</p>
</section>
<section id="requirements" class="level2">
<h2 class="anchored" data-anchor-id="requirements">Requirements</h2>
<p>None. :)</p>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<p>None. :)</p>
</section>
<section id="usage" class="level2">
<h2 class="anchored" data-anchor-id="usage">Usage</h2>
<p>It’s usage is simple. For example, you insert this line in one of your posts:</p>
<pre class="plain"><code>{% lipsum %}</code></pre>
<p>And you’ll get something like this:</p>
<blockquote class="blockquote">
<p>Aenean id lacinia neque nec bibendum odio risus a arcu imperdiet metus id velit augue id magna iaculis quis, pretium quam iaculis quis, sit amet nibh ullamcorper nec, pretium quam nonummy ac, erat libero tristique tellus, turpis at pulvinar vulputate, sed nisl molestie nec bibendum odio risus erat libero tristique tellus, a arcu imperdiet pretium quam turpis at pulvinar vulputate, sit amet nibh rutrum non, pretium quam augue id magna ullamcorper nec, porttitor ut, porttitor ut, nec bibendum odio risus sit amet nibh sit amet ante.</p>
</blockquote>
<p>As you can see, a full paragraph of random text will substitute the original liquid tag.</p>
<p>Each paragraph will have a beginning, a middle part and an ending. The <em>size</em> of the paragraph corresponds to the number of middle parts. A number of 3 will have 3 middle parts.</p>
<p>The following paragraph has a size of 1: Nam quis nulla ullamcorper nec, sit amet ante. The begining is “Nam quis nulla”, the middle part is “ullamcorper nec,” and the ending is “sit amet ante”.</p>
<p>The beginings, middle parts and endings are taken randomly from 3 different pools of text.</p>
<p>The tag allows up to three numbers as parameters:</p>
<ul>
<li>The <strong>first number</strong> represents the number of paragraphs to be generated,</li>
<li>The <strong>second number</strong> is the minimum size of the paragraph (number of middle parts).</li>
<li>The <strong>third number</strong> is the maximum size of the paragraph (number of middle parts).</li>
</ul>
<p>Combining this, you can have the following situations:</p>
<p><strong>Use cases of the tag:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 46%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Usage</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>{% lipsum %}</code></td>
<td style="text-align: left;">1 paragraph. Random length between 10 and 30</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>{% lipsum n %}</code></td>
<td style="text-align: left;"><strong><em>n</em></strong> paragraphs. Random length between 10 and 30</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>{% lipsum n l %}</code></td>
<td style="text-align: left;"><strong><em>n</em></strong> paragraphs. Exactly a length of <strong><em>l</em></strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>{% lipsum n l1 l2 %}</code></td>
<td style="text-align: left;"><strong><em>n</em></strong> paragraphs. Random length between <strong><em>l1</em></strong> and <strong><em>l2</em></strong></td>
</tr>
</tbody>
</table>
<p>You can improve or modify the behaviour of this liquid tag by simply editing its source code. There you can change the sentence parts to your wishes by simply editing the three arrays of strings from which the generator takes the text parts.</p>


</section>

 ]]></description>
  <category>jekyll</category>
  <category>liquid tags</category>
  <category>developing</category>
  <category>ruby</category>
  <category>plugin</category>
  <category>lipsum</category>
  <guid>https://www.flx.cat/posts/2013-11-09-liquid-lipsum-jekyll-plugin/</guid>
  <pubDate>Fri, 08 Nov 2013 23:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-11-09-liquid-lipsum-jekyll-plugin/images/featured.png" medium="image" type="image/png" height="108" width="144"/>
</item>
<item>
  <title>XND, BaseX i Java</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-07-03-BD09-xnd-basex-i-java/</link>
  <description><![CDATA[ 





<section id="connexió-amb-bases-de-dades-natives-xml" class="level2">
<h2 class="anchored" data-anchor-id="connexió-amb-bases-de-dades-natives-xml">1. Connexió amb bases de dades natives XML</h2>
<p>És evident que una base de dades nativa XML (<strong>XND</strong> a partir d’ara) no és el mateix que una base de dades relacional (BDR a partir d’ara). El magatzem de dades és diferent, tant en estructuració lògica com física:</p>
<ul>
<li><p><strong>Des d’un punt de vista lògic</strong>, el model de la base de dades és diferent en cada cas: en el cas de BDR la informació es disposa en taules que representen unitats (entitats) i s’estableixen relacions entre dites entitats. En el cas de XND, la informació es disposa en unes estructures jeràrquiques on la informació ja es mostra relacionada, tota entremesclada i resolta. Potser hem de vincular certes parts d’aquests arbres jeràrquics, però la idea és minimitzar aquest tipus de resolucions.</p></li>
<li><p><strong>Des d’un punt de vista físic</strong>, els arxius que representen les dades estan estructurats de manera diferent, perquè en el cas de les bases de dades BDR el mateix SGBDR (Sistema Gestor de B.D. relacional) construeix i manté les codificacions i estructures internes dels arxius involucrats, tot decidint si una taula de dades ha d’estar partida en un o més arxius, o si aquest partiment es realitza dins d’un únic arxiu combinant múltiples objectes o no. En una XND, pel contrari, l’emmagatzematge és una col·lecció d’arxius XML que poden ser editats i consultats per altres mitjans, i no només a través de l’accés per XND.</p></li>
</ul>
<p>És per això que ara la concepció del “<em>servidor de base de dades</em>” també canviarà, i és que ara només s’ha d’encarregar de manipular un o més arxius XML, realitzant consultes i algunes modificacions puntuals. Vist així, la base de dades XND pren més la forma d’un mòdul ple de funcions que no un servidor en el sentit tradicional del terme.</p>
<p>Tot i això, certs productes XND prenen la forma de mòdul o llibreria, mentre que d’altres prenen la forma de servei de xarxa:</p>
<ul>
<li><p><strong>XND com a llibreria</strong>: Aquí, l’accés i manipulació de la informació no requereix d’una connexió de xarxa, sinó que la llibreria implementa l’accés controlat a les dades de la base de dades XND a través de classes i/o funcions.</p></li>
<li><p><strong>XND a través de connexió de xarxa</strong>: Seguint el model tradicional, la base de dades XND disposa d’una aplicació servidor que, en ser iniciada, obre un port i permet connexions locals i/o remotes per atendre peticions d’accés sobre la base de dades.</p></li>
</ul>
<p>En el cas de BaseX que estudiem, el model utilitzat és el segon i existeix un servidor que ofereix el servei de xarxa per accedir a la base de dades XND.</p>
<p>En concret, BaseX ens ofereix els següent mecanismes per operar amb la base de dades:</p>
<ul>
<li><p>Una aplicació gràfica que connecta directament amb la base de dades: <code>basexgui</code></p></li>
<li><p>Una aplicació de consola que connecta directament amb la base de dades: <code>basex</code></p></li>
<li><p>Un servidor que obre un port i accepta connexions remotes: <code>basexserver</code></p></li>
<li><p>Un client de consola que connecta amb un servidor BaseX remot per executar-hi ordres: <code>basexclient</code></p></li>
</ul>
<p>El que ens interessa aquí és <code>basexserver</code> que, en ser iniciat, obre un port d’accés que permet la interacció amb el servidor de la manera tradicional gràcies a connexions remotes o locals a través del subsistema de xarxa.</p>
<p>Per tant, necessitem iniciar el servidor, i això ho fem des de la consola escrivint el nom de l’ordre del servidor.</p>
<p>També podem iniciar-lo en mode daemon escrivint:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">basexserver</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-S</span></span></code></pre></div>
<p>Un cop iniciat el servidor, podem realitzar connexions amb ell des del client <code>basexclient</code> o des de llenguatges de programació com farem nosaltres des de Java.</p>
<p>Si mai hem d’aturar el servidor manualment, ho farem mitjançant l’ordre de consola:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">basexserver</span> stop</span></code></pre></div>
<p>Si hem de fer proves des d’un client remot al servidor amb què volem connectar, necessitarem iniciar sessió remota. Així, per exemple, per connectar amb un servidor BaseX en marxa situat a una IP 192.168.1.1, amb usuari “usuari” i contrasenya “1234”, simplement hem d’escriure:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">basexclient</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n192.168.1.1</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Uusuari</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-P1234</span></span></code></pre></div>
<p>Així iniciarem una sessió interactiva per executar ordres sobre el servidor XND.</p>
<p>D’igual manera, per realitzar tasques sobre el servidor XND, però des de llenguatges d’alt nivell com Java, necessitarem algun tipus de llibreria que ens ofereixi la infraestructura per a connectar, tot especificant també la IP, el nom d’usuari i la contrasenya d’aquell usuari.</p>
<p>Un cop iniciada una sessió d’execució d’ordres, BaseX és molt semblant a qualsevol altre sistema servidor, tot i que el seu llenguatge té característiques pròpies.</p>
</section>
<section id="gestió-bàsica-duna-base-de-dades-basex" class="level2">
<h2 class="anchored" data-anchor-id="gestió-bàsica-duna-base-de-dades-basex">2. Gestió bàsica d’una base de dades BaseX</h2>
<p>Veurem aquí tot un seguit d’ordres que són importants per entendre l’operativa bàsica amb bases de dades XND en la seva implementació pròpia BaseX.</p>
<p>Els exemples i passos mostrats són tots des del client <code>basexclient</code>, assumint que un servidor <code>basexserver</code> està en execució i que estem connectats amb un usuari amb prou privilegis com per fer les operacions aquí indicades.</p>
<p>Tingui present que, tot just instal·lat, BaseX configura un usuari amb nom “<code>admin</code>” i contrasenya “<code>admin</code>”, de manera que podem connectar amb dit usuari per iniciar la interacció amb el servidor. Si ho fem en la mateixa màquina que el servidor, no cal indicar res a la línia d’ordres.</p>
<p>A més, es recomana utilitzar el <em>wrapper</em> <code>rlwrap</code> per fer que l’execució de l’ordre sigui més còmoda (memòria de línies antigues, correcte funcionament de les fletxes del cursor, etc.):</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1">$ rlwrap basexclient</span>
<span id="cb4-2">Username: admin</span>
<span id="cb4-3">Password: admin</span>
<span id="cb4-4">BaseX 7.0.2 [Client]</span>
<span id="cb4-5">Try "help" to get more information.</span>
<span id="cb4-6"></span>
<span id="cb4-7">&gt; </span></code></pre></div>
<p>Les ordres que accepta BaseX des d’aquesta interfície són moltes i de natura molt variada:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1">&gt; help</span>
<span id="cb5-2">Try "help [...]" to get info on a specific command.</span>
<span id="cb5-3"></span>
<span id="cb5-4">ADD (TO [path]) [input]</span>
<span id="cb5-5">    Add document to database.</span>
<span id="cb5-6">ALTER [DATABASE|USER] [...]</span>
<span id="cb5-7">    Alter database name or user password.</span>
<span id="cb5-8">CHECK [input]</span>
<span id="cb5-9">    Open or create database.</span>
<span id="cb5-10">CLOSE </span>
<span id="cb5-11">    Close current database.</span>
<span id="cb5-12">COPY [name] [newname]</span>
<span id="cb5-13">    Copy database.</span>
<span id="cb5-14">CREATE [BACKUP|DATABASE|EVENT|INDEX|USER] [...]</span>
<span id="cb5-15">    Create database, index or user.</span>
<span id="cb5-16">CS [query]</span>
<span id="cb5-17">    Run XQuery and set result as new context set.</span>
<span id="cb5-18">DELETE [path]</span>
<span id="cb5-19">    Delete documents from database.</span>
<span id="cb5-20">DROP [BACKUP|DATABASE||EVENTINDEX|USER] [...]</span>
<span id="cb5-21">    Drop database, index or user.</span>
<span id="cb5-22">EXIT </span>
<span id="cb5-23">    Exit application.</span>
<span id="cb5-24">EXPORT [path]</span>
<span id="cb5-25">    Export database to XML.</span>
<span id="cb5-26">FIND [keywords]</span>
<span id="cb5-27">    Run a keyword query.</span>
<span id="cb5-28">FLUSH </span>
<span id="cb5-29">    Flush database.</span>
<span id="cb5-30">GET [option]</span>
<span id="cb5-31">    Show global option.</span>
<span id="cb5-32">GRANT [NONE|READ|WRITE|CREATE|ADMIN] (ON [database]) TO [user]</span>
<span id="cb5-33">    Grant user permissions.</span>
<span id="cb5-34">HELP ([command])</span>
<span id="cb5-35">    Get help on BaseX commands.</span>
<span id="cb5-36">INFO ([DATABASE|INDEX|STORAGE])</span>
<span id="cb5-37">    Show information on current database.</span>
<span id="cb5-38">KILL [name]</span>
<span id="cb5-39">    Kill user sessions.</span>
<span id="cb5-40">LIST ([path])</span>
<span id="cb5-41">    List databases or documents in database.</span>
<span id="cb5-42">OPEN [path]</span>
<span id="cb5-43">    Open database.</span>
<span id="cb5-44">OPTIMIZE (ALL)</span>
<span id="cb5-45">    Optimize the database.</span>
<span id="cb5-46">PASSWORD ([password])</span>
<span id="cb5-47">    Change password.</span>
<span id="cb5-48">RENAME [path] [newpath]</span>
<span id="cb5-49">    Rename document paths in database.</span>
<span id="cb5-50">REPLACE [path] [input]</span>
<span id="cb5-51">    Replace documents in database.</span>
<span id="cb5-52">REPO [DELETE|INSTALL|LIST]</span>
<span id="cb5-53">    Install, delete or list packages.</span>
<span id="cb5-54">RESTORE [name-(date)]</span>
<span id="cb5-55">    Restore database.</span>
<span id="cb5-56">RETRIEVE [path]</span>
<span id="cb5-57">    Retrieve raw data.</span>
<span id="cb5-58">RUN [path]</span>
<span id="cb5-59">    Run file as XQuery.</span>
<span id="cb5-60">SET [option] ([value])</span>
<span id="cb5-61">    Set global options.</span>
<span id="cb5-62">SHOW [BACKUPS|DATABASES|EVENTS|SESSIONS|USERS]</span>
<span id="cb5-63">    Show server information.</span>
<span id="cb5-64">STORE (TO [path]) [input]</span>
<span id="cb5-65">    Store raw data.</span>
<span id="cb5-66">XQUERY [query]</span>
<span id="cb5-67">    Run XQuery.</span></code></pre></div>
<p>Tractarem ara les més destacables, tot agrupant-les en diversos grups:</p>
<ul>
<li>Ordres de gestió de bases de dades</li>
<li>Ordres de gestió d’usuaris</li>
<li>Ordres de gestió de privilegis</li>
<li>Ordres relacionades amb les còpies de seguretat</li>
<li>Ordres relacionats amb els índexs</li>
<li>Ordres relacionats amb les consultes de dades</li>
</ul>
<section id="gestió-de-bases-de-dades" class="level3">
<h3 class="anchored" data-anchor-id="gestió-de-bases-de-dades">2.1. Gestió de bases de dades</h3>
<p>Podem manipular les bases de dades existents amb totes les ordres que ens ofereix BaseX al respecte, i que no són poques:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Ordre</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ADD (TO [path]) [input]</code></td>
<td style="text-align: left;">Afegir el document a la base de dades</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ALTER DATABASE [...]</code></td>
<td style="text-align: left;">Modificar el nom de la base de dades</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>CHECK [input]</code></td>
<td style="text-align: left;">Obre o crea una base de dades</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CLOSE</code></td>
<td style="text-align: left;">Tanca la base de dades oberta actualment</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>COPY [name] [newname]</code></td>
<td style="text-align: left;">Copia la base de dades</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CREATE DATABASE [...]</code></td>
<td style="text-align: left;">Crea una base de dades nova</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DELETE [path]</code></td>
<td style="text-align: left;">Elimina documents de la base de dades</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DROP DATABASE</code></td>
<td style="text-align: left;">Elimina una base de dades sencera</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>EXPORT [path]</code></td>
<td style="text-align: left;">Exporta la base de dades a un arxiu XML</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>FLUSH</code></td>
<td style="text-align: left;">Fixa els canvis pendents a la base de dades</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>INFO DATABASE</code></td>
<td style="text-align: left;">Mostra informació de la base de dades activa</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>LIST ([path])</code></td>
<td style="text-align: left;">Llista bases de dades i/o documents</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>OPEN [path]</code></td>
<td style="text-align: left;">Obre una base de dades</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>OPTIMIZE (ALL)</code></td>
<td style="text-align: left;">Optimitza la base de dades</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>RENAME [path] [newpath]</code></td>
<td style="text-align: left;">Canviar camins a arxius de la base de dades</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>REPLACE [path] [input]</code></td>
<td style="text-align: left;">Substitueix documents de la base de dades</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>SHOW DATABASES</code></td>
<td style="text-align: left;">Mostra informació sobre les bases de dades existents</td>
</tr>
</tbody>
</table>
<p>Observi les següents ordres que mostren l’ús bàsic d’una sessió d’administració de base de dades XND:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb6-1">$ rlwrap basexclient</span>
<span id="cb6-2">Username: admin</span>
<span id="cb6-3">Password: admin</span>
<span id="cb6-4">BaseX 7.0.2 [Client]</span>
<span id="cb6-5">Try "help" to get more information.</span>
<span id="cb6-6"></span>
<span id="cb6-7">&gt; CREATE DATABASE mondial ./mondial.xml</span>
<span id="cb6-8">Database 'mondial' created in 1816.36 ms.</span>
<span id="cb6-9">&gt; CLOSE</span>
<span id="cb6-10">Database 'mondial' was closed.</span>
<span id="cb6-11">&gt; SHOW DATABASES</span>
<span id="cb6-12">0 opened database(s).</span>
<span id="cb6-13">&gt; LIST</span>
<span id="cb6-14">Name     Resources  Size     Input Path               </span>
<span id="cb6-15">----------------------------------------------------</span>
<span id="cb6-16">mondial  1          2165975  /home/felix/mondial.xml  </span>
<span id="cb6-17">test     2          4645     /home/felix/testDB       </span>
<span id="cb6-18"></span>
<span id="cb6-19">2 Databases.</span>
<span id="cb6-20">&gt; OPEN mondial</span>
<span id="cb6-21">Database 'mondial' opened in 7.47 ms.</span>
<span id="cb6-22">&gt; CREATE DATABASE prova</span>
<span id="cb6-23">Database 'prova' created in 44.56 ms.</span>
<span id="cb6-24">&gt; ADD mondial.xml</span>
<span id="cb6-25">Path "mondial.xml" added in 1125.91 ms.</span>
<span id="cb6-26">&gt; LIST prova</span>
<span id="cb6-27">Input Path   Type  Content-Type     Size   </span>
<span id="cb6-28">-----------------------------------------</span>
<span id="cb6-29">mondial.xml  xml   application/xml  89486  </span>
<span id="cb6-30"></span>
<span id="cb6-31">1 Resources.</span>
<span id="cb6-32">&gt; INFO</span>
<span id="cb6-33">General Information</span>
<span id="cb6-34">    Version: 7.0.2</span>
<span id="cb6-35">    Database Path: /home/felix/BaseXData</span>
<span id="cb6-36">    Used Main Memory: 1558 KB</span>
<span id="cb6-37"></span>
<span id="cb6-38">Resource Properties</span>
<span id="cb6-39">    Whitespace Chopping: ON</span>
<span id="cb6-40"></span>
<span id="cb6-41">Indexes</span>
<span id="cb6-42">    Path Summary: ON</span>
<span id="cb6-43">    Text Index: ON</span>
<span id="cb6-44">    Attribute Index: ON</span>
<span id="cb6-45">    Full-Text Index: OFF</span>
<span id="cb6-46">&gt; INFO DATABASE</span>
<span id="cb6-47">Database Properties</span>
<span id="cb6-48">    Name: prova</span>
<span id="cb6-49">    Size: 1839 KB</span>
<span id="cb6-50">    Nodes: 89486</span>
<span id="cb6-51">    Resources: 1</span>
<span id="cb6-52">    Timestamp: 12.03.2013 08:36:02</span>
<span id="cb6-53"></span>
<span id="cb6-54">Resource Properties</span>
<span id="cb6-55">    Timestamp: 12.03.2013 08:36:20</span>
<span id="cb6-56">    Encoding: UTF-8</span>
<span id="cb6-57">    Whitespace Chopping: ON</span>
<span id="cb6-58"></span>
<span id="cb6-59">Indexes</span>
<span id="cb6-60">    Up-to-date: false</span>
<span id="cb6-61">    Path Summary: ON</span>
<span id="cb6-62">    Text Index: OFF</span>
<span id="cb6-63">    Attribute Index: OFF</span>
<span id="cb6-64">    Full-Text Index: OFF</span>
<span id="cb6-65">&gt; OPTIMIZE</span>
<span id="cb6-66">Database 'prova' optimized in 548.67 ms.</span></code></pre></div>
</section>
<section id="gestió-dusuaris" class="level3">
<h3 class="anchored" data-anchor-id="gestió-dusuaris">2.2. Gestió d’usuaris</h3>
<p>Les ordres relacionades amb la gestió dels usuaris són les següents:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Ordre</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ALTER USER [...]</code></td>
<td style="text-align: left;">Alter user password</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CREATE USER [...]</code></td>
<td style="text-align: left;">Createuser</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DROP USER [...]</code></td>
<td style="text-align: left;">Drop user</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>KILL [name]</code></td>
<td style="text-align: left;">Kill user sessions</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>PASSWORD ([password])</code></td>
<td style="text-align: left;">Change password</td>
</tr>
</tbody>
</table>
<p>Les ordres mostrades permeten una gestió simple però efectiva dels usuaris. Observi aquests exemples d’ús:</p>
<ol type="1">
<li><p>Primer de tot definirem un usuari nou anomenat “<code>usuari</code>” amb contrasenya “<code>1234</code>”. Per introduir la contrasenya directament en línia d’ordres de BaseX necessitem calcular el <em>hash</em> MD5 de la contrasenya, perquè ens requereix introduir-la d’aquesta manera. Per tant, primer obtindrem la contrasenya des de consola amb l’eina <code>md5sum</code>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1234"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md5sum</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">81dc9bdb52d04dc20036dbd8313ed055</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>I aleshores entrem amb l’usuari administrador i creem efectivament l’usuari:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1">$ rlwrap basexclient</span>
<span id="cb8-2">Username: admin</span>
<span id="cb8-3">Password: admin</span>
<span id="cb8-4">BaseX 7.0.2 [Client]</span>
<span id="cb8-5">Try "help" to get more information.</span>
<span id="cb8-6"></span>
<span id="cb8-7">&gt; CREATE USER usuari 81dc9bdb52d04dc20036dbd8313ed055</span>
<span id="cb8-8">User 'usuari' created.</span>
<span id="cb8-9">&gt; EXIT</span>
<span id="cb8-10">Enjoy life.</span></code></pre></div></li>
<li><p>Ara intentem comprovar si l’usuari creat pot iniciar sessió:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1">$ rlwrap basexclient</span>
<span id="cb9-2">Username: usuari</span>
<span id="cb9-3">Password: 1234</span>
<span id="cb9-4">BaseX 7.0.2 [Client]</span>
<span id="cb9-5">Try "help" to get more information.</span>
<span id="cb9-6"></span>
<span id="cb9-7">&gt; OPEN prova</span>
<span id="cb9-8">READ permission needed.</span>
<span id="cb9-9">&gt; EXIT</span>
<span id="cb9-10">See you.</span></code></pre></div>
<p>Com veu, es pot iniciar sessió, però no es tenen privilegis d’accés a cap base de dades (més endavant es veurà com modificar privilegis).</p></li>
<li><p>Ara definirem un altre usuari que voldrem que sigui administrador de la base de dades i algun altre usuari:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1">$ rlwrap basexclient</span>
<span id="cb10-2">Username: ·admin</span>
<span id="cb10-3">Password: ·admin</span>
<span id="cb10-4">BaseX 7.0.2 [Client]</span>
<span id="cb10-5">Try "help" to get more information.</span>
<span id="cb10-6"></span>
<span id="cb10-7">&gt; CREATE USER admin2 </span>
<span id="cb10-8">Password: ·1234</span>
<span id="cb10-9">User 'admin2' created.</span>
<span id="cb10-10">&gt; ALTER USER admin2 </span>
<span id="cb10-11">Password: ·jA7sh$12@</span>
<span id="cb10-12">Password of user 'admin2' changed.</span>
<span id="cb10-13">&gt; CREATE USER alu01 81dc9bdb52d04dc20036dbd8313ed055</span>
<span id="cb10-14">User 'alu01' created.</span>
<span id="cb10-15">&gt; CREATE USER alu02 81dc9bdb52d04dc20036dbd8313ed055</span>
<span id="cb10-16">User 'alu02' created.</span>
<span id="cb10-17">&gt; CREATE USER alu03 81dc9bdb52d04dc20036dbd8313ed055</span>
<span id="cb10-18">User 'alu03' created.</span>
<span id="cb10-19">&gt; CREATE USER alu04 81dc9bdb52d04dc20036dbd8313ed055</span>
<span id="cb10-20">User 'alu04' created.</span>
<span id="cb10-21">&gt; CREATE USER alu05 81dc9bdb52d04dc20036dbd8313ed055</span>
<span id="cb10-22">User 'alu05' created.</span>
<span id="cb10-23">&gt; CREATE USER alu06 81dc9bdb52d04dc20036dbd8313ed055</span>
<span id="cb10-24">User 'alu06' created.</span></code></pre></div>
<p>Com veu, es mostra com hem de canviar una contrasenya d’un usuari existent, a més de com introduir-la sense que es vegi per pantalla.</p></li>
<li><p>Eliminem un usuari que sobra:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1">&gt; DROP USER alu06</span>
<span id="cb11-2">User 'alu06' dropped.</span></code></pre></div></li>
</ol>
</section>
<section id="gestió-de-privilegis" class="level3">
<h3 class="anchored" data-anchor-id="gestió-de-privilegis">2.3. Gestió de privilegis</h3>
<p>La gestió de privilegis en BaseX és força senzilla. En concret, incorpora 5 privilegis que poden aplicar-se sobre qualsevol usuari i sobre les bases de dades.</p>
<p>L’esquema que resumeix el comportament en aquest sentit és el següent:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2013-07-03-BD09-xnd-basex-i-java/images/basex_privilegis.png" class="img-fluid figure-img"></p>
<figcaption>Jerarquia de privilegis en BaseX</figcaption>
</figure>
</div>
<p>Observi que els privilegis poden aplicar-se a dos nivells:</p>
<ul>
<li><p><strong>Globalment</strong>: Afectaran a totes les bases de dades i sobre la gestió mateixa del servidor.</p></li>
<li><p><strong>Localment</strong>: Afectaran només a una base de dades específica. Si existeixen privilegis locals, aquests sobreescriuen els globals, de manera que els locals prevalen sobre els globals.</p></li>
</ul>
<p>A més, dos dels 5 privilegis no poden ser aplicats localment, perquè fan referència a la gestió del servidor.</p>
<p>El significat dels privilegis és força evident:</p>
<ul>
<li><code>NONE</code>: Cap privilegi</li>
<li><code>READ</code>: Es permet accedir a les dades, però sense modificar-les</li>
<li><code>WRITE</code>: Es concedeix la possibilitat de modificar les dades existents</li>
<li><code>CREATE</code>: S’atorga la possibilitat exclusiva de crear objectes nous</li>
<li><code>ADMIN</code>: Es disposa de tots els privilegis, podent qualsevol ordre</li>
</ul>
<p>Finalment, tingui present que un privilegi de nivell superior engloba tots els de nivell inferior. Així doncs, si s’atorga el dret de modificació de dades <code>WRITE</code>, també s’està atorgant implícitament en de lectura <code>READ</code>.</p>
<p>Per a manipular els privilegis només existeixen dues ordres relacionades:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Ordre</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>GRANT [NONE|READ|WRITE|CREATE|ADMIN] (ON [database]) TO [user]</code></td>
<td style="text-align: left;">Atorga drets a l’usuari</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>SHOW USERS (ON [database])</code></td>
<td style="text-align: left;">Mostra drets dels usuaris</td>
</tr>
</tbody>
</table>
<p>Posem ara uns quants exemples de com manipular privilegis:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb12-1">$ rlwrap basexclient</span>
<span id="cb12-2">Username: admin</span>
<span id="cb12-3">Password: admin</span>
<span id="cb12-4">BaseX 7.0.2 [Client]</span>
<span id="cb12-5">Try "help" to get more information.</span>
<span id="cb12-6"></span>
<span id="cb12-7">&gt; GRANT ADMIN TO admin2</span>
<span id="cb12-8">ADMIN granted to 'admin2'.</span>
<span id="cb12-9">&gt; GRANT READ ON prova TO alu*</span>
<span id="cb12-10">READ granted to 'alu01' on 'prova'.</span>
<span id="cb12-11">READ granted to 'alu02' on 'prova'.</span>
<span id="cb12-12">READ granted to 'alu03' on 'prova'.</span>
<span id="cb12-13">READ granted to 'alu04' on 'prova'.</span>
<span id="cb12-14">READ granted to 'alu05' on 'prova'.</span></code></pre></div>
<p>Com veu, assignar un dret global només implica dir el privilegi i l’usuari que el rebrà. Per assignar un dret concret sobre una base de dades específica, hem de fer servir la clàusula ON per indicar el nom de la base de dades. A més, pot veure com s’han assignat privilegis en bloc a diversos usuaris, simplement utilitzant el símbol comodí “<code>*</code>”.</p>
<p>Els privilegis poden ser modificats en qualsevol moment. Vegi la següent seqüència d’ordres:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1">&gt; GRANT CREATE ON prova TO usuari</span>
<span id="cb13-2">CREATE permission is unknown.</span>
<span id="cb13-3">&gt; GRANT CREATE TO usuari</span>
<span id="cb13-4">CREATE granted to 'usuari'.</span>
<span id="cb13-5">&gt; GRANT READ TO usuari</span>
<span id="cb13-6">READ granted to 'usuari'.</span>
<span id="cb13-7">&gt; GRANT WRITE ON prova TO usuari</span>
<span id="cb13-8">WRITE granted to 'usuari' on 'prova'.</span>
<span id="cb13-9">&gt; GRANT NONE ON mondial TO usuari</span>
<span id="cb13-10">NONE granted to 'usuari' on 'mondial'.</span></code></pre></div>
<p>Com veu, el privilegi <code>CREATE</code> és global i genera un error. Si donem un dret més gran i volem reduir-lo, simplement hem de substituir tornant a definir el nivell de dret per a aquell usuari.</p>
<p>Finalment, en l’exemple mostrat també s’ha indicat com podem tenir drets globals i locals diferents. En aquest cas, l’usuari “<code>usuari</code>” tindrà dret de lectura sobre tota base de dades (si no s’indica una altra cosa a nivell local) i específicament fixem un nivell de dret més elevat en una base de dades i un de menor en una altra. D’aquesta manera, podem fixar un dret per defecte i perfilar un de diferent per a cada base de dades concreta.</p>
<p>Per acabar, podem visualitzar els drets atorgats a nivell global i/o local amb l’ordre <code>SHOW USERS</code>. Seguint amb el nostre exemple:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb14-1">&gt; SHOW users</span>
<span id="cb14-2">Username  Read  Write  Create  Admin  </span>
<span id="cb14-3">------------------------------------</span>
<span id="cb14-4">admin     X     X      X       X      </span>
<span id="cb14-5">admin2    X     X      X       X      </span>
<span id="cb14-6">alu01                                 </span>
<span id="cb14-7">alu02                                 </span>
<span id="cb14-8">alu03                                 </span>
<span id="cb14-9">alu04                                 </span>
<span id="cb14-10">alu05                                 </span>
<span id="cb14-11">usuari    X                           </span>
<span id="cb14-12"></span>
<span id="cb14-13">8 Users.</span>
<span id="cb14-14">&gt; SHOW USERS ON prova</span>
<span id="cb14-15">Username  Read  Write  </span>
<span id="cb14-16">---------------------</span>
<span id="cb14-17">alu01     X            </span>
<span id="cb14-18">alu02     X            </span>
<span id="cb14-19">alu03     X            </span>
<span id="cb14-20">alu04     X            </span>
<span id="cb14-21">alu05     X            </span>
<span id="cb14-22">usuari    X     X      </span>
<span id="cb14-23"></span>
<span id="cb14-24">6 Users.</span></code></pre></div>
</section>
<section id="ordres-relacionades-amb-les-còpies-de-seguretat" class="level3">
<h3 class="anchored" data-anchor-id="ordres-relacionades-amb-les-còpies-de-seguretat">2.4. Ordres relacionades amb les còpies de seguretat</h3>
<p>Els <em>backups</em> s’emmagatzemen com a arxius de tipus ZIP al directori de dades de BaseX, que en Linux resideix al directori de l’usuari. Per exemple, /home/joan/BaseXData.</p>
<p>Els arxius de backup generats per BaseX inclouen tots els arxius interns de la base de dades tal i com estan indexats i transformats internament per la base de dades.</p>
<p>Les ordres relacionades amb la creació i manteniment de còpies de seguretat per a bases de dades BaseX són les següents:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Ordre</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>COPY [name] [newname]</code></td>
<td style="text-align: left;">Copia tota una base de dades</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CREATE BACKUP [...]</code></td>
<td style="text-align: left;">Crea un còpia de seguretat d’una base de dades</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DROP BACKUP [...]</code></td>
<td style="text-align: left;">Elimina una còpia de seguretat</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>EXPORT [path]</code></td>
<td style="text-align: left;">Exporta una base de dades a un arxiu XML</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>INFO STORAGE</code></td>
<td style="text-align: left;">Mostra informació sobre l’emmagatzematge</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>RESTORE [name-(date)]</code></td>
<td style="text-align: left;">Restaura una base de dades</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>SHOW BACKUPS</code></td>
<td style="text-align: left;">Mostra informació sobre les còpies de seguretat existents</td>
</tr>
</tbody>
</table>
<p>Exemples d’ús de la funcionalitat de les còpies de seguretat:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1">&gt; CREATE BACKUP mondial</span>
<span id="cb15-2">Backup for 'mondial' created in 584.35 ms.</span>
<span id="cb15-3">&gt; SHOW BACKUPS</span>
<span id="cb15-4">Name                             Size    </span>
<span id="cb15-5">---------------------------------------</span>
<span id="cb15-6">mondial-2013-03-12-15-51-03.zip  913102  </span>
<span id="cb15-7"></span>
<span id="cb15-8">1 Backups.</span>
<span id="cb15-9">&gt; CREATE BACKUP mondial</span>
<span id="cb15-10">Backup for 'mondial' created in 323.53 ms.</span>
<span id="cb15-11">&gt; SHOW BACKUPS</span>
<span id="cb15-12">Name                             Size    </span>
<span id="cb15-13">---------------------------------------</span>
<span id="cb15-14">mondial-2013-03-12-15-51-03.zip  913102  </span>
<span id="cb15-15">mondial-2013-03-12-20-50-43.zip  913102  </span>
<span id="cb15-16"></span>
<span id="cb15-17">2 Backups.</span>
<span id="cb15-18">&gt; RESTORE mondial</span>
<span id="cb15-19">'mondial-2013-03-12-20-50-43.zip' restored in 310.44 ms.</span>
<span id="cb15-20">&gt; RESTORE mondial-2013-03-12-15-51-03</span>
<span id="cb15-21">'mondial-2013-03-12-15-51-03.zip' restored in 274.67 ms.</span></code></pre></div>
<p>Observi que és possible restaurar un backup d’una data/hora específica, i no només la darrera còpia de seguretat.</p>
</section>
<section id="ordres-relacionats-amb-els-índexs" class="level3">
<h3 class="anchored" data-anchor-id="ordres-relacionats-amb-els-índexs">2.5. Ordres relacionats amb els índexs</h3>
<p>Els índexs permeten l’execució més ràpida de consultes d’extracció d’informació.</p>
<p>Relacionat amb els índexs, només existeixen 3 funcions bàsiques:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Ordre</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>CREATE INDEX [...]</code></td>
<td style="text-align: left;">Crea un índex nou</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DROP INDEX [...]</code></td>
<td style="text-align: left;">Elimina un índex</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>INFO INDEX</code></td>
<td style="text-align: left;">Mostra informació sobre els índexs existents</td>
</tr>
</tbody>
</table>
<p>En BaseX existeixen només 4 tipus d’índexs: <code>TEXT</code>, <code>FULLTEXT</code>, <code>ATTRIBUTES</code>, i <code>PATH</code>. Cadascun d’ells està especialitzat en optimitzar un aspecte diferent de les recerques i filtrat de les dades.</p>
<p>En concret, l’ordre de crear índexs no permet crear índexs sobre nodes, atributs o texts específics; sinó d’una manera genèrica per als quatre tipus esmentats.</p>
<p>L’ordre de crear o eliminar índexs accepten un únic argument que coincideix amb els 4 noms indicats al paràgraf anterior:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb16-1">CREATE INDEX [TEXT|FULLTEXT|ATTRIBUTE|PATH]</span>
<span id="cb16-2">DROP INDEX [TEXT|FULLTEXT|ATTRIBUTE|PATH]</span></code></pre></div>
<p>Els índexs faran que les consultes de selecció de dades siguin molt més eficients, reduint el temps total d’obtenció dels resultats. La diferència pot arribar, en alguns casos, a nivells de reducció de temps d’execució de consultes XQuery de fins el 1/10.</p>
</section>
<section id="ordres-relacionats-amb-les-consultes-de-dades-amb-xquery" class="level3">
<h3 class="anchored" data-anchor-id="ordres-relacionats-amb-les-consultes-de-dades-amb-xquery">2.6. Ordres relacionats amb les consultes de dades amb XQuery</h3>
<p>Quant a l’execució de consultes XQuery, BaseX ens ofereix les següents ordres:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Ordre</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>CS [query]</code></td>
<td style="text-align: left;">Executa una consulta XQuery i fixa el resultat com a context actual</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>RUN [path]</code></td>
<td style="text-align: left;">Executa el contingut d’un arxiu com a consulta XQuery</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>XQUERY [query]</code></td>
<td style="text-align: left;">Executa una consulta XQuery</td>
</tr>
</tbody>
</table>
<p>Podem executar una consulta XQuery directament amb l’ordre <code>XQUERY consulta</code>, però també podem tenir-la desada a disc i indicar la ruta amb l’ordre <code>RUN arxiu</code>.</p>
<p>Al marge d’això, sempre podem canviar de “<em>node actiu</em>” (context) amb l’ordre <code>CS</code> acompanyada d’una consulta XQuery que retorni un node del document original. Així doncs, les consultes posteriors prendran aquell context com a punt de partida (ubicació actual) i podrem utilitzar camins relatius dins del document amb consultes XQuery.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1">&gt; CS //mondial/country[name='Belgium']</span>
<span id="cb17-2">&gt; XQUERY count(descendant::city)</span>
<span id="cb17-3">10</span>
<span id="cb17-4">Query executed in 8.26 ms.</span>
<span id="cb17-5">&gt; XQUERY province/city[name='Brussels']/population/text()</span>
<span id="cb17-6">951580</span>
<span id="cb17-7">&gt; CS /</span></code></pre></div>
<p>Com veu, per retornar al nivell superior de l’arbre XML, només cal canviar el context a <code>/</code>.</p>
</section>
</section>
<section id="connexió-per-a-consultes-xquery-amb-java" class="level2">
<h2 class="anchored" data-anchor-id="connexió-per-a-consultes-xquery-amb-java">3. Connexió per a consultes XQuery amb Java</h2>
<p>BaseX ens ofereix la possibilitat de connectar i utilitzar la seva infraestructura des dels nostres programes Java, i ho fa de diverses maneres que passarem a revisar tot seguit.</p>
<section id="connexió-local-directa" class="level3">
<h3 class="anchored" data-anchor-id="connexió-local-directa">3.1. Connexió local directa</h3>
<p>BaseX ens permet connectar des de Java directament (sense sistema de seguretat, localment).</p>
<p>Per fer-ho només cal utilitzar les classes Context i XQuery que ofereixen a la seva API:</p>
<p><strong>Programa de prova per al API de BaseX</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Test01.java</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="Test01.java" style="background: #f1f3f5;"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">import</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">org</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">basex</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">core</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">Context</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">import</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">org</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">basex</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">core</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">cmd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">XQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Test01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Context</span> context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Context</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb18-6"></span>
<span id="cb18-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb18-10">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb18-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc('mondial.xml')//mondial/country[name='Spain']"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-12">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/province[name='Catalonia']/city/name"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-13">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">XQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>context<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb18-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb18-15">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb18-16">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb18-17">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Executat en "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb18-18">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">catch</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Exception</span> e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-20">      e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">printStackTrace</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb18-21">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-22">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>Com veu, el codi és molt senzill però només permet l’execució de sentències XQuery.</p>
<p>El resultat de la seva execució es mostra tot seguit:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> javac <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-cp</span> .:/usr/share/java/basex.jar Test01.java</span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> java <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-cp</span> .:/usr/share/java/basex.jar Test01</span>
<span id="cb19-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Barcelona<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Lleida<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Tarragona<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Hospitalet <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">de</span> Llobregat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Badalona<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Sabadell<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Terrassa<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Santa <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Coloma</span> de Gramanet<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Mataro<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-12"></span>
<span id="cb19-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Executat</span> en 2455ms</span></code></pre></div>
</section>
<section id="connexió-remota-a-través-de-classes-client" class="level3">
<h3 class="anchored" data-anchor-id="connexió-remota-a-través-de-classes-client">3.2. Connexió remota a través de classes client</h3>
<p>La diferència és que ara utilitzarem un classe client anomenada <code>ClientSession</code>. Aquesta classe afegeix al mètode anterior el fet de poder connectar a un equip remot indicant usuari i contrasenya.</p>
<p><strong>Programa de prova per al API de BaseX</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Test02.java</strong></pre>
</div>
<div class="sourceCode" id="cb20" data-filename="Test02.java" style="background: #f1f3f5;"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">import</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">org</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">basex</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">ClientSession</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">import</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">org</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">basex</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">server</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">ClientQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-3"></span>
<span id="cb20-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Test02 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-5"></span>
<span id="cb20-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb20-9">      ClientSession sessio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb20-10">              <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ClientSession</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localhost"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1984</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb20-11">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb20-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc('mondial.xml')//mondial/country[name='Spain']"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-13">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/province[name='Catalonia']/city/name"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-14">      ClientQuery clientQuery <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sessio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">query</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb20-15">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clientQuery<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb20-16">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb20-17">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb20-18">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb20-19">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Executat en "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb20-20">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">catch</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Exception</span> e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-22">      e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">printStackTrace</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb20-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-24">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-25"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>Observi que aquesta classe permet la interacció directa amb el servidor BaseX, però cal indicar el context arrel amb l’especificació del document XML que agafem de base per a la consulta.</p>
</section>
<section id="mètode-a-través-de-classe-wrapper" class="level3">
<h3 class="anchored" data-anchor-id="mètode-a-través-de-classe-wrapper">3.3. Mètode a través de classe wrapper</h3>
<p>Existeix la possibilitat de construir tota una classe que interaccioni amb la base de dades mitjançant <em>sockets</em>, i així implementar la connexió a baix nivell.</p>
<p>De fet, els mateixos creadors de BaseX ofereixen entre els exemples disponibles per a descarregar una classe anomenada <code>BaseXClient</code> que cobreix aquesta funcionalitat. Aquesta classe implementa la mateixa funcionalitat que el programa <code>basexclient</code> amb què ja havíem treballat.</p>
<p>El codi font de dita classe no es mostra aquí per dos motius: perquè és extens (gairebé 500 línies, moltes d’elles comentaris), i perquè és codi fet per l’equip de BaseX i està disponible a la seva web per a descarregar i també s’adjunta amb els arxius del curs.</p>
<p>Tornant a la funcionalitat que s’aconsegueix, les ordres i sintaxi de les mateixes coincidiran quan s’utilitza des de dita classe en Java.</p>
<p>Un petit exemple d’això és el següent programa, on s’invoca una consulta XQuery sobre la base de dades Mondial, tenint en compte que el servidor existeix, està operatiu, i la base de dades està també creada i operativa. A més, l’usuari amb què fem la connexió serà el compte de l’administrador:</p>
<p><strong>Programa de prova per al API de BaseX</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Test03.java</strong></pre>
</div>
<div class="sourceCode" id="cb21" data-filename="Test03.java" style="background: #f1f3f5;"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Test03 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-2"></span>
<span id="cb21-3">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb21-6">      BaseXClient sessio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb21-7">          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BaseXClient</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localhost"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1984</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-8">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb21-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XQUERY doc('mondial.xml')//mondial/country[name='Spain']"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-10">                           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/province[name='Catalonia']/city/name"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb21-11">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sessio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb21-13">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-14">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb21-15">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Executat en "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">catch</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Exception</span> e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-18">      e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">printStackTrace</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb21-19">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-20">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>Pot veure com el codi ofereix la possibilitat ara d’escriure una ordre qualsevol. En aquest cas s’invoca l’ordre <code>XQUERY</code> per sol·licitar una consulta d’aquest tipus, però podria efectuar-se qualsevol altre tipus de tasca.</p>
<p>Com a mostra d’això, vegi el següent cas on s’ha afegit l’ordre per obrir una base de dades específica, establint un context i realitzat una consulta XQuery:</p>
<p><strong>Programa de prova per al API de BaseX</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Test04.java</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="Test04.java" style="background: #f1f3f5;"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Test04 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-2"></span>
<span id="cb22-3">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb22-6">      BaseXClient sessio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb22-7">          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BaseXClient</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localhost"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1984</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-8">      sessio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPEN mondial"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-9">      sessio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CS //mondial/country[name='Spain']"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-10">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XQUERY province[name='Catalonia']/city/name"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-11">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sessio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> t2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">currentTimeMillis</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb22-13">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-14">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb22-15">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Executat en "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-16">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-17">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb22-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">catch</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Exception</span> e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-19">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">err</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERROR: "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getMessage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb22-20">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-21">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb22-22">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb22-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</div>
<p>Observi com utilitzem la variable de sessió obtinguda per executar ordres BaseX segons convingui. En aquest sentit, vegi que si una instrucció fallés, es llançaria una excepció de tipus <code>java.io.IOException</code>.</p>


</section>
</section>

 ]]></description>
  <category>bases de dades</category>
  <category>basex</category>
  <category>xpath</category>
  <category>xquery</category>
  <category>xnd</category>
  <guid>https://www.flx.cat/posts/2013-07-03-BD09-xnd-basex-i-java/</guid>
  <pubDate>Tue, 02 Jul 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-07-03-BD09-xnd-basex-i-java/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>XND - XPath i XQuery</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-07-03-BD08-xnd-xpath-i-xquery/</link>
  <description><![CDATA[ 





<section id="introducció" class="level2">
<h2 class="anchored" data-anchor-id="introducció">1 Introducció</h2>
<p>Les <strong>bases de dades natives XML (<em>XML native database</em>)</strong> ofereixen un mecanisme adient per a la consulta sobre dades que resideixin en documents XML.</p>
<p>En aquest sentit, les dades estan estructurades en la base de dades (que ara és un o més documents XML) en la forma d’una estructura en arbre invertit, on el seu creador haurà definit els noms dels nodes i la seva distribució:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>mondial.xml</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="mondial.xml" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;!DOCTYPE</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">mondial</span> SYSTEM "mondial.dtd"<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-3">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mondial</span>&gt;</span>
<span id="cb1-4">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">country</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> car_code=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AND"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> area=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"450"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> capital=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cty-Andorra-Andorra-la-Vella"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> memberships=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org-CE org-ECE org-Interpol org-IFRCS org-IOC org-ITU org-UN org-UNESCO org-WIPO"</span>&gt;</span>
<span id="cb1-5">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span>&gt;Andorra&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span>&gt;</span>
<span id="cb1-6">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">population</span>&gt;72766&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">population</span>&gt;</span>
<span id="cb1-7">...</span>
<span id="cb1-8">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">border</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> country=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> length=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"60"</span>/&gt;</span>
<span id="cb1-9">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">border</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> country=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> length=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"65"</span>/&gt;</span>
<span id="cb1-10">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">city</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> id=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cty-Andorra-Andorra-la-Vella"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> is_country_cap=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> country=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AND"</span>&gt;</span>
<span id="cb1-11">      &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span>&gt;Andorra la Vella&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span>&gt;</span>
<span id="cb1-12">      &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">longitude</span>&gt;1.3&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">longitude</span>&gt;</span>
<span id="cb1-13">      &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">latitude</span>&gt;42.3&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">latitude</span>&gt;</span>
<span id="cb1-14">      &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">population</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> year=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"87"</span>&gt;15600&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">population</span>&gt;</span>
<span id="cb1-15">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">city</span>&gt;</span>
<span id="cb1-16">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">country</span>&gt;</span>
<span id="cb1-17"></span>
<span id="cb1-18">...</span>
<span id="cb1-19"></span>
<span id="cb1-20">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">desert</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> id=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"desert-Atacama"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> country=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RCH"</span>&gt;</span>
<span id="cb1-21">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span>&gt;Atacama&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">name</span>&gt;</span>
<span id="cb1-22">...</span>
<span id="cb1-23">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">area</span>&gt;181300&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">area</span>&gt;</span>
<span id="cb1-24">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">longitude</span>&gt;-69.25&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">longitude</span>&gt;</span>
<span id="cb1-25">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">latitude</span>&gt;-24.5&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">latitude</span>&gt;</span>
<span id="cb1-26">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">desert</span>&gt;</span>
<span id="cb1-27">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mondial</span>&gt;</span></code></pre></div>
</div>
<p>El fragment mostrat correspon a la base de dades <strong>MondialDB</strong>, que pot descarregar-se lliurament <a href="http://www.dbis.informatik.uni-goettingen.de/Mondial/mondial.xml">aquí</a> i que serà utilitzada aquí per als exemples i exercicis.</p>
<p>Les consultes sobre XND són de natura diferents respecte de les conegudes fins ara arran de l’estructura interna d’aquests documents. Per tant, els llenguatges existents per fer-hi consultes també són diferents.</p>
<p>Trobem així que ara no podem utilitzar llenguatges com SQL, perquè aquí no tenen sentit. Pel contrari, existeix XPath i XQuery com els llenguatges <em>estrella</em> per a l’extracció de dades d’arxius XML i XND.</p>
<p>En concret, <strong>XPath</strong> és un llenguatge centrat en el recorregut descendent a través del XML, realitzant filtrat i agrupació, mitjançant un llenguatge senzill amb una col·lecció de funcions i operacions limitada.</p>
<p>Per altra banda, <strong>XQuery</strong> permet construir estructures més complexes basades en un iterador (bucle) de tipus <code>for</code> en el que es coneix com <strong>construcció FLWOR</strong> (<code>for</code>-<code>let</code>-<code>where</code>-<code>order</code>-<code>result</code>).</p>
<p>A més, existeixen diferents API disponibles per als diversos llenguatges de programació que permeten connectar amb aquest tipus de bases de dades i arxius XML per tal d’executar consultes amb aquests dos llenguatges de programació.</p>
</section>
<section id="installació-de-basex" class="level2">
<h2 class="anchored" data-anchor-id="installació-de-basex">2. Instal·lació de BaseX</h2>
<p>El primer que hem de fer és disposar d’una instal·lació d’alguna aplicació que permeti treballar en aquest entorn.</p>
<p>De sistemes XND n’hi ha un grapat, però nosaltres ens centrarem en el producte <a href="http://www.basex.org">BaseX</a>.</p>
<p>Aquest producte està disponible en el mateix dipòsit estàndard d’Ubuntu, de manera que només necessitem treballar des de <code>apt-get</code> per gestionar la seva instal·lació.</p>
<p>Així doncs, els passos seran els següents:</p>
<ol type="1">
<li><p>Actualitzar primer el sistema operatiu:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> aptitude update <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> aptitude upgrade</span></code></pre></div></li>
<li><p>Instal·lar JDK6 (si no estava instal·lat prèviament:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> aptitude install openjdk-6-jdk</span></code></pre></div></li>
<li><p>Configurar JDK6 o JDK7 com a versió per defecte, i així disposar de les dues versions instal·lades en el sistema, deixant la desitjada com a versió per defecte de línia d’ordres:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> update-alternatives <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--config</span> java</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> update-alternatives <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--config</span> javac</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> update-alternatives <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--config</span> javadoc</span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> update-alternatives <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--config</span> javap</span>
<span id="cb4-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> update-alternatives <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--config</span> javah</span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> update-alternatives <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--config</span> javaws</span></code></pre></div>
<p>Si vostè desitja deixar JDK6 com a versió per defecte per compilar programes en línia d’ordres, només cal que així ho indiqui. Podrà comprovar quina és la versió configurada fent:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-version</span></span></code></pre></div></li>
<li><p>Instal·lar BaseX:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> aptitude install basex</span></code></pre></div></li>
<li><p>Descarregar la base de dades de mostra <strong>MONDIAL</strong> (<em>The MONDIAL Database</em>) en format XML:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> http://www.dbis.informatik.uni-goettingen.de/Mondial/mondial.xml</span></code></pre></div></li>
<li><p>Obrir BaseX en mode gràfic:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">basexgui</span></span></code></pre></div></li>
<li><p>Crear una base de dades nova a partir de l’arxiu <code>mondial.xml</code> descarregat i amb nom “<code>mondial</code>”</p></li>
</ol>
<p>En aquest moment ja disposa de les eines necessàries per poder aprendre XPath/XQuery</p>
<p>Ara pot veure com és la base de dades amb què farem proves, tot recorrent-la gràficament amb l’aplicació i observant el document associat. Observi que quan se selecciona una branca de l’arbre XML, només aquella part serà mostrada en el visor de text i quedarà marcat en el visor gràfic.</p>
</section>
<section id="consultes-xpath" class="level2">
<h2 class="anchored" data-anchor-id="consultes-xpath">3. Consultes XPath</h2>
<p><strong>XPath</strong> és, com s’ha dit, un llenguatge de consultes senzill que permet recórrer l’arbre XML de manera descendent i filtrar els elements (nodes) pels quals passem en aquest recorregut amb diversos criteris.</p>
<p>En aquest sentit, el resultat d’una consulta XPath és, en termes generals, un document XML. Aquest resultat és la col·lecció de nodes i elements que hagin “<em>sobreviscut</em>” a aquest recorregut i filtrat descendent.</p>
<section id="recorregut-de-larbre-xml" class="level3">
<h3 class="anchored" data-anchor-id="recorregut-de-larbre-xml">3.1. Recorregut de l’arbre XML</h3>
<p>La forma bàsica d’una sentència XPath s’assembla molt a la d’un camí de disc, on els <em>directoris</em> són els nodes presents al XML.</p>
<p>El node arrel es representa com a <code>//</code>. A partir d’aquí, podem incloure un camí concret descendent per l’arbre XML, tot filtrant què volem que quedi en el resultat.</p>
<p>Vegem alguns exemples:</p>
<ol type="1">
<li><p>Tot l’arbre del document:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1">//mondial</span></code></pre></div>
<p>El resultat serà tota la base de dades sencera.</p></li>
<li><p>Tots els nodes del document:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1">//*</span></code></pre></div>
<p>El resultat, tot i semblar el mateix, conceptualment és un altre: tots els nodes que es trobin penjant de l’arrel (que en aquest cas coincideix).</p></li>
<li><p>Tots l’arbre del document si el document és un altre:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1">doc('/Users/felix/Desktop/curset/biblio.xml')//biblioteca</span></code></pre></div>
<p>Observi que és possible especificar un arxiu determinat mitjançant la funció <code>doc()</code>. XPath presenta algunes funcions interessants que anirem descobrint al llarg dels exemples.</p>
<p>Observi també com s’ha indicat el node arrel i el node <code>biblioteca</code> que és l’element inicial del XML utilitzat a l’exemple.</p></li>
<li><p>Informació dels diferents continents:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb12-1">//mondial/continent</span></code></pre></div></li>
<li><p>Extreure només els noms dels continents:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1">//mondial/continent/name</span></code></pre></div></li>
<li><p>El nom de tots els països que apareixen a la base de dades:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb14-1">//mondial/country/name</span></code></pre></div>
<p>Vegi com el resultat ha estat l’extracció de tots els nodes <code>name</code> que pengin d’un node <code>country</code>, que pengin directament de <code>mondial</code>. Entengui que el resultat és un XML i que hem eliminat altres <em>camins</em> de l’arbre en baixar per aquesta branca, però que en cap cas hem dit que ens quedem en un o un altre país (no s’ha fet filtrat). És per això que veurà els noms de <strong>tots</strong> els països. És com si baixéssim en paral·lel per totes les branques que compleixin el camí indicat.</p></li>
<li><p>Només els noms en format text (entrant en el text del <em>tag</em>):</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1">//mondial/continent/name/text()</span></code></pre></div>
<p>Aquesta funció fa que només quedi el text que és contingut dins dels nodes que han arribat a aquell punt (nodes <code>name</code>). Com que BaseX no gestiona el formatat, veurem el text tot seguit, però en realitat el que tenim és una col·lecció (llista) de cadenes de text.</p></li>
<li><p>Informació millor presentada:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb16-1">string-join(//mondial/continent/name/text(), ', ')</span></code></pre></div>
<p>Aquesta funció uneix la llista de texts obtinguda posant caràcters de coma entre cada parell, retornant una única cadena de text de resultat.</p></li>
<li><p>Llistat de conceptes presents a la base de dades:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1">distinct-values(//mondial/*/node-name())</span></code></pre></div>
<p>Observem diversos punts a comentar aquí:</p>
<ul>
<li><p>Per una banda, el caràcter <code>*</code> farà de comodí per indicar que en aquest punt estem baixant un nivell dins del XML, però no ens importa com es digui en node concret per on baixem aquest nivell. I pensi que estem indicant que s’ha de baixar un i només un nivell. <strong>No representa una quantitat arbitrària de nivells, sinó que no ens importa com es digui <em>el</em> nivell</strong>.</p></li>
<li><p>Tot i que no ens importa quin node baixem, igualment volem aplicar-hi una funció. En concret, la funció <code>node-name()</code> retorna el nom del node del node en què estiguem situats. Així doncs, si hem baixat per <code>country</code>, el nom serà “country”, i si hem baixat per <code>river</code>, serà “river”.</p></li>
<li><p>El <code>distinct-values()</code> és necessari per eliminar duplicats en el resultat obtingut, fent que només es mostri una vegada cadascun dels conceptes trobats.</p></li>
</ul></li>
</ol>
</section>
<section id="filtrat-de-nodes" class="level3">
<h3 class="anchored" data-anchor-id="filtrat-de-nodes">3.2. Filtrat de nodes</h3>
<p>Quan volem filtrar nodes en l’arbre, ho farem indicant entre claudàtors <code>[]</code> una expressió que representi un criteri de filtrat. Quan l’expressió indicada es compleixi, aquell node “<em>passarà</em>” el filtre i romandrà al resultat de la consulta.</p>
<p>Els filtres podem posar-los en qualsevol node d’un recorregut descendent com els vistos fins ara, de tal manera que podem combinar filtres diferents en nivells diferents del nostre recorregut.</p>
<p>Observi el següent exemple:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb18-1">//mondial/country[name='Spain']/province[name='Catalonia']/city/name</span></code></pre></div>
<p>En aquest cas, el recorregut que fem és, en realitat, <code>//mondial/country/province/city/name</code>. És a dir, baixem pels nodes de l’arbre XML fins al nom de les ciutats de les províncies dels països.</p>
<p>Però no volem tots els països, així que afegim el filtre sobre el nom del país en el nivell de <code>country</code>. El criteri és clar: Només volem aquell país que es diu “<em>Spain</em>”. Un cop aquest filtrat s’hagi efectuat, només quedarà un node país per baixar i continuarà el processament del camí.</p>
<p>En el nivell de província, tornem a aplicar un filtre sobre el nom de la província, de manera que només quedi aquella amb nom “<em>Catalonia</em>”.</p>
<p>Ara bé, observi que, en realitat, el filtre ha fet un descens per l’arbre XML paral·lel al que s’estava fent per obtenir la informació resultant. Quan indiquem que miri el <code>name</code> en els dos casos, s’està baixant a aquell node per comprovar si es compleix o no. I, de fet, podríem baixar més d’un nivell si volguéssim.</p>
<p>A més, podem també filtrar pel valor d’un atribut d’un node, posant el signe <code>@</code> davant del nom de l’atribut.</p>
<p>Els operadors que podem utilitzar per escriure aquests filtres són els següents:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Operador</th>
<th style="text-align: left;">Descripció</th>
<th style="text-align: left;">Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>|</code></td>
<td style="text-align: left;">Calcula la unió de dos conjunts</td>
<td style="text-align: left;"><code>//llibres | //cds</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>+</code></td>
<td style="text-align: left;">Suma</td>
<td style="text-align: left;"><code>6 + 4</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>-</code></td>
<td style="text-align: left;">Resta</td>
<td style="text-align: left;"><code>6 - 4</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>*</code></td>
<td style="text-align: left;">Multiplicació</td>
<td style="text-align: left;"><code>6 * 4</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>div</code></td>
<td style="text-align: left;">Divisió</td>
<td style="text-align: left;"><code>8 div 4</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>=</code></td>
<td style="text-align: left;">Igualtat</td>
<td style="text-align: left;"><code>preu=9.80</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>!=</code></td>
<td style="text-align: left;">Diferent</td>
<td style="text-align: left;"><code>preu!=9.80</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&lt;</code></td>
<td style="text-align: left;">Menor que</td>
<td style="text-align: left;"><code>preu&lt;9.80</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>&lt;=</code></td>
<td style="text-align: left;">Menor o igual</td>
<td style="text-align: left;"><code>preu&lt;=9.80</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&gt;</code></td>
<td style="text-align: left;">Major que</td>
<td style="text-align: left;"><code>preu&gt;9.80</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>&gt;=</code></td>
<td style="text-align: left;">Major o igual</td>
<td style="text-align: left;"><code>preu&gt;=9.80</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>or</code></td>
<td style="text-align: left;">o</td>
<td style="text-align: left;"><code>preu=9.80 or preu=9.70</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>and</code></td>
<td style="text-align: left;">i</td>
<td style="text-align: left;"><code>preu&gt;9.00 and preu&lt;9.90</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>mod</code></td>
<td style="text-align: left;">Mòdul (residu)</td>
<td style="text-align: left;"><code>5 mod 2</code></td>
</tr>
</tbody>
</table>
<p>Vegem ara uns quants exemples:</p>
<ol type="1">
<li><p>Informació específica d’un país, cercada pel valor d’un node fill:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1">//mondial/country[name='Spain']</span></code></pre></div>
<p>Això funciona perquè dins del <em>tag</em> <code>&lt;country&gt;</code> hi ha un altre anomenat <code>&lt;name&gt;</code> amb el text corresponent al nom del país.</p></li>
<li><p>Informació específica d’un país, cercada a través d’un atribut:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb20-1">//mondial/country[@car_code='E']</span></code></pre></div></li>
<li><p>Nom dels rius que consten a Espanya</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb21-1">//mondial/river[@country="E"]/name</span></code></pre></div></li>
<li><p>Llistat dels països amb més de 50 milions d’habitants:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb22-1">//mondial/country[population&gt;50000000]/name</span></code></pre></div></li>
<li><p>Diferents formes de govern dels països amb més de 50 milions d’habitants:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1">distinct-values(//mondial/country[population&gt;50000000]/government)</span></code></pre></div></li>
<li><p>Quantitat de països a la base de dades:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb24-1">count(//mondial/country)</span></code></pre></div>
<p>Aquí veu que existeixen funcions d’agregació com <code>count()</code>, <code>sum()</code>, <code>max()</code>, etc. Vegi la llista de funcions al final de l’article.</p></li>
<li><p>Quantitat de ciutats espanyoles:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1">count(//mondial/country[name='Spain']/province/city)</span></code></pre></div></li>
<li><p>Quantitat de diferents formes de govern dels països de més de 50 milions d’habitants:</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb26-1">count(distinct-values(//mondial/country[population&gt;50000000]/government))</span></code></pre></div></li>
<li><p>Nom de les ciutats espanyoles:</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb27-1">//mondial/country[name='Spain']/province/city/name</span></code></pre></div></li>
<li><p>Ciutats espanyoles amb més de 200.000 habitants:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb28-1">//mondial/country[name='Spain']/province/city[population&gt;200000]/name</span></code></pre></div></li>
<li><p>Noms de província espanyoles:</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb29-1">//mondial/country[name='Spain']/province/name</span></code></pre></div></li>
<li><p>Països d’Europa:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb30-1">//mondial/country[encompassed/@continent='europe']/name</span></code></pre></div>
<p>O també:</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb31-1">//mondial/country[encompassed[@continent='europe']]/name</span></code></pre></div>
<p>I és que podem aplicar filtres sobre filtres!</p></li>
<li><p>Rius de països europeus:</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb32-1">//mondial/river[@country=//mondial/country[encompassed/@continent='europe']/@car_code]/name</span></code></pre></div>
<p>I és que podem fer també subconsultes!</p></li>
<li><p>Rius europeus amb una longitud de, com a mínim, la meitat de longitud que el riu més llarg de tot el mon:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb33-1">//mondial/river[</span>
<span id="cb33-2">    @country=//mondial/country[encompassed/@continent='europe']/@car_code </span>
<span id="cb33-3">    and </span>
<span id="cb33-4">    length&gt;=max(//mondial/river/length) div 2</span>
<span id="cb33-5">]/name</span></code></pre></div>
<p>Observi com, per filtrar els rius europeus, s’ha fet que el codi de país sigui un dels presents a la llista de la subconsulta de països europeus. La igualtat com a condició és, en realitat, com un <code>IN</code> de SQL. És a dir, si un dels dos elements és una llista, el que fa és buscar el valor <em>dins</em> de la llista.</p></li>
<li><p>La quantitat d’habitants de la ciutat espanyola amb més habitants:</p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb34-1">max(//mondial/country[name='Spain']/province/city/population)</span></code></pre></div></li>
<li><p>La ciutat espanyola amb més habitants:</p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb35-1">//mondial/country[name='Spain']/province/city[population=max(</span>
<span id="cb35-2">    //mondial/country[name='Spain']/province/city/population)]/name</span></code></pre></div>
<p>O també:</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb36-1">//mondial/country[name='Spain']/province/city[population=max(</span>
<span id="cb36-2">    ../../province/city/population)]/name</span></code></pre></div>
<p>Observi’s que estem fent una subconsulta i que la subconsulta pot ser relativa al punt on s’aplica el filtrat (segon cas).</p></li>
<li><p>Rius amb nom començat amb la lletra ‘G’):</p>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb37-1">//mondial/river[matches(name,'^G.*')]/name</span></code></pre></div>
<p>La funció <code>matches(text, expressió_regular)</code> permet verificar expressions contra expressions regulars estàndard (tipus <code>grep</code>).</p></li>
<li><p>Nom de totes les ciutats de més d’un milió habitants (independentment de si el país està subdividit en províncies o no):</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb38-1">//mondial/country/descendant::city[population&gt;1000000]/name</span></code></pre></div>
<p>L’operador <code>descendant::node</code> indica explorar tots i cadascun dels camins inferiors que continguin el node indicat, independentment del seu nivell dins de l’arbre. Així doncs, ens permet buscar un node fill per sota d’un punt de l’arbre quan no sabem en quin nivell de profunditat es troba.</p></li>
</ol>
<p>Amb tot, pot comprovar que les consultes que es poden arribar a escriure cobriran gran part dels requeriments d’extracció d’informació que necessitarem per construir vistes d’usuari. Això ja ens està bé, però de tant en tant ens trobem amb casos específics que requereixen d’alguna cosa més que el recorregut descendent amb filtrat.</p>
</section>
<section id="resum-de-funcions-xpathxquery-agrupades-per-concepte" class="level3">
<h3 class="anchored" data-anchor-id="resum-de-funcions-xpathxquery-agrupades-per-concepte">3.3. Resum de funcions XPath/XQuery agrupades per concepte</h3>
<p>Quant a les funcions presentades ara, tingui present que algunes poden aplicar-se sobre el node actual, mentre que d’altres només accepten el pas per argument. No s’ha indicat aquí quin cas és cadascun per reduir la complexitat del llistat, tot i que els casos en què s’aplica un o l’altre cas són en general força evidents. Per exemple: <code>//biblioteca/llibre[position()&gt;3]/text()</code></p>
<p><strong>Funcions sobre els accessors:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:node-name(node)</code></td>
<td style="text-align: left;">Retorna el nom del node indicat</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:nilled(node)</code></td>
<td style="text-align: left;">Retorna cert si el node és nul</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:data(item.item,...)</code></td>
<td style="text-align: left;">Pren una seqüència i retorna la seqüència de valors atòmics</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:base-uri(node)</code></td>
<td style="text-align: left;">Retorna el valor de la propietat <code>base-uri</code> del node indicat</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:document-uri(node)</code></td>
<td style="text-align: left;">Retorna el valor de la propietat <code>document-uri</code> del node indicat</td>
</tr>
</tbody>
</table>
<p><strong>Funcions d’error i traça:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:error([error[,descripció[,objecte-error]]])</code></td>
<td style="text-align: left;">Genera i retorna un error</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:trace(valor,etiqueta)</code></td>
<td style="text-align: left;">Usat per depurar consultes</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre valors numèrics:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:number(arg)</code></td>
<td style="text-align: left;">Retorna el valor numèric de l’argument</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:abs(num)</code></td>
<td style="text-align: left;">Retorna el valor absolut</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:ceiling(num)</code></td>
<td style="text-align: left;">Retorna l’enter més petit que és major o igual a l’argument</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:floor(num)</code></td>
<td style="text-align: left;">Retorna l’enter més gran que és menor o igual a l’argument</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:round(num)</code></td>
<td style="text-align: left;">Arrodoneix a l’enter més proper</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:round-half-to-even(num)</code></td>
<td style="text-align: left;">Arrodoneix a l’enter més proper que sigui parell</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre valors de text:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:string(arg)</code></td>
<td style="text-align: left;">Retorna el valor de text de l’argument</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:codepoints-to-string(int,int,...)</code></td>
<td style="text-align: left;">Retorna una cadena a partit d’una seqüència de codis numèrics de caràcter</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:string-to-codepoints(string)</code></td>
<td style="text-align: left;">Retorna la seqüència de codis de caràcter corresponent a la cadena</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:codepoint-equal(comp1,comp2)</code></td>
<td style="text-align: left;">Cert si els texts són iguals segons Unicode</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:compare(comp1,comp2[,joc_caracters])</code></td>
<td style="text-align: left;">Compara les cadenes seguint el joc de caràcters indicat. Retorna -1, 0 o 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:concat(string,string)</code></td>
<td style="text-align: left;">Retorna la concatenació de les cadenes</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:string-join(seqüència,sep)</code></td>
<td style="text-align: left;">Retorna una cadena que conté els ítems indicats amb el separador indicat</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:substring(string,inici[,long])</code></td>
<td style="text-align: left;">Treu una subcadena d’una cadena</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:string-length(string)</code></td>
<td style="text-align: left;">Retorna la quantitat de caràcters de la cadena</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:normalize-space(string)</code></td>
<td style="text-align: left;">Elimina espais sobrants de la cadena (inicial, final i repetits)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:normalize-unicode()</code></td>
<td style="text-align: left;">Normalitza seguint les normes Unicode</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:upper-case(string)</code></td>
<td style="text-align: left;">Converteix la cadena a majúscules</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:lower-case(string)</code></td>
<td style="text-align: left;">Converteix la cadena a minúscules</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:translate(string1,string2,string3)</code></td>
<td style="text-align: left;">Substitueix en <code>string1</code> cada caràcter de <code>string2</code> pel corresponent de <code>string3</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:escape-uri(string,esc-res)</code></td>
<td style="text-align: left;">Escapa la cadena seguint les normes per a URIs</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:contains(string1,string2)</code></td>
<td style="text-align: left;">Retorna cert si la primera cadena conté el text de la segona</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:starts-with(string1,string2)</code></td>
<td style="text-align: left;">Retorna cert si la primera cadena comença amb el text de la segona</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:ends-with(string1,string2)</code></td>
<td style="text-align: left;">Retorna cert si la primera cadena acaba amb el text de la segona</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:substring-before(string1,string2)</code></td>
<td style="text-align: left;">Extreu la part prèvia de la primera cadena respecte on apareix la segona</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:substring-after(string1,string2)</code></td>
<td style="text-align: left;">Extreu la part posterior de la primera cadena respecte on apareix la segona</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:matches(string,regexp)</code></td>
<td style="text-align: left;">Retorna cert si la cadena compleix l’expressió regular indicada</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:replace(string,regexp,replace)</code></td>
<td style="text-align: left;">Substitueix les troballes de l’expressió regular per la cadena de substitució</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:tokenize(string,regexp)</code></td>
<td style="text-align: left;">Retalla la cadena utilitzant l’expressió regular com a recerca de separador</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre URIs:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:resolve-uri(relative,base)</code></td>
<td style="text-align: left;">Resol la URI a partir de la base i la part relativa</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre valors booleans:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:boolean(arg)</code></td>
<td style="text-align: left;">Retorna el valor booleà de l’argument indicat</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:not(arg)</code></td>
<td style="text-align: left;">Avalua el contrari de l’argument</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:true()</code></td>
<td style="text-align: left;">És el valor cert</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:false()</code></td>
<td style="text-align: left;">És el valor fals</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre valors data-hora i intervals:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:dateTime(date,time)</code></td>
<td style="text-align: left;">Converteix els arguments en una data i hora</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:years-from-duration(dur)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els anys de l’interval</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:months-from-duration(dur)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els mesos de l’interval</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:days-from-duration(dur)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els dies de l’interval</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:hours-from-duration(dur)</code></td>
<td style="text-align: left;">Retorna l’enter que representa les hores de l’interval</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:minutes-from-duration(dur)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els minuts de l’interval</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:seconds-from-duration(dur)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els segons de l’interval</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:years-from-dateTime(datetime)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els anys de la data/hora</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:months-from-dateTime(datetime)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els mesos de la data/hora</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:days-from-dateTime(datetime)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els dies de la data/hora</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:hours-from-dateTime(datetime)</code></td>
<td style="text-align: left;">Retorna l’enter que representa les hores de la data/hora</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:minutes-from-dateTime(datetime)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els minuts de la data/hora</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:seconds-from-dateTime(datetime)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els segons de la data/hora</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:timezone-from-dateTime(datetime)</code></td>
<td style="text-align: left;">Retorna el fus horari de la data/hora</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:years-from-date(date)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els anys de la data</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:months-from-date(date)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els mesos de la data</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:days-from-date(date)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els dies de la data</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:timezone-from-date(date)</code></td>
<td style="text-align: left;">Retorna el fus horari de la data</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:hours-from-time(time)</code></td>
<td style="text-align: left;">Retorna l’enter que representa les hores de la hora</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:minutes-from-time(time)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els minuts de la hora</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:seconds-from-time(time)</code></td>
<td style="text-align: left;">Retorna l’enter que representa els segons de la hora</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:timezone-from-time(time)</code></td>
<td style="text-align: left;">Retorna el fus horari de la hora</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:adjust-dateTime-to-timezone(datetime,timezone)</code></td>
<td style="text-align: left;">Associa el fus horari a la data/hora</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:adjust-date-to-timezone(datetime,timezone)</code></td>
<td style="text-align: left;">Associa el fus horari a la data</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:adjust-time-to-timezone(datetime,timezone)</code></td>
<td style="text-align: left;">Associa el fus horari a la hora</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre nodes:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:name(nodeset)</code></td>
<td style="text-align: left;">Retorna el nom del primer node del conjunt</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:local-name(nodeset)</code></td>
<td style="text-align: left;">Retorna el nom del primer node del conjunt sense el prefix del <em>namespace</em></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:namespace-uri(nodeset)</code></td>
<td style="text-align: left;">Retorna el URI del <em>namespace</em> del primer node del conjunt</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:lang(lang)</code></td>
<td style="text-align: left;">Retorna cert si l’idioma del node actual correspon a l’especificat. S’indica com a text (<code>"en"</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:root(node)</code></td>
<td style="text-align: left;">Retorna el node arrel de l’arbre a què pertany el node indicat</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre seqüències:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:index-of(seqüència, item)</code></td>
<td style="text-align: left;">Retorna la posició de l’element cercat a la seqüència de recerca</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:remove(seqüència, pos)</code></td>
<td style="text-align: left;">Elimina l’element situat a la posició indicada</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:empty(seqüència)</code></td>
<td style="text-align: left;">Retorna cert si l’argument és una seqüència buida</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:exists(seqüència)</code></td>
<td style="text-align: left;">Retorna cert si l’argument no és una seqüència buida</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:distinct-values(seqüència)</code></td>
<td style="text-align: left;">Retorna la seqüència neta de duplicats</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:insert-before(seqüència,pos,item)</code></td>
<td style="text-align: left;">Insereix l’element indicat just abans de la posició especificada</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:reverse(seqüència)</code></td>
<td style="text-align: left;">Inverteix l’ordre dels elements de la seqüència</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:subsequence(seqüència,pos,len)</code></td>
<td style="text-align: left;">Extreu part d’una seqüència</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:unordered(seqüència)</code></td>
<td style="text-align: left;">Retorna els elements en un ordre dependent de la implementació</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre cardinalitat de seqüències:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:zero-or-one(seqüència)</code></td>
<td style="text-align: left;">Retorna l’argument si conté zero o un element</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:one-or-more(seqüència)</code></td>
<td style="text-align: left;">Retorna l’argument si conté un element com a mínim</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:exactly-one(seqüència)</code></td>
<td style="text-align: left;">Retorna l’argument si conté exactament un sol element</td>
</tr>
</tbody>
</table>
<p><strong>Funcions d’igualtat de seqüències:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:deep-equal(param1,param2)</code></td>
<td style="text-align: left;">Retorna cert si els arguments són exactament iguals dins de les seves jerarquies</td>
</tr>
</tbody>
</table>
<p><strong>Funcions d’agregació:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:count(seqüència)</code></td>
<td style="text-align: left;">Retorna la quantitat d’elements</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:avg(seqüència)</code></td>
<td style="text-align: left;">Retorna el valor mitjà dels elements de la seqüència</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:max(seqüència)</code></td>
<td style="text-align: left;">Retorna el valor màxim dels elements de la seqüència</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:min(seqüència)</code></td>
<td style="text-align: left;">Retorna el valor mínim dels elements de la seqüència</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:sum(seqüència)</code></td>
<td style="text-align: left;">Retorna el total de sumar els elements de la seqüència</td>
</tr>
</tbody>
</table>
<p><strong>Funcions sobre contexts:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fn:position()</code></td>
<td style="text-align: left;">Retorna l’índex de l’element en el seu entorn</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:last()</code></td>
<td style="text-align: left;">Retorna l’índex de l’últim element en el seu entorn</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:current-dateTime()</code></td>
<td style="text-align: left;">Retorna la data/hora actual</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:current-date()</code></td>
<td style="text-align: left;">Retorna la data actual</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:current-time()</code></td>
<td style="text-align: left;">Retorna la hora actual</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:implicit-timezone()</code></td>
<td style="text-align: left;">Retorna el fus horari implícit</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fn:default-collation()</code></td>
<td style="text-align: left;">Retorna el joc de caràcters actual</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fn:static-base-uri()</code></td>
<td style="text-align: left;">Retorna el valor de <code>base-uri</code> actual</td>
</tr>
</tbody>
</table>
<p>Les funcions matemàtiques científiques estan definides en el <em>namespace</em> <code>math</code>, i per tant, quan són invocades, cal esmentar-ho explícitament. Per exemple: <code>math:sqrt(42)</code>.</p>
<p><strong>Funcions matemàtiques científiques:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>math:pi()</code></td>
<td style="text-align: left;">Representa una aproximació al valor de <img src="https://latex.codecogs.com/png.latex?%5Cpi"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>math:exp(x)</code></td>
<td style="text-align: left;">Retorna el valor de <img src="https://latex.codecogs.com/png.latex?e%5Ex"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>math:exp10(x)</code></td>
<td style="text-align: left;">Retorna el valor de <img src="https://latex.codecogs.com/png.latex?10%5Ex"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>math:log(x)</code></td>
<td style="text-align: left;">Retorna el logaritme natural de l’argument</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>math:log10(x)</code></td>
<td style="text-align: left;">Retorna el logaritme en base 10 de l’argument</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>math:pow(x,y)</code></td>
<td style="text-align: left;">Retorna el valor de <img src="https://latex.codecogs.com/png.latex?x%5Ey"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>math:sqrt(x)</code></td>
<td style="text-align: left;">Retorna l’arrel quadrada de l’argument</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>math:sin(x)</code></td>
<td style="text-align: left;">Retorna el sinus de l’angle subministrat</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>math:cos(x)</code></td>
<td style="text-align: left;">Retorna el cosinus de l’angle subministrat</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>math:tan(x)</code></td>
<td style="text-align: left;">Retorna la tangent de l’angle subministrat</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>math:asin(x)</code></td>
<td style="text-align: left;">Retorna l’angle aplicant la funció inversa del sinus</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>math:acos(x)</code></td>
<td style="text-align: left;">Retorna l’angle aplicant la funció inversa del cosinus</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>math:atan(x)</code></td>
<td style="text-align: left;">Retorna l’angle aplicant la funció inversa de la tangent</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>math:atan2(y,x)</code></td>
<td style="text-align: left;">Retorna l’angle aplicant la funció inversa de la tangent sobre (y/x)</td>
</tr>
</tbody>
</table>
<p>Els tipus de dades presents a XPath/XQuery són: <code>xs:float</code>, <code>xs:double</code>, <code>xs:decimal</code>, <code>xs:integer</code>, <code>xs:long</code>, <code>xs:int</code>, <code>xs:short</code>, <code>xs:byte</code>, <code>xs:unsignedLong</code>, <code>xs:unsignedInt</code>, <code>xs:unsignedShort</code>, <code>xs:unsignedByte</code>, <code>xs:duration</code>, <code>xs:dateTime</code>, <code>xs:date</code>, <code>xs:time</code>, entre d’altres</p>
<p>Per a l’especificació d’arguments de les funcions, poden utilitzar-se els elements addicionals a més dels tipus de dades presentats:</p>
<p><strong>Especificació d’elements en arguments de funcions:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Tipus d’element</th>
<th style="text-align: left;">Permet</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>node()</code></td>
<td style="text-align: left;">Qualsevol node</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>element()</code></td>
<td style="text-align: left;">Qualsevol element de node</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>element(nom)</code></td>
<td style="text-align: left;">L’element de node amb el nom indicat</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>attribute()</code></td>
<td style="text-align: left;">Qualsevol atribut de node</td>
</tr>
</tbody>
</table>
<p>I pot indicar-se també la cardinalitat dels arguments:</p>
<p><strong>Indicadors de cardinalitat per als arguments:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Indicador</th>
<th style="text-align: left;">Significat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cap (blanc)</td>
<td style="text-align: left;">exactament un element</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>?</code></td>
<td style="text-align: left;">Zero o un element</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>+</code></td>
<td style="text-align: left;">Un o més elements</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>*</code></td>
<td style="text-align: left;">Qualsevol quantitat d’elements (zero o més)</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="consultes-flwor-xquery" class="level2">
<h2 class="anchored" data-anchor-id="consultes-flwor-xquery">4. Consultes FLWOR (XQuery)</h2>
<p>XQuery ofereix un mecanisme de consultes més avançat que es munta sobre XPath. En concret, quan treballem amb XQuery, treballem amb la construcció <code>FLWOR</code>:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>FLWOR (XQuery) <code>FLWOR</code> = <code>for</code> - <code>let</code> - <code>where</code> - <code>order by</code> - <code>return</code></p>
</div>
</div>
<p>Aquestes construccions permeten fer el recorregut per un arbre XML i executar alguna tasca sobre cadascun dels elements trobats, incloent l’aplicació de filtrat i càlcul d’expressions. A més, incorpora la possibilitat d’aplicar ordenació dels resultats.</p>
<p>Un FLWOR, com a mínim, ha de contenir el iterador de bucle <code>for</code> i un <code>return</code> per obtenir algun resultat. Els altres tres elements (<code>let</code>, <code>where</code> i <code>order by</code> són opcionals).</p>
<p>Analitzem les diferents parts:</p>
<ul>
<li><p>Amb la clàusula <code>for</code> especifiquem el conjunt d’elements que volem recórrer. La notació és:</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb39-1">for $variable in //...consulta...XPath...</span></code></pre></div>
<p>Per tant, indiquem quina variable volem utilitzar per emmagatzemar els diferents elements trobats i la consulta XPath que ens generi la llista d’elements. Aquí podem posar una consulta XPath tant complexa com les vistes fins ara.</p></li>
<li><p>Amb la clàusula <code>let</code> podem indicar assignacions i càlculs en forma d’expressions avaluades. Normalment s’utilitza sintaxi XPath i podem utilitzar la variable de bucle o variables definides amb <code>let</code>. Podem disposar més d’un <code>let</code> si així ho volem.</p>
<p>Per exemple:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb40-1">for $pais in //mondial/country</span>
<span id="cb40-2">    let $num_ciutats := count($pais/descendant::city)</span>
<span id="cb40-3">    let $tot_pobl := sum($pais/descendant::city/population)</span>
<span id="cb40-4">    let $percent := $tot_pobl div $pais/population</span>
<span id="cb40-5">    ...</span></code></pre></div></li>
<li><p>Amb la clàusula <code>where</code> afegirem filtres sobre la llista d’iteració, de manera que els elements del <code>for</code> que no compleixin la condició del <code>where</code> seran omesos en el bucle:</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb41-1">for $pais in //mondial/country</span>
<span id="cb41-2">    let $num_ciutats := count($pais/descendant::city)</span>
<span id="cb41-3">    let $tot_pobl := sum($pais/descendant::city/population)</span>
<span id="cb41-4">    let $percent := $tot_pobl div $pais/population</span>
<span id="cb41-5">    where $pais/encompassed/@continent='europe'</span>
<span id="cb41-6">    ...</span></code></pre></div></li>
<li><p>Amb la clàusula <code>order by</code> ordenem el resultat del <code>for</code>. Per tant, especifiquem l’ordre de recorregut del bucle:</p>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb42-1">for $pais in //mondial/country</span>
<span id="cb42-2">    let $nom := $pais/name/text()</span>
<span id="cb42-3">    let $num_ciutats := count($pais/descendant::city)</span>
<span id="cb42-4">    let $tot_pobl := sum($pais/descendant::city/population)</span>
<span id="cb42-5">    let $percent := $tot_pobl div $pais/population * 100</span>
<span id="cb42-6">    where $pais/encompassed/@continent='europe'</span>
<span id="cb42-7">    order by $percent ascending</span>
<span id="cb42-8">    ...</span></code></pre></div></li>
<li><p>Amb la clàusula <code>return</code> indicarem què s’ha de mostrar com a resultat com a <strong>resposta a cada iteració</strong> (<strong>no</strong> a tot el bucle). El resultat ha de ser un únic node XML o una primitiva bàsica (com una cadena o un enter) per a cada iteració executada. El <code>return</code> s’executarà, per tant, <em>n</em> vegades:</p>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb43-1">for $pais in //mondial/country</span>
<span id="cb43-2">    let $nom := $pais/name/text()</span>
<span id="cb43-3">    let $num_ciutats := count($pais/descendant::city)</span>
<span id="cb43-4">    let $tot_pobl := sum($pais/descendant::city/population)</span>
<span id="cb43-5">    let $percent := $tot_pobl div $pais/population * 100</span>
<span id="cb43-6">    where $pais/encompassed/@continent='europe'</span>
<span id="cb43-7">    order by $percent ascending</span>
<span id="cb43-8">    return &lt;pais&gt; {$nom} : {$percent} &lt;/pais&gt;</span></code></pre></div></li>
</ul>
<p>Vegem ara tot un seguit d’exemples de XQuery que demostren algunes particularitats destacables:</p>
<ol type="1">
<li><p>Nom de les províncies espanyoles:</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb44-1">for $p in //mondial/country[name='Spain']/province</span>
<span id="cb44-2">    return $p/name</span></code></pre></div></li>
<li><p>Extracció de la llista de ciutats de cada província espanyola:</p>
<div class="sourceCode" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb45-1">for $p in //mondial/country[name='Spain']/province</span>
<span id="cb45-2">    let $nom := $p/name/text()</span>
<span id="cb45-3">    let $ciutats := string-join($p/city/name, ', ')</span>
<span id="cb45-4">    return &lt;provincia&gt; {$nom}: {$ciutats} &lt;/provincia&gt;</span></code></pre></div></li>
<li><p>Llista dels països que tenen més d’un 1% de la població mundial total, ordenats per població descendent i mostrant els resultats en format XML:</p>
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb46-1">for $c in //mondial/country</span>
<span id="cb46-2">    let $n := $c/name/text()</span>
<span id="cb46-3">    let $p := $c/population/text()</span>
<span id="cb46-4">    where $p&gt;=sum(//mondial/country/population)*0.01</span>
<span id="cb46-5">    order by number($p) descending</span>
<span id="cb46-6">    return &lt;pais nom='{$n}'&gt;{$p}&lt;/pais&gt;</span></code></pre></div></li>
<li><p>Nom de les províncies espanyoles, amb població i quantitat de ciutats, ordenats per quantitat de ciutats en ordre descendent, amb resultat en format XML:</p>
<div class="sourceCode" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb47-1">for $p in //mondial/country[name='Spain']/province</span>
<span id="cb47-2">    let $nom := $p/name</span>
<span id="cb47-3">    let $pop := $p/population</span>
<span id="cb47-4">    let $num := &lt;count&gt; {count($p/city)} &lt;/count&gt;</span>
<span id="cb47-5">    order by $num descending</span>
<span id="cb47-6">    return &lt;provincia&gt; {$nom} {$pop} {$num} &lt;/provincia&gt;</span></code></pre></div></li>
<li><p>Redreçament de la informació de les províncies, amb cada província amb atributs de nom i població i llista de ciutats interna, amb una entrada per a cada ciutat:</p>
<div class="sourceCode" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb48-1">for $p in //mondial/country[name='Spain']/province</span>
<span id="cb48-2">    let $nom := $p/name/text()</span>
<span id="cb48-3">    let $pop := $p/population/text()</span>
<span id="cb48-4">    let $cities := &lt;cities&gt; {</span>
<span id="cb48-5">        for $c in $p/city/name/text() </span>
<span id="cb48-6">            return &lt;city&gt; {$c} &lt;/city&gt;</span>
<span id="cb48-7">        } &lt;/cities&gt;</span>
<span id="cb48-8">    return &lt;provincia nom='{$nom}' population='{$pop}'&gt; {$cities} &lt;/provincia&gt;</span></code></pre></div></li>
</ol>
</section>
<section id="declaració-de-funcions-en-xquery" class="level2">
<h2 class="anchored" data-anchor-id="declaració-de-funcions-en-xquery">5. Declaració de funcions en XQuery</h2>
<p>És possible definir funcions pròpies per a ser utilitzades en les nostres consultes XQuery. La forma de fer-ho és mitjançant la següent sintaxi:</p>
<div class="sourceCode" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb49-1">declare function nom_de_la_funció($var1 as tipus, $var2 as tipus, ...) as tipus {</span>
<span id="cb49-2">    ...</span>
<span id="cb49-3">    codi de la funció</span>
<span id="cb49-4">    ...</span>
<span id="cb49-5">}</span></code></pre></div>
<p>XQuery accepta construccions diverses en el bloc de codi, com <code>let</code>, <code>for</code> i fins i tot estructures <code>if ... then ... else ...</code>.</p>
<p>A més, les funcions solen definir-se en un espai de funcions concret. Normalment l’espai serà el local a la consulta (espai de l’usuari). Això es fa indicant el nom de la funció amb una especificació <code>local:</code> prèvia al nom de la funció.</p>
<p>Vegem ara alguns exemples que demostren diferents situacions útils en la construcció de funcions XQuery:</p>
<ol type="1">
<li><p>Funció que calcula arrel d’índex N a partir de l’índex i el radicand:</p>
<div class="sourceCode" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb50-1">declare function local:sqrtN($i as xs:double, $r as xs:double) as xs:double {</span>
<span id="cb50-2">    let $x := math:pow($r, 1 div $i)</span>
<span id="cb50-3">    return $x</span>
<span id="cb50-4">};</span>
<span id="cb50-5">local:sqrtN(3, 125)</span></code></pre></div></li>
<li><p>Funció que retorna la primera paraula de la cadena indicada</p>
<div class="sourceCode" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb51-1">declare function local:primera-paraula($cad as xs:string) as xs:string {</span>
<span id="cb51-2">    let $paraula := substring-before($cad, ' ')</span>
<span id="cb51-3">    return $paraula</span>
<span id="cb51-4">};</span>
<span id="cb51-5">local:primera-paraula('Ola k ase')</span></code></pre></div></li>
<li><p>Funció recursiva per al factorial (i exemple de <code>if</code>)</p>
<div class="sourceCode" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb52-1">declare function local:factorial($n as xs:integer) as xs:integer {</span>
<span id="cb52-2">    if ($n&lt;=1)</span>
<span id="cb52-3">    then $n</span>
<span id="cb52-4">    else $n*local:factorial($n - 1)</span>
<span id="cb52-5">};</span>
<span id="cb52-6">local:factorial(7)</span></code></pre></div></li>
<li><p>Marge de població (diferència de població entre el país més habitat i el menys)</p>
<div class="sourceCode" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb53-1">declare function local:marge($seq as element()*) as xs:double {</span>
<span id="cb53-2">    let $a := min($seq)</span>
<span id="cb53-3">    let $b := max($seq)</span>
<span id="cb53-4">    return ($b - $a)</span>
<span id="cb53-5">};</span>
<span id="cb53-6">local:marge(//mondial/country/population)</span></code></pre></div></li>
<li><p>Quantitat de ciutats per país</p>
<div class="sourceCode" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb54-1">declare function local:numciutats($c as element(country)*) as xs:double {</span>
<span id="cb54-2">    let $n := count($c/descendant::city)</span>
<span id="cb54-3">    return $n</span>
<span id="cb54-4">};</span>
<span id="cb54-5">local:numciutats(//mondial/country[name='Spain'])</span></code></pre></div></li>
</ol>


</section>

 ]]></description>
  <category>bases de dades</category>
  <category>basex</category>
  <category>xpath</category>
  <category>xquery</category>
  <category>xnd</category>
  <guid>https://www.flx.cat/posts/2013-07-03-BD08-xnd-xpath-i-xquery/</guid>
  <pubDate>Tue, 02 Jul 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-07-03-BD08-xnd-xpath-i-xquery/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>OODBMS amb db4o i Java</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-07-02-BD07-oodbms-amb-db4o-i-java/</link>
  <description><![CDATA[ 





<section id="introducció" class="level2">
<h2 class="anchored" data-anchor-id="introducció">1. Introducció</h2>
<p>Un altre element que veurem en aquest curs és el de les bases de dades orientades a objectes. Aquestes bases de dades treballen directament sobre objectes que són portats directament entre l’aplicació i la base de dades.</p>
<p>La diferència amb el model tradicional amb mapatge objecte-relacional (o el cas de les bases de dades objecte-relacionals), és que ara l’objecte es desa <strong>tal qual</strong> a la base de dades.</p>
<p>En realitat, això no és exactament així, cada producte de base de dades orientada a objectes cobrirà aquesta funcionalitat amb algun format binari propietari o treballarà sobre la <em>serialització</em> dels objectes a emmagatzemar.</p>
<p>En el nostre cas treballarem amb <strong>db4o</strong>, un producte senzill, petit i portable que demostra una bona eficiència i rendiment i que emmagatzema els objectes en un arxiu de disc que serà la base de dades.</p>
<p>L’avantatge d’aquest producte és que és lliure, consisteix en uns arxius JAR que podem afegir als nostres projectes, i que presenta una col·lecció de funcions reduïda i útil per a realitzar les operacions CRUD bàsiques sobre els objectes que ha de manegar, a més d’oferir-nos tres mecanismes de consulta avançats:</p>
<ul>
<li><strong>QBE (<em>Query By Example</em>)</strong>: Consultes descrites en termes d’allò que s’espera obtenir.</li>
<li><strong>Native Query</strong>: Consultes utilitzant comparacions en els mateixos objectes.</li>
<li><strong>SODA</strong>: Consultes en llenguatge natiu de db4o.</li>
</ul>
<p>Més endavant s’estudiaran aquests casos. Ara vegem els elements bàsics en la programació d’una aplicació basada en db4o.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Per a la realització d’aquests apunts s’ha treballat sobre db4o en la seva versió 8.0.</p>
</div>
</div>
<section id="configuració-connexió-i-desconnexió" class="level3">
<h3 class="anchored" data-anchor-id="configuració-connexió-i-desconnexió">1.1. Configuració, connexió i desconnexió</h3>
<p>En primer lloc, l’aplicació haurà de disposar de les llibreries necessàries per a la seva completa operativa. Això implica els següents arxius:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1">ant.jar</span>
<span id="cb1-2">bloat-1.0.jar</span>
<span id="cb1-3">db4o-8.0.249.16098-all-java5.jar</span>
<span id="cb1-4">db4o-8.0.249.16098-bench.jar</span>
<span id="cb1-5">db4o-8.0.249.16098-core-java5.jar</span>
<span id="cb1-6">db4o-8.0.249.16098-cs-java5.jar</span>
<span id="cb1-7">db4o-8.0.249.16098-cs.optional-java5.jar</span>
<span id="cb1-8">db4o-8.0.249.16098-db4ounit-java5.jar</span>
<span id="cb1-9">db4o-8.0.249.16098-instrumentation-java5.jar</span>
<span id="cb1-10">db4o-8.0.249.16098-nqopt-java5.jar</span>
<span id="cb1-11">db4o-8.0.249.16098-optional-java5.jar</span>
<span id="cb1-12">db4o-8.0.249.16098-osgi-java5.jar</span>
<span id="cb1-13">db4o-8.0.249.16098-osgi-test-java5.jar</span>
<span id="cb1-14">db4o-8.0.249.16098-taj-java5.jar</span>
<span id="cb1-15">db4o-8.0.249.16098-tools-java5.jar</span></code></pre></div>
<p>Ara, una vegada disposem d’aquestes llibreries en el lloc adient, el nostre programa podrà utilitzar les funcionalitats de db4o per afegir persistència d’objectes.</p>
<p>Per connectar amb una base de dades existent (o crear-ne una de nova si no existia abans), només caldrà fer una crida com la següent:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1">ObjectContainer db <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Db4oEmbedded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">openFile</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb2-2">                        Db4oEmbedded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">newConfiguration</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span> </span>
<span id="cb2-3">                        dbFile<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>on <code>dbFile</code> representa un <code>String</code> amb el nom de l’arxiu on estigui (o vulgui crear-se) la base de dades d’objectes.</p>
<p>Quan hem acabat de fer les accions que siguin oportunes amb la base de dades, hem de tancar la base de dades mitjançant una simple crida com la següent:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1">db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">close</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>D’aquesta manera s’alliberaran tots els recursos que db4o hagi ocupat per mantenir la base de dades activa i connectada, a més de buidar al disc les últimes modificacions pendents de ser fixades.</p>
</section>
<section id="execució-de-consultes-crud" class="level3">
<h3 class="anchored" data-anchor-id="execució-de-consultes-crud">1.2. Execució de consultes CRUD</h3>
<p>Quant a l’execució de consultes, les de selecció d’objectes es faran en algun dels tres formats que s’han comentat anteriorment en aquest tema: QBE, Native Query o SODA, i que seran analitzats més endavant.</p>
<p>Com a exemple bàsic, consideri que podria tractar-se d’una sentència tant senzilla com:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> emps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">queryByExample</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>Aquest cas simplement és tota la llista de treballadors.</p>
<p>Quan a la resta d’operacions (CRUD), tingui present les següents crides:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Acció</th>
<th style="text-align: left;">Crida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Crear un objecte nou a la base de dades</td>
<td style="text-align: left;"><code>db.store(objecte);</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Actualitzar un objecte existent</td>
<td style="text-align: left;"><code>db.store(objecte);</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Eliminar un objecte existent</td>
<td style="text-align: left;"><code>db.delete(objecte);</code></td>
</tr>
</tbody>
</table>
<p>Observi que el mètode <code>store()</code> serveix tant per inserir un objecte nou com per actualitzar un d’existent.</p>
<p>Això sí, vigili quan programi amb db4o, perquè s’han de complir els següents requeriments:</p>
<ul>
<li><p>Si l’objecte és nou i volem afegir-lo, utilitzem <code>store()</code>.</p></li>
<li><p>Si l’objecte ja existia <strong>i l’havíem portat anteriorment amb alguna consulta</strong>, amb <code>store()</code> actualitzarem l’objecte de la base de dades.</p></li>
<li><p>Si l’objecte ja existia <strong>però no l’havíem inclós en cap consulta anterior</strong>, amb <code>store()</code> aquell objecte tornarà a inserir-se a la base de dades.</p></li>
<li><p>Si volem eliminar un objecte existent, abans l’haurem de portar amb alguna consulta i aleshores podrem executar <code>delete()</code>.</p></li>
</ul>
<p>Com veu, excepte en el cas d’inserir un nou objecte, les manipulacions d’objectes existents passen per que abans hagi estat inclòs en una consulta de selecció.</p>
<p>A més, db4o ens ofereix control de transaccions mitjançant les crides:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1">db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">commit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb5-2">db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rollback</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Quan es connecta amb una base de dades s’inicia automàticament una transacció, que tancarem amb una de les dues funcions esmentades. Quan es criden, aquestes funcions inicien automàticament una nova transacció.</p>
</section>
</section>
<section id="llenguatge-de-consultes-en-db4o" class="level2">
<h2 class="anchored" data-anchor-id="llenguatge-de-consultes-en-db4o">2. LLenguatge de consultes en db4o</h2>
<p>Com s’ha dit, db4o ens ofereix 3 formes d’escriure consultes de selecció d’objectes.</p>
<section id="qbe-query-by-example" class="level3">
<h3 class="anchored" data-anchor-id="qbe-query-by-example">2.1. QBE (<em>Query By Example</em>)</h3>
<p>Aquesta modalitat de consultes es fonamenta en <em>explicar-li</em> a db4o com volem que sigui el resultat obtingut. Dit d’una altra manera, passem a la consulta un objecte amb els camps assignats de manera que donin a entendre quins valors estem condicionant.</p>
<p>El cas més senzill és una consulta no filtrada, que pren la següent forma:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> depts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">queryByExample</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>Com veu, l’<em>exemple</em> és passar la classe del resultat que busquem, és a dir, tots els objectes <code>Department</code> (de la seva classe).</p>
<p>Si el que volem és filtrar per algun criteri, haurem de subministrar un objecte parcialment assignat que demostri la nostra intenció:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1">Department d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Department</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-2">d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDepartmentName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> depts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">queryByExample</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>En aquest cas s’ha configurat un <code>Department</code> que només té assignat un camp, que és el nom del departament. Això farà que, en cercar els departaments, realitzi un filtrat d’igualtat amb el valor indicat només en aquest camp.</p>
<p>Com veu, les consultes QBE són útils en casos molt bàsics, i no permetran filtrar rangs de valors o expressions avaluades més complexes.</p>
</section>
<section id="native-query" class="level3">
<h3 class="anchored" data-anchor-id="native-query">2.2. Native Query</h3>
<p>El <em>software</em> db4o ens ofereix un mecanisme força interessant per filtrar objectes amb aquest sistema anomenat <em>Native Query</em>.</p>
<p>La idea és senzilla: Estem treballant amb objectes, en un llenguatge de programació orientat a objectes, on la comprovació d’un filtratge “passa/no passa” pot ser tant senzilla com una condició <code>if</code> ben escrita.</p>
<p>Així doncs, no seria més pràctic deixar al programador escriure la funció de filtrat “passa/no passa” en el seu llenguatge d’alt nivell orientat a objectes? Native Query fa exactament això.</p>
<p>Un exemple: Suposem que volem tots els treballadors que cobrin un sou superior a 10000 o que treballin per al departament anomenat “Sales”. Amb Native Query quedarà així:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> emps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">query</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Predicate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">boolean</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> </span>
<span id="cb8-4">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getSalary</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> </span>
<span id="cb8-5">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDepartment</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDepartmentName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">equals</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span> </span>
<span id="cb8-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span></code></pre></div>
<p>És a dir, la consulta es basa en un <code>Predicate</code> sobre la classe <code>Employee</code> que passarà cadascun dels <code>Employee</code> trobats a la base de dades per la funció interna que hi és definida. Si l’objecte concret aplicat a <code>match()</code> passa la condició i retorna un <code>true</code>, aquell objecte sortirà al resultat de la consulta. Si per a l’objecte, la funció <code>match()</code> hagués retornat un <code>false</code>, aleshores serà eliminat del resultat.</p>
<p>Aquest mecanisme ens permet, amb molta facilitat, utilitzar tota la infraestructura de funcions i classes del llenguatge de programació i podrem realitzar qualsevol tasca que ens puguem imaginar o plantejar.</p>
</section>
<section id="soda" class="level3">
<h3 class="anchored" data-anchor-id="soda">2.3. SODA</h3>
<p>SODA és el mecanisme intern de db4o per executar consultes sobre les seves bases de dades. És, per tant, el llenguatge més eficient i que permet afinar més la consulta que s’executarà sobre la base de dades.</p>
<p>En el cas SODA, les consultes s’inicien afegint una restricció que indica quina és la classe buscada en la base de dades, i després s’afegeixen filtres addicionals que condicionen els objectes obtinguts com a resultat.</p>
<p>Observi el següent exemple:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Query</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">query</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb9-2">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-3">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">descend</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"King"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Veurà que s’ha utilitzat el mètode <code>descend()</code> per <em>baixar</em> a aquell atribut de l’objecte i aplicar un criteri restrictiu. En aquest cas, obtindrem els treballadors amb cognom “King”.</p>
<p>Podem aplicar restriccions d’aquest tipus sobre qualsevol tipus de dada:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Query</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">query</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-2">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-3">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">descend</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"locationId"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1700</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>I aplicar modificadors que alteren el sentit de la restricció:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb11-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Query</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">query</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb11-2">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb11-3">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">descend</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"locationId"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1700</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">not</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb11-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>A més, podrem combinar diversos <code>descend()</code> i construir consultes de selecció realment complexes:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb12-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Query</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>db<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">query</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-2">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb12-3">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">descend</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"King"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb12-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">or</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">descend</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salary"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">constrain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13000</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">greater</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb12-5">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">descend</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salary"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">orderDescending</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Observi com s’ha afegit ordenació del resultat de la consulta en aquest últim exemple.</p>


</section>
</section>

 ]]></description>
  <category>bases de dades</category>
  <category>oodbms</category>
  <category>db4o</category>
  <category>qbe</category>
  <category>soda</category>
  <guid>https://www.flx.cat/posts/2013-07-02-BD07-oodbms-amb-db4o-i-java/</guid>
  <pubDate>Mon, 01 Jul 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-07-02-BD07-oodbms-amb-db4o-i-java/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Hibernate i JPA</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-07-01-BD06-hibernate-i-jpa/</link>
  <description><![CDATA[ 





<section id="introducció-a-jpa" class="level2">
<h2 class="anchored" data-anchor-id="introducció-a-jpa">1. Introducció a JPA</h2>
<p>Hibernate ofereix una classe nova, més eficient que <code>Criteria</code>, anomenada <code>CriteriaQuery</code> que va més enllà i permet realitzar tasques complexes sobre les dades de les taules.</p>
<p>Per utilitzar la classe <code>CriteriaQuery</code> s’ha de fer servir el mòdul <strong>JPA (<em>Java Persistence API</em>)</strong> que permet associar objectes a fonts d’informació diverses (base de dades, arxius XML, etc.) en un model semblant al presentat fins ara.</p>
<p>Per utilitzar les funcionalitats de JPA combinades amb Hibernate necessitem:</p>
<ul>
<li><p>Incloure un API de JPA per accedir a les seves funcionalitats combinades amb Hibernate: Això ho podem aconseguir afegir l’arxiu <code>hibernate-entitymanager-4.1.8.Final.jar</code> al <code>CLASSPATH</code> de la nostra aplicació (disponible des de la descàrrega del API de Hibernate) o copiar-lo a un directori local de l’aplicació. En el nostre cas s’ha inclòs en el directori <code>libs</code> dels arxius de projecte.</p></li>
<li><p>Incloure un arxiu <code>persistence.xml</code> al directori <code>META-INF</code> de l’aplicació. Pot crear el directori i afegir l’arxiu amb la configuració del mòdul JPA. Vincularem aquí l’arxiu <code>hibernate.cfg.xml</code> per a què tingui en compte la configuració de Hibernate com a font d’informació per a JPA.</p></li>
<li><p>Des de l’aplicació haurem d’invocar la creació d’un <code>EntityManager</code> que gestioni les consultes amb la base de dades. Per fer-ho haurem d’executar un codi com el següent:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb1-1">EntityManagerFactory emf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb1-2">    Persistence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createEntityManagerFactory</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mngr1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb1-3">EntityManager em <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> emf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createEntityManager</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span></code></pre></div>
<p>El nom <code>mngr1</code> ha de coincidir amb aquell declarat en l’arxiu <code>persistence.xml</code> com a font de dades.</p></li>
<li><p>Aleshores podem demanar a aquest <code>EntityManager</code> que ens ofereixi un constructor de consultes <code>CriteriaBuilder</code> i que farem servir per construir consultes contra la base de dades (o l’origen de dades establert en el JPA):</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb2-2">CriteriaBuilder cb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> em<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getCriteriaBuilder</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span></code></pre></div></li>
<li><p>Per a construir una consulta de selecció amb aquesta metodologia JPA, podem executar codi com el següent:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1">CriteriaQuery<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-2">Root<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> emp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">from</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-3">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>cb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">equal</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"King"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb3-4">query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">orderBy</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>cb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">asc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>usuari<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firstname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)));</span></span>
<span id="cb3-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> em<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getResultList</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Com veu es poden afegir restriccions de tipus <code>WHERE</code> i clàusules com <code>ORDER BY</code>. De fet, es poden construir sentències extremadament complexes a partir dels diferents elements i mètodes que ofereix <code>CriteriaQuery</code>.</p></li>
<li><p>Per executar tasques DML sobre les dades, hem d’iniciar una transacció. Això es pot fer amb codi com el següent:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb4-2">em<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getTransaction</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">begin</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// operacions DML</span></span>
<span id="cb4-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb4-6">em<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getTransaction</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">commit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// ...o rollback();</span></span>
<span id="cb4-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span></code></pre></div>
<p>Per executar una consulta de modificació podem utilitzar diversos mètodes, entre els quals destaquen:</p></li>
<li><p>Consultes <strong>JPQL (<em>Java Persistence Query Language</em>)</strong>:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Query</span> q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> em<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb5-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UPDATE Employee e SET e.salary = 18000 WHERE u.lastname='Rovirosa'"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb5-3">q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">executeUpdate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div></li>
<li><p>Vincular l’objecte que reflecteix les dades (fer-lo <em>managed</em>) i modificar-lo en memòria:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1">Employee anna <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> em<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">find</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">214</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb6-2">anna<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setSalary</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18000</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div></li>
</ul>
<p>La primera operació ha importat les dades des de la base de dades a un objecte local en memòria. Qualsevol operació sobre l’objecte serà traslladada a la base de dades quan s’efectuï l’operació de <code>COMMIT</code> per finalitzar la transacció. A aquest fet s’indica que l’objecte <em>importat</em> passa a l’estat <strong><em>managed</em></strong>, indicant que a partir d’aquell moment correspon a dades <em>reals</em> de base de dades i queda vinculat a la seva font d’informació. Per això no cal realitzar tasques addicionals amb l’objecte per modificar-lo: simplement trobar-lo amb <code>find()</code>, modificar-lo i finalment fer el <code>commit()</code>.</p>
</section>
<section id="exemple-amb-jpa-hibernate" class="level2">
<h2 class="anchored" data-anchor-id="exemple-amb-jpa-hibernate">2. Exemple amb JPA + Hibernate</h2>
<p>S’ha fet una nova versió del bloc de programes de prova per demostrar l’ús de JPA combinat amb Hibernate.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple número 8</p>
</div>
</div>
<p>Podrà observar que l’estructura d’arxius és gairebé idèntica a la vista anteriorment, però ara s’incorpora el directori <code>META-INF</code> amb l’arxiu de configuració <code>persistence.xml</code> al seu interior. Aquest arxiu correspon a la configuració de JPA, i que en el nostre cas és com es mostra aquí:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>persistence.xml</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="persistence.xml" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span>
<span id="cb7-2">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">persistence</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> xmlns=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://java.sun.com/xml/ns/persistence"</span></span>
<span id="cb7-3"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">    xmlns:xsi=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
<span id="cb7-4"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">    xsi:schemaLocation=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"</span></span>
<span id="cb7-5"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">    version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span>&gt;</span>
<span id="cb7-6"></span>
<span id="cb7-7">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">persistence-unit</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mngr1"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> transaction-type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RESOURCE_LOCAL"</span>&gt;</span>
<span id="cb7-8">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">properties</span>&gt;</span>
<span id="cb7-9">            &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hibernate.ejb.cfgfile"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> value=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hibernate.cfg.xml"</span> /&gt;</span>
<span id="cb7-10">        &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">properties</span>&gt;</span>
<span id="cb7-11">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">persistence-unit</span>&gt;</span>
<span id="cb7-12">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">persistence</span>&gt;</span></code></pre></div>
</div>
<p>Observi que aquest arxiu només s’encarrega de declarar una unitat JPA anomenada <code>mngr1</code> i que es faci ús de la configuració present a l’arxiu <code>hibernate.cfg.xml</code> com a font d’informació per a l’origen de dades.</p>
<p>En realitat aquest arxiu també podria contenir tota la informació en el seu interior (<em>driver</em>, usuari, base de dades, etc.) però s’ha preferit mantenir l’arxiu separat per claredat.</p>
<p>La resta d’arxius dels programes de mostra estan pràcticament iguals, només canviant el DAO per adequar-lo a les característiques de JPA.</p>
<p>Observi que el DAO conté una funció anomenada <code>setUp()</code>, que omple dues variables clau per a l’ús de JPA des de l’aplicació. El seu objectiu és habilitar JPA i iniciar un objecte de tipus <code>EntityManager</code> que anomenem <code>em</code> i un altre de classe <code>CriteriaBuilder</code> que anomenem <code>cb</code>. Gràcies a aquests dos objectes podrem accedir i manipular les dades de la base de dades. Aquesta funció és cridada tot just iniciar-se el programa.</p>
<p>Com veu, la càrrega programàtica d’aquesta modalitat és menor. JPA és un API optimitzat per a l’accés a informació que resideixi en multitud de possibles orígens de dades i es fa servir en bona part del desenvolupament d’aplicacions reals.</p>


</section>

 ]]></description>
  <category>bases de dades</category>
  <category>rdbms</category>
  <category>mysql</category>
  <category>java</category>
  <category>jdbc</category>
  <category>hibernate</category>
  <category>jpa</category>
  <category>criteriabuilder</category>
  <category>criteriaquery</category>
  <category>jpql</category>
  <guid>https://www.flx.cat/posts/2013-07-01-BD06-hibernate-i-jpa/</guid>
  <pubDate>Sun, 30 Jun 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-07-01-BD06-hibernate-i-jpa/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Hibernate i el mapatge objecte-relacional</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-07-01-BD05-hibernate-mapatge-objecte-relacional/</link>
  <description><![CDATA[ 





<section id="introducció-al-mapatge-objecte-relacional" class="level2">
<h2 class="anchored" data-anchor-id="introducció-al-mapatge-objecte-relacional">1. Introducció al mapatge objecte-relacional</h2>
<p>Havíem vist en l’activitat anterior que utilitzar JDBC per accedir a les dades allotjades a una base de dades és una tècnica vàlida i funcional.</p>
<p>Malgrat tot, havíem vist que malauradament presenta un seguit d’inconvenients. Un d’ells és el fet que per associar objectes Java amb entrades de taules de base de dades, l’obtenció i actualització de les dades dels objectes i de la base de dades s’ha de realitzar manualment programant crides específiques a sentències SQL de tipus <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code> o <code>DELETE</code> (les operacions que anomenàvem <strong>CRUD</strong>).</p>
<p>Això és més incòmode encara quan pensem en el procés d’importació i exportació de dades entre la base de dades i els objectes Java en memòria, on hem de programar bucles que realitzin fila a fila (i objecte a objecte) la importació o exportació de dades.</p>
<p>Una tècnica que redueix l’impacte en la longitud dels nostres programes i millora la redacció de codi és el <strong>mapatge objecte-relacional (<em>Object-Relational Mapping</em>, ORM)</strong>. Aquesta tècnica permet associar objectes Java amb dades de les taules d’una base de dades externa. El mapatge ens permet indicar la correspondència a nivell de camps de taula amb els atributs equivalents d’objecte, de manera que s’automatitza bona part del procés de traducció, eliminant una part de la programació necessària que faríem amb JDBC.</p>
</section>
<section id="hibernate" class="level2">
<h2 class="anchored" data-anchor-id="hibernate">2. Hibernate</h2>
<p>El producte lliure <strong>Hibernate</strong> és un API compatible que podem utilitzar per efectuar tasques de mapatge ORM.</p>
<p>Utilitzarem una classe <strong>POJO (<em>Plain Old Java Object</em>)</strong> com a receptacle de les files que provenen de la base de dades, i indicarem a Hibernate que utilitzi aquesta classe per associar-la a la taula de la qual traurem la informació.</p>
<p>El cas concret de Hibernate ens ofereix diverses alternatives per tal de realitzar el mapatge, entre les que destaquen dues:</p>
<ul>
<li><p>A través d’un arxiu de definició XML que indica quins atributs de la classe POJO corresponen a quines columnes de la taula.</p></li>
<li><p>A través d’anotacions sobre les classes POJO de dades, afegint indicacions que Java utilitzarà per obtenir les associacions d’atributs de classe a columnes de taula.</p></li>
</ul>
<p>A més, en el cas concret de Hibernate, se’ns ofereixen tècniques especials per accedir a la informació, construir consultes SQL, o fins i tot un llenguatge propi de consultes anomenat HQL.</p>
</section>
<section id="enllaçatinstallació-de-hibernate" class="level2">
<h2 class="anchored" data-anchor-id="enllaçatinstallació-de-hibernate">3. Enllaçat/instal·lació de Hibernate</h2>
<p>Per a què una aplicació faci ús del API de Hibernate, haurem de disposar de les classes corresponents en un lloc accessible del sistema. Per tant, s’haurà de descarregar des d’Internet la versió més adient (normalment la més moderna).</p>
<p>Aleshores haurem de disposar dels arxius <code>JAR</code> de la distribució de Hibernate al mateix directori de les nostres classes, o bé en un lloc al què apuntarem mitjançant el <code>CLASSPATH</code> en compilar i en executar.</p>
<p>Hibernate ens ofereix multitud de funcionalitats, però nosaltres només utilitzarem les funcionalitats bàsiques. Per tant, hem d’investigar els arxius JAR que apareixen en el directori <code>required</code> del <em>pack</em> d’arxius descarregats.</p>
<p>Així doncs, necessitarem els arxius bàsics (requerits) de Hibernate, el connector a la base de dades i també haurem de descarregar la versió adient del API <strong>log4j</strong> (si volem ajustar paràmetres del <em>logging</em>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>En el moment d’escriure aquestes notes s’ha treballat amb <strong>Hibernate-4.1.8</strong> i <strong>log4j-1.2.17</strong>.</p>
</div>
</div>
<p>Per tant, tenim els següents arxius:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1">antlr-2.7.7.jar                                </span>
<span id="cb1-2">dom4j-1.6.1.jar                                </span>
<span id="cb1-3">hibernate-commons-annotations-4.0.1.Final.jar  </span>
<span id="cb1-4">hibernate-core-4.1.8.Final.jar                 </span>
<span id="cb1-5">hibernate-jpa-2.0-api-1.0.1.Final.jar           </span>
<span id="cb1-6">javassist-3.15.0-GA.jar                         </span>
<span id="cb1-7">jboss-logging-3.1.0.GA.jar</span>
<span id="cb1-8">jboss-transaction-api_1.1_spec-1.0.0.Final.jar</span>
<span id="cb1-9">log4j-1.2.17.jar</span>
<span id="cb1-10">mysql-connector-java.jar</span></code></pre></div>
<p>Si disposem els arxius en un directori anomenat <code>libs</code>, aleshores podrem compilar manualment els programes Java fent:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">javac</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-cp</span> .:libs/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> Classe.java</span></code></pre></div>
<p>I executar el programa fent:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-cp</span> .:libs/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> Classe</span></code></pre></div>
<p>Observi que l’especificació del <code>CLASSPATH</code> amb el modificador <code>-cp</code> accepta més d’un camí a arxius o directoris, i en el cas d’arxius JAR és molt més còmode utilitzar el caràcter <code>*</code> per indicar tots els arxius JAR del directori en qüestió.</p>
</section>
<section id="configuració-de-hibernate" class="level2">
<h2 class="anchored" data-anchor-id="configuració-de-hibernate">4. Configuració de Hibernate</h2>
<p>Quan una aplicació requereix de l’ús de la funcionalitat que ofereix Hibernate, s’ha de configurar l’accés a dades que se li demanarà. Això normalment es fa utilitzant un arxiu de configuració escrit en XML i amb nom per defecte <code>hibernate.cfg.xml</code>. Aquest arxiu conté les directives principals que permeten a Hibernate localitzar i connectar amb el servidor de base de dades i configurar també com s’accedeixen als objectes.</p>
<p>En un cas general, aquest arxiu prendrà la forma següent:</p>
<p><strong>Arxiu hibernate.cfg.xml de mostra</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>hibernate.cfg.xml</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="hibernate.cfg.xml" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1.0'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'utf-8'</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span>
<span id="cb4-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;!DOCTYPE</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">hibernate-configuration</span> PUBLIC</span>
<span id="cb4-3">          "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
<span id="cb4-4">          "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb4-5">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">hibernate-configuration</span>&gt;</span>
<span id="cb4-6">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">session-factory</span>&gt;</span>
<span id="cb4-7">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"connection.url"</span>&gt;jdbc:mysql://localhost/hr&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-8">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"connection.username"</span>&gt;hr_user&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-9">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"connection.password"</span>&gt;hr_pass&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-10">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"connection.driver_class"</span>&gt;com.mysql.jdbc.Driver&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-11">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dialect"</span>&gt;org.hibernate.dialect.MySQLDialect&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-12">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show_sql"</span>&gt;false&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-13">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"format_sql"</span>&gt;false&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-14">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"use_sql_comments"</span>&gt;false&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-15">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate_statistics"</span>&gt;false&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-16">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hbm2ddl.auto"</span>&gt;validate&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-17">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"connection.pool_size"</span>&gt;1&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-18">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"current_session_context_class"</span>&gt;thread&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">property</span>&gt;</span>
<span id="cb4-19"> </span>
<span id="cb4-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- Mapping files will go here.... --&gt;</span></span>
<span id="cb4-21">    ...</span>
<span id="cb4-22"></span>
<span id="cb4-23">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">session-factory</span>&gt;</span>
<span id="cb4-24">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">hibernate-configuration</span>&gt;</span></code></pre></div>
</div>
<p>S’ha indicat a les quatre primeres propietats el lloc on es configura el servidor, el nom de la base de dades, el nom de l’usuari i la contrasenya. Observarà que la sintaxi és la mateixa que en les cadenes JDBC de connexió a base de dades.</p>
<p>En el punt que s’ha indicat amb punts suspensius farem esment de les classes i altres elements que haurà de tenir present Hibernate per a l’aplicació concreta que estiguem escrivint. Els exemples mostrats posteriorment indicaran exemples d’ús i com s’omple en cada cas.</p>
<p>A més, Hibernate generarà un gran volum d’informació de registre i depuració a través de la consola. Si vol desactivar-la haurà de configurar el paquet <strong>log4j</strong> per a què redueixi (o elimini) la sortida de depuració pel terminal.</p>
<p>Una de les múltiples formes de fer-ho és a través d’una línia de codi com aquesta:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1">org<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apache</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log4j</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Logger</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getLogger</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.Hibernate"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-2">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setLevel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>org<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apache</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log4j</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Level</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FATAL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>Com veu s’ha fixat el nivell de <em>logging</em> a <code>FATAL</code>, que correspon a errors fatals que normalment avortaran l’execució de l’aplicació. Els possibles cassos que presenta aquesta enumeració són: <code>ALL</code>, <code>DEBUG</code>, <code>ERROR</code>, <code>FATAL</code>, <code>INFO</code>, <code>OFF</code> o <code>WARN</code>. Cadascun d’ells fixa un nivell de generació de <em>logging</em> diferent.</p>
<p>Una altra tècnica, que permet modificar el comportament sense haver d’escriure codi específic, es mitjançant l’arxiu de propietats <code>log4j.properties</code>. Aquest arxiu permet configurar el paquet <code>log4j</code> en diversos paràmetres.</p>
<p>Un exemple de configuració de <code>log4j</code> mitjançant arxiu de propietats podria ser el mostrat tot seguit:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>log4j.properties</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="log4j.properties" style="background: #f1f3f5;"><pre class="sourceCode numberSource plain number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1">#Log to Console as STDOUT</span>
<span id="cb6-2">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span>
<span id="cb6-3">log4j.appender.stdout.Target=System.out</span>
<span id="cb6-4">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span>
<span id="cb6-5"></span>
<span id="cb6-6">#Root Logger</span>
<span id="cb6-7">log4j.rootLogger=FATAL, stdout</span></code></pre></div>
</div>
</section>
<section id="exemples-de-hibernate" class="level2">
<h2 class="anchored" data-anchor-id="exemples-de-hibernate">5. Exemples de Hibernate</h2>
<p>En aquesta part parlarem dels 2 projectes que mostren la funcionalitat bàsica de Hibernate amb uns exemples d’ús senzills.</p>
<p>Els dos exemples mostren, cadascun, diferents formes d’establir els mapatges objecte-relacionals:</p>
<ul>
<li>El primer (exemple número 6) mostra com realitzar el mapatge mitjançant arxiu XML</li>
<li>El segon (exemple número 7) mostra com fer-ho a través d’<em>annotations</em>.</li>
</ul>
<p>Tots dos exemples utilitzen la mateixa base de dades <code>hr</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>L’arxiu <code>hr_mysql.sql</code> li permet recuperar la base de dades <code>hr</code> al seu estat original. Recordi que pot executar l’ordre <code>source</code> per executar aquell arxiu SQL manualment des del client de consola de MySQL</p>
</div>
</div>
<p>A més, tots dos exemples fixen un nivell de <em>logging</em> al cas <code>FATAL</code>, mitjançant un arxiu anomenat <code>log4j.properties</code> com el mostrat prèviament i que estarà disponible juntament amb els arxius de codi font de Java, dins del <code>CLASSPATH</code> de l’aplicació.</p>
<p>En tots dos casos es contemplaran quatre programes (ubicats en quatre classes amb els seus corresponents mètodes <code>main()</code>:</p>
<ul>
<li>El primer fa un llistat de tots els treballadors, ordenats pel cognom.</li>
<li>El segon mostra, per a cada treballador, en quin departament treballa i la informació del cap de dit departament.</li>
<li>El tercer pregunta a l’usuari el <code>id</code> d’un treballador i mostra informació relacionada (arbre jeràrquic de caps i informació del seu departament).</li>
<li>El quart pregunta per un <code>id</code> de treballador i li augmenta el sou en una quantitat sol·licitada també a l’usuari.</li>
</ul>
</section>
<section id="exemple-dús-amb-definicions-xml" class="level2">
<h2 class="anchored" data-anchor-id="exemple-dús-amb-definicions-xml">6. Exemple d’ús amb definicions XML</h2>
<p>El primer exemple mostrat correspon a un cas d’ús de Hibernate amb mapatge ORM realitzat mitjançant arxiu XML de definició de mapatge.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple número 6</p>
</div>
</div>
<p>Els arxius font que trobarà al directori són:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1">06_hibernate_config_xml/</span>
<span id="cb7-2">    |-- src</span>
<span id="cb7-3">    |     |-- com.flx.ex06</span>
<span id="cb7-4">    |     |     |-- DAOHibernateTest1.java</span>
<span id="cb7-5">    |     |     |-- DAOHibernateTest2.java</span>
<span id="cb7-6">    |     |     |-- DAOHibernateTest3.java</span>
<span id="cb7-7">    |     |     \-- DAOHibernateTest4.java</span>
<span id="cb7-8">    |     |-- com.flx.ex06.model</span>
<span id="cb7-9">    |     |     |-- Department.java</span>
<span id="cb7-10">    |     |     |-- Employee.java</span>
<span id="cb7-11">    |     |     \-- HrDAOHibernate.java</span>
<span id="cb7-12">    |     \-- mappings</span>
<span id="cb7-13">    |           |-- Department.hbm.xml</span>
<span id="cb7-14">    |           \-- Employee.hbm.xml</span>
<span id="cb7-15">    |-- hibernate.cfg.xml</span>
<span id="cb7-16">    \-- log4j.properties</span></code></pre></div>
<p>Passem ara a descriure’ls un a un, tot destacant els fets més importants:</p>
<ul>
<li><p>Classes <code>com.flx.ex06.model.Employee.java</code> i <code>com.flx.ex06.model.Department.java</code>, que són els POJO bàsics per a les dades de les files de les taules. Aquestes classes són simples POJOs amb tots els atributs declarats, i els mètodes <em>getter</em> i <em>setter</em> associats.</p></li>
<li><p>Arxius <code>mappings/Department.hbm.xml</code> i <code>mappings/Employee.hbm.xml</code> que defineixen els mapatges concrets per a les taules i objectes associats en cada cas.</p>
<p>Fixi’s que en aquests arxius s’indica quina classe està associada a quina taula de la base de dades, i posteriorment indiquem els noms dels camps que són utilitzats a la base de dades i al POJO associat. Comprovarà que les definicions de les claus primàries (els camps <code>employeeId</code> a la classe <code>Employee</code>, i <code>departmentId</code> a la classe <code>Department</code>) són una mica més complexes que simplement esmentar els seus noms. Pot descobrir que es marca com a generació automàtica d’identificadors, tal i com les taules d’una base de dades real.</p></li>
<li><p>Arxiu <code>hibernate.cfg.xml</code> que configura Hibernate i indica quins són els arxius de mapatge objecte-relacional que es volen efectuar.</p>
<p>Aquest arxiu ja s’havia comentat anteriorment, ara ens hem de centrar en les darreres línies, on declarem que vagi a buscar els arxius XML de definició del mapatge per a les classes <code>Employee</code> i <code>Department</code>.</p></li>
<li><p>Arxiu <code>log4j.properties</code> per inhabilitar (configurar) la sortida de missatges (<em>logging</em>) per pantalla excepte en els casos d’error fatal.</p></li>
<li><p>Els programes de prova són <code>com.flx.ex06.DAOHibernateTest1</code> fins a <code>com.flx.ex06.DAOHibernateTest4</code>.</p></li>
<li><p>Classe <code>com.flx.ex06.model.HrDAOHibernate</code> amb la definició del DAO que serveix per accedir al model de dades.</p>
<p>Aquesta classe incorpora el mètode <code>getSession()</code> per establir la connexió a la base de dades i poder treballar amb ella. El procediment que conté s’ha de fer sempre així. A més, utilitza una tècnica mitjançant la qual no crea una sessió cada vegada que es crida, sinó que només establirà la connexió la primera vegada i després reutilitzarà la connexió establerta a partir d’aquell moment. Si l’aplicació no és molt exigent en rendiment i concurrència, ja és una bona tria.</p>
<p>La classe, a més, conté els mètodes que es faran servir en els programes de mostra, amagant la implementació interna de la seva funcionalitat.</p></li>
</ul>
<p>Els detalls sobre la manera d’escriure les consultes es deixa per al final del tema.</p>
</section>
<section id="exemple-dús-amb-definicions-per-annotations" class="level2">
<h2 class="anchored" data-anchor-id="exemple-dús-amb-definicions-per-annotations">7. Exemple d’ús amb definicions per annotations</h2>
<p>Una variant interessant és la declaració del mapatge per anotacions (<em>annotations</em>), on en comptes de definir les associacions per arxiu XML, simplement introduirem unes marques especialitzades que indiquin directives a Hibernate per detectar automàticament el mapatge sobre la classe POJO.</p>
<p>El segon grup d’exemples mostrat correspon a un cas d’ús de Hibernate amb mapatge ORM realitzat mitjançant <em>annotations</em> sobre les classes POJO.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple número 7</p>
</div>
</div>
<p>Els arxius font que trobarà al directori són:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1">07_hibernate_config_annotations/</span>
<span id="cb8-2">    |-- src</span>
<span id="cb8-3">    |     |-- com.flx.ex07</span>
<span id="cb8-4">    |     |     |-- DAOHibernateTest1.java</span>
<span id="cb8-5">    |     |     |-- DAOHibernateTest2.java</span>
<span id="cb8-6">    |     |     |-- DAOHibernateTest3.java</span>
<span id="cb8-7">    |     |     \-- DAOHibernateTest4.java</span>
<span id="cb8-8">    |     \-- com.flx.ex07.model</span>
<span id="cb8-9">    |           |-- Department.java</span>
<span id="cb8-10">    |           |-- Employee.java</span>
<span id="cb8-11">    |           \-- HrDAOHibernate.java</span>
<span id="cb8-12">    |-- hibernate.cfg.xml</span>
<span id="cb8-13">    \-- log4j.properties</span></code></pre></div>
<p>Observarà que ara no apareix un arxiu de definició de mapatge, perquè ja està inclòs en les classes <code>Employee</code> i <code>Department</code>. Observi com estan definides ara aquestes classes POJO.</p>
<p>Fixi’s que apareixen <em>annotations</em> que indiquen fets transcendents per al mapatge ORM.</p>
<p>En concret, l’anotació <code>@Entity</code> indica que aquesta classe és una entitat que s’ha d’associar a taula de base de dades, mentre que <code>@Table(name="nom_de_taula")</code> indica que el nom de la taula a associar és l’indicat com a argument. Així es pot indicar quina taula correspon a quina entitat.</p>
<p>Després només calen afegir les anotacions <code>@Id</code> i <code>@GeneratedValue</code> sobre el mètode <em>getter</em> de l’atribut que sigui clau primària de la taula. Això és així per permetre la generació automàtica de valors en aquest camp.</p>
<p>Com veu, les anotacions necessàries en una classe POJO senzilla són ben poques, i força lògiques.</p>
<p>En el cas concret dels atributs que són claus foranes, observi que s’han establert les <em>unions</em> de taula a través de codi com el següent:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@ManyToOne</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fetch<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>FetchType<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LAZY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb9-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@JoinColumn</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"departmentId"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> </span>
<span id="cb9-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> Department <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDepartment</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Aquestes estructures d’anotació permeten vincular objectes entre taules diferents. Indiquem el nom del camp (<code>departmentId</code>) que serà el de clau forana sobre l’atribut que s’obtindrà una vegada resolta la unió de taules (<code>department</code>).</p>
<p>L’especificació <code>FetchType.LAZY</code> indica a Hibernate que no cal que es resolgui la unió de taules i es busqui el registre referenciat a menys que sigui imprescindible (es consulti el seu valor). L’alternativa és indicar <code>FetchType.EAGER</code>, que intenta resoldre les relacions sempre que pugui.</p>
<p>Ara, només caldrà configurar Hibernate per tal que utilitzi les anotacions fetes sobre la classe model. Això ho fem des de l’arxiu <code>hibernate.cfg.xml</code>, on veurà que simplement esmentem les classes POJO que defineixen els nostres objectes de dades.</p>
<p>Amb tot, els programes de prova són <strong>exactament iguals, línia a línia</strong>. I és que les dues formes de treballar són intercanviables (i es podrien mesclar si es volgués). Tot i que és força habitual treballar sempre amb un mateix esquema dins de la mateixa aplicació.</p>
<p>El fet que no hi hagi canvis en el codi és un dels punts forts de Hibernate, que permet canviar (i fins i tot combinar) de model de mapatge ORM segons convingui al desenvolupador.</p>
</section>
<section id="persistència-dobjectes-a-la-base-de-dades" class="level2">
<h2 class="anchored" data-anchor-id="persistència-dobjectes-a-la-base-de-dades">8. Persistència d’objectes a la base de dades</h2>
<p>Hibernate, cada vegada que ha de <em>portar</em> una entitat de dades des de la base de dades al domini dels objectes Java, manté una referència a l’entitat original en les taules des d’on s’ha extret. Això, en notació Hibernate, es diu que l’objecte està <strong><em>managed</em></strong>.</p>
<p>Quan un objecte és <em>managed</em> si volem modificar-lo, simplement haurem de cridar al mètode <code>Session.update(objecte)</code>, de la mateixa manera que si volem eliminar-lo de la base de dades, només caldrà cridar el mètode <code>Session.delete(objecte)</code>. Hibernate farà tota la resta.</p>
<p>Una característica interessant de Hibernate és que ens permet evitar l’ús de sentències SQL en multitud de situacions:</p>
<ul>
<li>Quan volem inserir a la taula un nou registre a partir d’un objecte existent, utilitzem el mètode <code>Session.save(objecte)</code> i Hibernate s’encarregarà de generar l’ordre <code>INSERT</code> adient.</li>
<li>Quan volem eliminar de la taula un registre existent que tenim associat en un objecte, utilitzarem el mètode <code>Session.delete(objecte)</code>, i Hibernate generarà l’ordre <code>DELETE</code> corresponent.</li>
<li>Quan volem modificar un registre de la taula, utilitzarem el mètode <code>Session.update(objecte)</code>, i Hibernate generarà l’ordre <code>UPDATE</code> adequada.</li>
</ul>
<p>A més, Hibernate ens ofereix el control de transaccions bàsic, de manera que els canvis no es faran efectius definitivament en la base de dades mentre no tanquem la transacció. Les transaccions normalment es delimiten així:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1">Transaction tx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">beginTransaction</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb10-3">tx<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">commit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// tx.rollback();</span></span></code></pre></div>
<p>Això també es pot programar així:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb11-1">session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">beginTransaction</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb11-3">session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getTransaction</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">commit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// session.getTransaction().rollback();</span></span></code></pre></div>
<p>Per tant, tota l’operativa està protegida pels mecanismes convencionals de transaccions.</p>
<p>Per altra banda, observi que no hem de fer cap procediment especial per controlar la replicació de dades entre memòria i base de dades. Quan tanquem una transacció amb la crida <code>commit()</code> les dades són portades des de memòria a la base de dades sense que sigui necessari codificar cap procediment especial.</p>
</section>
<section id="construccions-de-consultes-sql-hql-i-criteria" class="level2">
<h2 class="anchored" data-anchor-id="construccions-de-consultes-sql-hql-i-criteria">9. Construccions de consultes SQL, HQL i Criteria</h2>
<p>Quan volem realitzar una consulta de selecció (<code>SELECT</code>) és quan tenim moltes més opcions i possibilitats.</p>
<p>Les tres opcions més importants que ofereix Hibernate són:</p>
<ul>
<li>Enviar sentències SQL construïdes manualment (<em>native SQL query</em>)</li>
<li>Utilitzar un objecte <code>Criteria</code> per construir la sentència SQL a través de mètodes específics</li>
<li>Utilitzar el llenguatge HQL propi de Hibernate per construir la sentència SQL</li>
</ul>
<section id="consultes-amb-sql" class="level3">
<h3 class="anchored" data-anchor-id="consultes-amb-sql">9.1. Consultes amb SQL</h3>
<p>Per generar una consulta SQL amb Hibernate, només hem d’escriure la sentència SQL dins d’una crida a la funció <code>Session.createSQLQuery()</code>. Aquest mètode ens retorna un objecte <code>SQLQuery</code>, al qual podem demanar el resultat de la seva execució invocant <code>SQLQuery.list()</code>:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb12-1">SQLQuery q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createSQLQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT * FROM employees"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb12-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]&gt;</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>El valor retornat és una llista de files, on cada fila és un <em>array</em> indexat que ens permetrà accedir a les diferents columnes de resultat. Haurem d’utilitzar meta-dades per descobrir els tipus dels diferents elements en temps d’execució.</p>
<p>Això no és res més que una consulta com les que realitzàvem amb JDBC. Per associar i obtenir objectes a partir de la base de dades hem d’utilitzar una altra via: hem de cridar el mètode <code>SQLQuery.addEntity()</code> per indicar l’entitat que s’espera rebre d’aquesta consulta i així obtenir la llista d’objectes ja en la forma que ens interessa:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1">SQLQuery q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createSQLQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT * FROM employees"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb13-2">                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addEntity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb13-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@SuppressWarnings</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unchecked"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb13-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Observi que s’ha fet una referència a la classe de l’entitat amb l’operador <code>Employee.class</code>.</p>
<p>Observarà també que s’ha afegit la línia <code>@SuppressWarnings("unchecked")</code> per demanar al compilador de Java que no generi un avís sobre la transformació de tipus que es produeix en l’obtenció de la llista de resultats de la consulta (aquesta directiva només afecta a la línia immediatament a continuació o el bloc iniciat en ella). Malauradament no hi ha una altra manera ràpida i senzilla per evitar l’aparició d’aquest missatge d’avís generat pel compilador i s’ha de recórrer a aquest mètode “<em>brut</em>” per evitar-lo: els avisos són normalment signes d’un mal disseny o d’una possible font de problemes a la llarga. En aquest cas malauradament no depèn de nosaltres sinó de la forma en què Hibernate està codificat amb la funció <code>SQLQuery.list()</code>.</p>
<p>Sigui com sigui ara disposem de la llista d’objectes ubicats en memòria i podem utilitzar tota la potència de Java per manipular-los en memòria i realitzar les operacions necessàries de la nostra aplicació.</p>
</section>
<section id="consultes-amb-criteria" class="level3">
<h3 class="anchored" data-anchor-id="consultes-amb-criteria">9.2. Consultes amb <code>Criteria</code></h3>
<p>Hibernate ens ofereix un mecanisme molt interessant per no fer servir consultes SQL en el llenguatge natiu de la base de dades. De fet, no té sentit fer consultes en SQL natiu en un entorn que ens permet no dependre del motor concret de base de dades utilitzat!</p>
<p>Així doncs, una primera solució és la que es mostra aquí. En ella, tota consulta es fonamenta en l’ús d’un seguit de mètodes que pengen de la classe <code>Criteria</code> i que ens permeten anar construint la consulta a passos.</p>
<p>Vegem un exemple:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb14-1">Criteria c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createCriteria</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb14-2">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Restrictions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">or</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb14-3">                        Restrictions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">like</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"K%"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span></span>
<span id="cb14-4">                        Restrictions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">like</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M%"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb14-5">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)).</span></span>
<span id="cb14-6">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Restrictions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">isNotNull</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"commissionPct"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb14-7">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addOrder</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">asc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb14-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@SuppressWarnings</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unchecked"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb14-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> emps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb14-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span></code></pre></div>
<p>Observi com es van afegint elements a la consulta <code>Criteria</code> mitjançant el mètode <code>add()</code> i que disposem d’una gran col·lecció de paràmetres de filtrat de registres basats en la classe <code>Restrictions</code>. Consulti la documentació oficial per a més informació.</p>
</section>
<section id="consultes-amb-hql" class="level3">
<h3 class="anchored" data-anchor-id="consultes-amb-hql">9.3. Consultes amb HQL</h3>
<p>Les consultes que utilizen el llenguatge <strong>HQL (<em>Hibernate Query Language</em>)</strong> tenen una dinàmica semblant a la de SQL estàndard, però modifica lleugerament algunes expressions en alguns casos concrets.</p>
<p>El procediment per construir una sentència HQL i executar-la pot ser tant senzill com el següent cas:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb15-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> hql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT e FROM employees e WHERE lastname LIKE 'K%'"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@SuppressWarnings</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unchecked"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb15-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> emps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>hql<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Fins i tot podem realitzar tasques d’assignació de paràmetres, com:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb16-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> hql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT e FROM employees e WHERE lastname= :cognom"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@SuppressWarnings</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unchecked"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">List</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Employee<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> emps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>hql<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-4">                        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setParameter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unnom"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"King"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-5">                        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Amb HQL també podem realitzar <code>INSERT</code>, <code>DELETE</code> i <code>UPDATE</code>, amb també una sintaxi semblant a l’estàndard SQL:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb17-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> hql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb17-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UPDATE employees e SET e.firstname = :nomNou WHERE e.firstname = :nomAntic"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> updatedEntities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb17-4">    session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> hql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-5">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nomNou"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Steven"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-6">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nomAntic"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stefan"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-7">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">executeUpdate</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Consulti la documentació de JBoss/Hibernate per a més informació sobre HQL.</p>


</section>
</section>

 ]]></description>
  <category>bases de dades</category>
  <category>rdbms</category>
  <category>mysql</category>
  <category>java</category>
  <category>jdbc</category>
  <category>hibernate</category>
  <category>jpa</category>
  <category>criteria</category>
  <category>hql</category>
  <guid>https://www.flx.cat/posts/2013-07-01-BD05-hibernate-mapatge-objecte-relacional/</guid>
  <pubDate>Sun, 30 Jun 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-07-01-BD05-hibernate-mapatge-objecte-relacional/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>JDBC amb SQL</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-06-29-BD02-jdbc-amb-sql/</link>
  <description><![CDATA[ 





<section id="connectors-jdbc" class="level2">
<h2 class="anchored" data-anchor-id="connectors-jdbc">1. Connectors JDBC</h2>
<p>Els connectors JDBC permeten utilitzar les bases de dades dels fabricants més importants des de les nostres aplicacions Java.</p>
<p>Un connector JDBC està pensat per a només una família de base de dades. Així doncs, existeix un connector JDBC per a MySQL, un altre per Oracle, un altre per a Microsoft SQL Server, etc.</p>
<p>En aquest tema farem proves connectant contra una base de dades MySQL local. S’assumeix disposar del MySQL correctament instal·lat i operatiu.</p>
<p>És responsabilitat del programador descarregar el connector JDBC que s’apliqui a la seva versió de Java i instal·lar-la apropiadament o fer ús de la configuració per defecte en casos com les distribucions de Linux.</p>
<p>En concret, si s’utilitza una distribució Ubuntu moderna (les proves presentades aquí estan fetes amb Ubuntu &gt;11.10, amb openjdk versió 6 o 7), podrem instal·lar el connector JDBC per a MySQL simplement escrivint:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> sudo aptitude install libmysql-java</span></code></pre></div>
<p>Quan disposem del connector ja instal·lat, l’única diferència respecte a la compilació i execució de programes Java és que, quan executem el programa, si el connector no està copiat al directori de treball, hem d’especificar-lo en la ruta de cerca <code>CLASSPATH</code>. En el cas particular, podrem escriure:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> javac LlistatPersones.java</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> java <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-cp</span> .:/usr/share/mysql-connector-java.jar LlistatPersones</span></code></pre></div>
<p>Com es veu, l’especificació amb el modificador <code>-cp</code> permet indicar el directori actual (<code>.</code>) i la ubicació de l’arxiu comprimit <code>mysql-connector-java.jar</code> que està en un directori del sistema, separant els camins amb el caràcter “<code>:</code>”.</p>
</section>
<section id="ús-dels-connectors" class="level2">
<h2 class="anchored" data-anchor-id="ús-dels-connectors">2. Ús dels connectors</h2>
<p>Els connectors JDBC requereixen d’un seguit de passos pràctics a l’hora d’usar-se en Java:</p>
<ol type="1">
<li><p><strong>Invocar la recerca de la classe</strong> relacionada amb el connector. Això es fa amb una crida com la següent:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">forName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"com.mysql.jdbc.Driver"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>Això dependrà, lògicament, del connector específic que estiguem utilitzant.</p>
<p>Aquest pas podria generar una excepció de <em>classe no trobada</em> que ha de ser atesa.</p></li>
<li><p><strong>Obtenir una connexió amb el servidor</strong>, utilitzant les credencials adients. Això sol fer-se escrivint una línia com la següent:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb4-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Connection</span> conn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">DriverManager</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getConnection</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> </span>
<span id="cb4-3">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jdbc:mysql://localhost/hr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-4">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hr_user"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-5">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hr_pass"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>Com veu, el primer paràmetre de la crida a la funció conté el nom del servidor (o la IP) i el nom de la base de dades. Després s’indicaran l’usuari i la contrasenya en els altres dos arguments de la crida.</p>
<p>Aquest pas podria generar una excepció d’<em>impossible contactar</em> que ha de ser atesa.</p></li>
<li><p>Un cop tenim una connexió establerta, podem utilitzar-la per a <strong>realitzar una consulta</strong>. Només cal definir un <code>Statement</code> i executar-lo:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT * FROM employees"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Statement</span> stmt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createStatement</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb5-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ResultSet</span> rs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">executeQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>L’objecte <code>ResultSet</code> obtingut permetrà recórrer les files de resultat de la consulta executada, així com modificar valors en la taula original, si la consulta és senzilla.</p></li>
<li><p>També podem <strong>executar ordres SQL</strong> d’execució (no consultes) que no generaran taules de resultat. Aquí tindrem ordres SQL com <code>UPDATE</code>, <code>INSERT</code>, <code>DELETE</code>, <code>CREATE TABLE</code>, etc. Per invocar aquest tipus d’ordre SQL només cal fer:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UPDATE employees SET salary=12345 WHERE employeeId=103"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Statement</span> stmt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createStatement</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-3">stmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execute</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>S’hauran d’atendre les possibles excepcions de tipus <code>java.sql.SQLException</code> que s’hi puguin produir.</p></li>
<li><p>Un cop hem realitzat totes les tasques necessàries amb una consulta, hem d’<strong>alliberar</strong> (tancar) <strong>la consulta</strong>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1">rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">close</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Si és una consulta SELECT</span></span>
<span id="cb7-2">stmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">close</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div></li>
<li><p>I quan hem acabat de realitzar totes les tasques amb la base de dades, podrem <strong>tancar la connexió</strong> establerta amb ella:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1">conn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">close</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div></li>
</ol>
</section>
<section id="sobre-els-resultset" class="level2">
<h2 class="anchored" data-anchor-id="sobre-els-resultset">3. Sobre els <code>ResultSet</code></h2>
<p>Quan invoquem una consulta SQL que demani un bolcat de dades (consultes tipus <code>SELECT</code>), hem vist que hem d’invocar el mètode <code>Statement.executeQuery(...)</code>.</p>
<p>Aquest mètode ens retorna un objecte de tipus <code>ResultSet</code> que contindrà la taula de resultats de la consulta.</p>
<p>Per recórrer aquesta taula, ho farem línia a línia (fila a fila), mitjançant una estructura clàssica com la següent:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb9-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ResultSet</span> rs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">executeQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">next</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getInt</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"employeeId"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-5">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> nom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firstname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-6">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> cognoms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastname"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-7">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> cognoms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-9">rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">close</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb9-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span></code></pre></div>
<p>Observi que es fa ús de la funció <code>ResultSet.next()</code> per anar recorrent tota la taula de resultats. Amb la fila activa, podem extreure els valors de les columnes fent crides a les funcions <code>ResultSet.getInt(...)</code> o <code>ResultSet.getString(...)</code>.</p>
<p>Existeix tota una col·lecció de funcions en la classe <code>ResultSet</code> que permet recórrer verticalment la taula (moure’s entre les files) com <code>first()</code>, <code>last()</code>, etc.</p>
<p>De la mateixa manera existeix tota una col·lecció de mètodes per obtenir les dades en diferents tipus: <code>getInt()</code>, <code>getString()</code>, <code>getDate()</code>, etc.</p>
<p>Independentment, també podem modificar els valors de la taula resultant. Això s’analitzarà en un exemple posterior. I és que existeixen mètodes com <code>setInt()</code> o <code>setString()</code> i la funció <code>updateRow()</code> que actualitza la taula en la base de dades original. Amb tot, per utilitzar aquesta funcionalitat, s’ha d’especificar que aquesta consulta sigui de tipus <em>actualitzable</em>.</p>
</section>
<section id="execució-de-consultes-de-modificació-de-dades-dml" class="level2">
<h2 class="anchored" data-anchor-id="execució-de-consultes-de-modificació-de-dades-dml">4. Execució de consultes de modificació de dades (DML)</h2>
<p>Per al cas d’executar ordres SQL de manipulació de dades (les que s’anomenen comunament DML), en comptes de fer servir el mètode <code>Statement.executeSQL(...)</code>, farem servir <code>Statement.execute(...)</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple de curs número 1.</p>
</div>
</div>
</section>
<section id="modificació-de-dades-des-de-consulta-updatable" class="level2">
<h2 class="anchored" data-anchor-id="modificació-de-dades-des-de-consulta-updatable">5. Modificació de dades des de consulta <code>UPDATABLE</code></h2>
<p>Podem modificar les dades directament sobre una consulta de tipus <code>SELECT</code> i després demanar que les dades modificades s’incorporin a l’origen de dades (la taula original). Això permet agilitzar l’accés i modificació de les dades des del programa, sense haver d’executar ordres SQL diverses per a cada operació.</p>
<p>Per aconseguir-ho hem de realitzar una consulta estàndard de selecció (<code>SELECT</code>), però marcar la consulta com a <strong>actualitzable</strong>. Aleshores executem la consulta normalment i rebem el resultat del <code>SELECT</code> en un objecte <code>ResultSet</code> com abans.</p>
<p>La diferència és que mentre recorrem la taula de dades obtinguda, podem executar mètodes de modificació d’aquestes dades amb crides a <code>ResultSet.updateInt(...)</code> o <code>ResultSet.updateString(...)</code>, per exemple.</p>
<p>Un cop hem realitzat totes les modificacions que necessitem, simplement executarem <code>ResultSet.updateRow()</code> per enregistrar els canvis de la fila modificada en la taula original de la base de dades:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb10-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT * FROM employees"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Statement</span> stmt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createStatement</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ResultSet</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">TYPE_SCROLL_INSENSITIVE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-4">                                       <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ResultSet</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CONCUR_UPDATABLE</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ResultSet</span> rs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">executeQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">next</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-7">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">float</span> salary  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getFloat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salary"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> salary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> salary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.03</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-9">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> salary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.035</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-10">  rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">updateFloat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salary"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> salary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-11">  rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">updateRow</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-13">rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">close</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-14">stmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">close</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span></code></pre></div>
<p>Els canvis són incorporats immediatament a la base de dades i són accessibles a posteriors consultes de selecció.</p>
</section>
<section id="preparació-de-consultes-amb-preparestatement" class="level2">
<h2 class="anchored" data-anchor-id="preparació-de-consultes-amb-preparestatement">6. Preparació de consultes amb <code>prepareStatement()</code></h2>
<p>Podem configurar consultes parametritzades de qualsevol tipus (selecció, DML, etc.), és a dir, construir consultes que reben dades provinents de variables de Java que incorporem a la sentència.</p>
<p>Per fer-ho, Java ens ofereix la classe <code>PreparedStatement</code> que funciona exactament igual que <code>Statement</code> des del punt de vista de l’execució de sentències SQL, però que accepta la parametrització de la consulta.</p>
<p>Observi el següent exemple:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb11-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">PreparedStatement</span> pstmt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prepareStatement</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb11-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT COUNT(*) AS total FROM employees WHERE firstname=? AND lastname=?"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb11-3">pstmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> firstname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb11-4">pstmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> lastname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb11-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ResultSet</span> rs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pstmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">executeQuery</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb11-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span></code></pre></div>
<p>Veurà que la consulta SQL, ara construïda sobre un objecte de tipus <code>PreparedStatement</code> i obtinguda amb una crida a <code>Connection.prepareStatement(...)</code>, rep una cadena SQL convencional on s’han omès l’usuari i la contrasenya, i s’ha escrit en el seu lloc un caràcter <code>?</code>. Observi que tampoc hi ha cometes simples ni dobles encerclant l’interrogant.</p>
<p>Després es canvien els interrogants fent crides a <code>PreparedStatement.setString(...)</code> per modificar les dades en les posicions 1 i 2 (així és com fem referència als interrogants).</p>
</section>
<section id="extracció-de-les-metadates-de-la-consulta" class="level2">
<h2 class="anchored" data-anchor-id="extracció-de-les-metadates-de-la-consulta">7. Extracció de les metadates de la consulta</h2>
<p>Tota consulta, un cop executada, genera un objecte <code>ResultSet</code> amb les dades obtingudes. Però si necessitem saber quantes columnes hem obtingut i quins són els seus tipus de dada, haurem d’accedir al que s’anomena les <em>metadates</em> del <code>ResultSet</code>.</p>
<p>Per obtenir les metadates, simplement haurem d’executar una crida a la funció <code>ResultSet.getMetaData()</code> sobre el <code>ResultSet</code> obtingut de la consulta i obtindrem un objecte <code>ResultSetMetaData</code> amb la informació:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb12-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ResultSetMetaData</span> rsmd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getMetaData</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Amb aquest objecte podem descobrir moltes característiques relacionades amb les columnes obtingudes en aquell <code>ResultSet</code>:</p>
<ul>
<li>Amb <code>ResultSetMetaData.getColumnCount()</code> obtindrem la quantitat de columnes obtingudes</li>
<li>Amb <code>ResultSetMetaData.getColumnName(idx)</code> obtindrem el nom (o àlies) associat a la columna indicada numèricament. I tingui present que <strong>comença a comptar a partir de 1</strong>.</li>
<li>Amb <code>ResultSetMetaData.getColumnDisplaySize(idx)</code> obtindrem la mida màxima de totes les dades d’aquella columna, permetent, per exemple, saber l’amplada de columna que s’haurà de deixar per pantalla per mostrar tota la taula correctament.</li>
<li>Amb <code>ResultSetMetaData.getColumnTypeName(idx)</code> obtindrem el tipus de dada de la columna demanada, sent normalment cadenes en nomenclatura MySQL: “<code>INTEGER</code>”, “<code>DATE</code>”, “<code>CHAR</code>”, etc.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple de curs número 2.</p>
</div>
</div>
<p>Si investiga el codi font, veurà que s’ha incorporat la decisió de justificar a esquerra o dreta el text obtingut a partir del tipus de dada de cada columna, i mitjançant crides a les funcions <code>padLeft()</code> i <code>padRight()</code> definides al programa.</p>
</section>
<section id="dao-components-daccés-a-dades" class="level2">
<h2 class="anchored" data-anchor-id="dao-components-daccés-a-dades">8. DAO (Components d’accés a dades)</h2>
<p>Un <strong>component d’accés a dades (DAO, <em>Data Access Object</em>)</strong> és un mecanisme de disseny de <em>software</em> àmpliament utilitzat en el desenvolupament de programari.</p>
<p>Parteix de la idea que, en realitat, quan volem disposar de diferents objectes que es vinculin amb orígens de dades, poden existir múltiples mecanismes de persistència.</p>
<p>Veurem més endavant que <strong>JPA (<em>Java Persistence API</em>)</strong> ens proveeix d’un mecanisme apte per a realitzar l’abstracció de <strong>classes POJO</strong> cap a un motor de dades determinat. I fins i tot utilitzarem <strong>Hibernate</strong> com a intermediari per a construir aplicacions sobre JPA.</p>
<p>Hibernate ens oferirà el mecanisme ideal per al disseny d’una aplicació que connecti contra un motor de base de dades específic, i construïrem l’aplicació en funció del motor triat. Bé, en tot cas configurem Hibernate per treballar amb l’origen de dades específic (nom del servidor de base de dades, port de servei, nom d’usuari, contrasenya).</p>
<p>A més, hem de disposar d’un <strong>connector JDBC</strong> específic per al motor concret que utilitzem.</p>
<p>Tot aquest castell de cartes és útil i funciona, però no és l’únic patró de disseny que es fa en l’actualitat.</p>
<section id="arquitectura-n-tier-programació-per-capes" class="level3">
<h3 class="anchored" data-anchor-id="arquitectura-n-tier-programació-per-capes">8.1. Arquitectura n-tier (programació per capes)</h3>
<p>En l’àmbit de l’enginyeria del <em>software</em>, l’arquitectura multi-capa (<em>multi-tier architecture</em>) (també coneguda com a “arquitectura <em>n-tier</em>” és un arquitectura de disseny de programació que consta de tres capes o elements separats des del punt de vista lògic.</p>
<p>L’arquitectura més habitual és la de tres capes (<strong><em>3-tier</em></strong>):</p>
<ul>
<li><strong>Presentació (<em>presentation layer</em>)</strong></li>
<li><strong>Processament de l’aplicació, també coneguda com a capa de lògica de negoci (<em>logical/business layer</em>)</strong></li>
<li><strong>Funcions de manipulació de dades (<em>data layer</em>)</strong></li>
</ul>
<p>Aquesta arquitectura de disseny ens permet construir aplicacions on cadascun dels elements pugui ser desenvolupat separadament, o substituït completament, sense haver de modificar res de cap de les altres capes. Per exemple, en cas d’un canvi de sistema operatiu només caldrà adequar la capa de presentació, o si es canvia el sistema d’emmagatzematge de dades només s’haurà de canviar la capa de dades.</p>
<p>L’estructura de tres capes va ser desenvolupada originàriament per John J. Donovan en Open Environment Corporation (OEC) a Cambridge, Massachusetts.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2013-06-29-BD02-jdbc-amb-sql/images/Overview_of_a_three-tier_application.png" class="img-fluid figure-img"></p>
<figcaption>Aspecte general d’una aplicació 3-tier</figcaption>
</figure>
</div>
</section>
<section id="capa-de-presentació-presentation-tier" class="level3">
<h3 class="anchored" data-anchor-id="capa-de-presentació-presentation-tier">8.2. Capa de presentació (<em>Presentation tier</em>)</h3>
<p>És la capa més alta de l’aplicació. Mostra la informació a l’usuari com a resultat de les accions que realitza i les dades que demana. Comunica amb la capa de lògica de negoci com a resposta de les accions dels usuaris.</p>
<p>Comunament serà una pàgina web o la pantalla principal i els formularis secundaris d’una aplicació de plataforma.</p>
</section>
<section id="capa-de-lògica-de-negoci-logicalbusiness-tier" class="level3">
<h3 class="anchored" data-anchor-id="capa-de-lògica-de-negoci-logicalbusiness-tier">8.3. Capa de lògica de negoci (<em>Logical/Business tier</em>)</h3>
<p>Aquesta capa controla realment la funcionalitat de l’aplicació, realitzar el processament detallat de les accions demanades per l’usuari a la capa de presentació, enviant o rebent dades de la capa de dades situada per sota.</p>
</section>
<section id="capa-de-dades-data-tier" class="level3">
<h3 class="anchored" data-anchor-id="capa-de-dades-data-tier">8.4. Capa de dades (<em>Data tier</em>)</h3>
<p>Aquesta capa consisteix en la connexió amb els servidors de bases de dades i/o orígens d’informació i dades. Aquí és on s’obté i processa la informació. Aquesta capa manté les dades d’una manera neutral i independent de l’aplicació i la lògica de l’aplicació.</p>
<p>Fer aquesta separació permet l’escalabilitat i la millora de l’eficiència de les aplicacions, a més de permetre l’existència (i potser coexistència simultània) de diversos orígens de dades.</p>
</section>
<section id="comparació-amb-larquitectura-mvc" class="level3">
<h3 class="anchored" data-anchor-id="comparació-amb-larquitectura-mvc">8.5. Comparació amb l’arquitectura MVC</h3>
<p>L’arquitectura <strong>MVC (<em>Model-View-Controller</em>)</strong> és un model de tres capes semblant al presentat fins ara, però que incorpora una petita diferència: en el cas de MVC, la comunicació entre capes pot realitzar-se directament entre la capa de dades (model) i la de presentació (vista); mentre que en el cas 3-tier, no és permesa la comunicació entre dades i presentació (sempre s’ha de passar a través de la capa de processament).</p>
</section>
<section id="concepte-de-dao" class="level3">
<h3 class="anchored" data-anchor-id="concepte-de-dao">8.6. Concepte de DAO</h3>
<p>Evidentment no és temari d’aquest tema (ni d’aquest curs com a conjunt) parlar de les capes de presentació i de processament. Del que sí hem de parlar és de la <strong>capa d’accés a dades (DAL, <em>Data Access Layer</em>)</strong>.</p>
<p>Aquesta capa, tal i com s’ha esmentat, és l’encarregada de la persistència de dades en els medis i amb els mitjans requerits i/o disponibles per al correcte funcionament de l’aplicació.</p>
<p>Això es desglossa en diversos tipus d’implementació que dependran del model de dades triat. Aquests models poden ser combinats i en poden haver més d’un en una mateixa aplicació.</p>
<p>Els models de dades més utilitzats avui dia són:</p>
<ul>
<li>Fitxers de disc, amb formats estàndard coneguts i/o propietaris</li>
<li>Dades residents en bases de dades relacionals</li>
<li>Dades residents en bases de dades orientades a objectes</li>
<li>Documents residents en una bases de dades natives XML</li>
</ul>
<p>La metodologia utilitzada comunament per implementar la capa d’accés a dades (DAL) és la de construir una col·lecció d’objectes (tot sovint a través d’interfícies) que representin objectes que permetin accedir a la informació ubicada en aquells dipòsits d’informació.</p>
<p>Aquests objectes, coneguts com a <strong>objectes d’accés a dades (DAO, <em>Data Access Objects</em>)</strong>, són en realitat l’objectiu d’aquesta unitat formativa.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Un DAO és un objecte POJO que representa una unitat d’informació tancada des d’un punt de vista conceptual, i que implementa les operacions CRUD a més d’altres mètodes més específics d’objecte específic.</p>
</div>
</div>
<p>Les operacions CRUD són les habituals de tot element d’informació: <em>Create</em>, <em>Read</em>, <em>Update</em> i <em>Delete</em> (crear, llegir, editar i eliminar).</p>
<p>En una aplicació, hi ha tants DAO com models. És a dir, en una base de dades relacional, per cada taula haurà un DAO associat (tot i que un sol DAO pot cobrir més d’una taula o entitat).</p>
<p>L’avantatge d’usar DAO és la separació senzilla però rigorosa entre les parts d’una aplicació que preferiblement haurien de ser independents unes d’altres, i que poden evolucionar o canviar separadament. Així doncs, es podria canviar la lògica de negoci d’una aplicació sense tocar ni una sola línia de codi de les interfícies DAO, i viceversa. Igual respecte a la capa de presentació.</p>
<p>Els seus grans avantatges són:</p>
<ul>
<li>Pot ser usat en un gran nombre d’aplicacions, allà on es requereixi d’un magatzem d’informació.</li>
<li>Amaguen els detalls de la implementació de l’emmagatzematge de la resta de l’aplicació.</li>
<li>Actuen com a intermediari entre l’aplicació i la base de dades. Mouen dades entre els objectes i els orígens d’informació.</li>
<li>Permeten que els canvis en els mecanismes de persistència no afectin moltes àrees de l’aplicació.</li>
</ul>
<p>Des del punt de vista específica del llenguatge Java, els DAO poden implementar-se de moltes maneres: des de simples interfícies que separen l’accés a dades de la lògica de l’aplicació; fins a llibreries i productes comercials: JPA, JDO, Enterprise Java Beans (J2EE), TopLink, Doctrine, Hibernate, iBATIS, Apache OpenJPA, etc.</p>
<p>L’ús de DAO en entorns Java hauria de comportar:</p>
<ul>
<li>Un augment de l’eficiència i rendiment de la capa de dades, perquè ara es torna reutilitzable, i</li>
<li>Capacitat de modificar els DAO sense alterar altres parts de l’aplicació.</li>
</ul>
<p>De vegades necessitarem també dels <strong>DTO (<em>Data Transfer Object</em>)</strong>, també denominats <strong>VO (<em>Value Object</em>)</strong>. Són utilitzats pels DAO per a transportar les dades des de la base de dades fins a la capa de lògica de negoci i viceversa. Malgrat això, normalment són els mateixos DAO que són moguts des de i cap a la capa de lògica.</p>
<p>El patró de disseny DAO consisteix en algunes classes factoria, interfícies DAO i algunes classes DAO que implementin aquelles interfícies:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2013-06-29-BD02-jdbc-amb-sql/images/model_dao.png" class="img-fluid figure-img"></p>
<figcaption>Model DAO</figcaption>
</figure>
</div>
<p>Els DAO són els objectes primaris d’aquest patró de disseny. Aquest objecte abstreu la implementació d’accés a dades dels altres objectes per habilitar l’accés transparent a la base de dades o unitat d’emmagatzematge.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple de curs número 3.</p>
</div>
</div>
</section>
</section>
<section id="problemàtica-del-jdbc" class="level2">
<h2 class="anchored" data-anchor-id="problemàtica-del-jdbc">9. Problemàtica del JDBC</h2>
<p>Què passa si, mitjançant l’exemple número 3, intenta aplicar el procés de canvi de sou al treballador amb <code>employeeId=100</code>?</p>
<p>La solució és fer que els POJO no facin referència als <code>id</code> d’altres taules, sinó que les referències entre taules es resolguin directament a objectes de les classes associades.</p>
<p>Així doncs, el POJO <code>Employee</code> hauria de ser així:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Employee <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> employeeId<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-3">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> firstname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-4">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> lastname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-5">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> email<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-6">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> phoneINT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-7">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Date</span> hireDate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-8">  Job job<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-9">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">float</span> salary<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">float</span> commissionPct<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-11">  Employee manager<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-12">  Department department<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-13">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb13-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Observi que ara aquells camps que són clau forana a altres taules han estat substituïts per objectes referenciats adecuadament des d’aquest. Així, si tenim un determinat treballador <code>e1</code>, si apliquem <code>e1.getDepartment()</code> el que obtindríem seria tot un objecte de la classe <code>Department</code> amb què podrem treballar normalment.</p>
<p>Aquesta idea, que resulta evident ara que ha estat presentada, incorpora una gran problemàtica si intenta dur-se a terme amb simples consultes SQL a través de JDBC. Els motius són diversos:</p>
<ul>
<li>Hauríem de mantenir en memòria gran part (o tota) la base de dades, perquè un treballador tindrà un cap, que al seu torn tindrà un altre, etc. El mateix amb la resta d’elements de la base de dades.</li>
<li>Hem d’escriure moltíssimes línies de codi per obtenir pocs (o cap) avantatges només per tenir els objectes en memòria.</li>
<li>Un <strong>canvi en les dades</strong> no és reflectit en la base de dades de cap manera. Hauríem de programar una funció que bolqués les dades de nou a la taula atenent als canvis que s’hi descobreixin, fent també el programa molt més complex i llarg.</li>
<li>Les <strong>dades quedaran desactualitzades</strong> si la base de dades canvia la informació de les taules degut a l’execució d’ordres SQL provinents d’altres programes i/o usuaris concurrents. Això no podem atacar-ho d’una manera neta i definitiva, sent un <strong>greu problema en el disseny de la base de dades i el seu ús</strong>.</li>
</ul>
<p>Per tant, fora de programes que accedeixen a la informació de manera immediata, realitzen llistats o executen ordres SQL de gestió de la informació, l’ús de JDBC queda lluny de ser solució en una manipulació intensiva i continuada de les dades de la base de dades, on el programa hagi d’accedir a blocs d’informació amplis i treballar en paral·lel amb multitud de taules i usuaris concurrents.</p>
<p>Veurem, com a solució, altres tècniques al llarg d’aquest curs. Bàsicament mitjançat JPA i Hibernate.</p>


</section>

 ]]></description>
  <category>bases de dades</category>
  <category>rdbms</category>
  <category>mysql</category>
  <category>java</category>
  <category>jdbc</category>
  <guid>https://www.flx.cat/posts/2013-06-29-BD02-jdbc-amb-sql/</guid>
  <pubDate>Fri, 28 Jun 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-06-29-BD02-jdbc-amb-sql/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Tipus de bases de dades - discusió i ús</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-06-29-BD01-tipus-de-bases-de-dades/</link>
  <description><![CDATA[ 





<section id="tipus-de-bases-de-dades" class="level2">
<h2 class="anchored" data-anchor-id="tipus-de-bases-de-dades">Tipus de bases de dades</h2>
<p>Existeixen diversos tipus de base de dades actualment, cadascun d’ells orientats a optimitzar l’accés a la informació quan la informació pren formes concretes:</p>
<ul>
<li><strong>BD relacionals</strong>: Taula (Relació) + Unió (PK - FK)</li>
<li><strong>BD orientades a objecte</strong>: Magatzem d’objectes</li>
<li><strong>BD natives XML</strong>: Documents i dades estructurades (documents XML)</li>
</ul>
<p>Cadascun d’ells presenta beneficis particulars.</p>
<p>Per la forma de les dades i l’estructura interna de l’emmagatzematge de la informació, cadascuna d’aquestes modalitats de base de dades presentarà formes específiques d’accés a la informació:</p>
<ul>
<li><strong>BD relacionals</strong>: Connexió per a l’extracció de files i manipulació de dades (execució SQL: SELECT i sentències DML)</li>
<li><strong>BD relacionals</strong>: Mapatge objecte-relacional (1 registre &lt;-&gt; 1 objecte)</li>
<li><strong>BD orientades a objecte</strong>: Manipulació directa d’objectes (1 registre = 1 objecte)</li>
<li><strong>BD natives XML</strong>: Parsers (anàlisi sintàctic del document XML: DOM)</li>
<li><strong>BD natives XML</strong>: Bindings (1 document XML &lt;-&gt; estructura enllaçada d’objectes)</li>
<li><strong>BD natives XML</strong>: Accés a través de API (execució de consultes XPath/XQuery)</li>
</ul>
<p>Durant el curs anirem veient la majoria d’aquestes tècniques.</p>
<p>En la majoria de casos, l’objectiu final és treballar sobre objectes de tipus POJO (Plain Old Java Object), que seran els elements que s’omplen i utilitzen com a magatzem temporal de la informació que la nostra aplicació enviarà i/o gestionarà.</p>
<p>En aquest sentit, un bon disseny de les aplicacions força l’ús de tècniques de disseny del software com:</p>
<ul>
<li><strong>MVC (Model-View-Controller)</strong>: L’aplicació es divideix en tres parts:
<ul>
<li><strong>Model</strong>: Aquí es tracta l’emmagatzematge de la informació. En aquest nivell implementarem les tècniques que veurem en el present curs (pensem en registres de taules). Pren la forma d’una col·lecció de funcions estil <code>inserir_missatge(...)</code>, <code>obtenir_missatge_per_id(...)</code>, <code>eliminar_missatge(...)</code>, etc.</li>
<li><strong>View</strong>: Serà la tècnica emprada per mostrar formularis i/o informes a l’usuari, i serà aquí on l’usuari iniciarà processos sobre la informació (pensem en un HTML). Normalment seran plantilles o codi generat a través d’algun sistema modern de generació de vistes.</li>
<li><strong>Controller</strong>: Aquest nivell implementarà la gestió de la informació i la vinculació cap a les vistes que s’hauran de presentar a l’usuari. És la part més important de l’aplicació, perquè aquí és on es prenen decisions. Pren la forma d’una col·lecció de funcions que responen a les accions dels usuaris i tot un seguit de <code>if</code> i crides a funcions que seran invocats en conseqüència.</li>
</ul></li>
<li><strong>Multi-tier (n-capes)</strong>: L’aplicació es divideix en una quantitat indeterminada de capes o nivells (tiers). El model mínim incorporarà 3 capes:
<ul>
<li><strong>Capa de dades (<em>Data-tier</em>)</strong>: Gestiona l’accés a la informació. Equival al Model de MVC.</li>
<li><strong>Capa de negoci (<em>Business-tier</em>)</strong>: Gestiona quines accions s’han d’efectuar sobre les dades en funció de les accions dels usuaris. Equival (amb matissos) al Controller de MVC.</li>
<li><strong>Capa de presentació (<em>Presentation-tier</em>)</strong>: Genera les vistes que seran ofertes als usuaris en resposta de les seves accions. Equval al View de MVC.</li>
</ul></li>
</ul>
<p>Les principals diferències entre MVC i Multi-tier són:</p>
<ul>
<li>En MVC no és obligatori passar per la capa “Controller”, mentre que en Multi-tier, l’estructura és canònica.</li>
<li>En Multi-tier es pot ampliar la quantitat de capes o nivells afegint-ne segons convingui. Per exemple, es podria afegir una capa d’encriptació i una altra d’enviament entre la de negoci i presentació per fer que l’aplicació tingui la part de presentació executada en un equip remot.</li>
</ul>
<p>Sigui com sigui, tant en MVC com en Multi-tier, la capa de gestió de dades pren la forma de col·lecció de funcions que manipulen dades i típicament treballen amb objectes POJO com el següent:</p>
<section id="exemple-de-pojo" class="level3">
<h3 class="anchored" data-anchor-id="exemple-de-pojo">Exemple de POJO</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">package</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;"> com</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">flx</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">curset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">intro</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">model</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Employee <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-5">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> firstname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-6">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> lastname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb1-8">  </span>
<span id="cb1-9">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Employee</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> firstname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> lastname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">firstname</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> firstname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lastname</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lastname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb1-14">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-15"></span>
<span id="cb1-16">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getId</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-17">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getFirstname</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> firstname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-18">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getLastname</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> lastname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-19">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb1-20"></span>
<span id="cb1-21">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setId</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-22">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setFirstname</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> firstname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">firstname</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> firstname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-23">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setLastname</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> lastname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lastname</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lastname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-24">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">...</span></span>
<span id="cb1-25"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Tot POJO ha de complir els següents requeriments:</p>
<ul>
<li>Representa un objecte <em>útil</em> de dades completament definit i auto-tancat.</li>
<li>Presenta uns atributs privats que donen valor a l’objecte.</li>
<li>Presenta mètodes <em>setter</em> i <em>getter</em> per tal de manipular i obtenir la informació de l’objecte.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>És recomanable treballar amb paquets per separar de manera adient els objectes de la capa de dades (model de dades) de la resta de l’aplicació. Observi’s el <code>package</code> de l’exemple POJO mostrat.</p>
</div>
</div>
<p>Els diferents models d’accés a dades (BDR, BDOR, BDO, XND, …) permetran l’extracció, inserció i modificació de dades a través d’una col·lecció d’objectes POJO adient.</p>


</section>
</section>

 ]]></description>
  <category>bases de dades</category>
  <category>rdbms</category>
  <category>oodbms</category>
  <category>ordbms</category>
  <category>mysql</category>
  <category>java</category>
  <category>jdbc</category>
  <category>jaxb</category>
  <category>stax</category>
  <category>hibernate</category>
  <category>jpa</category>
  <category>criteriabuilder</category>
  <category>jpql</category>
  <category>db4o</category>
  <category>soda</category>
  <category>xpath</category>
  <category>xquery</category>
  <category>xnd</category>
  <guid>https://www.flx.cat/posts/2013-06-29-BD01-tipus-de-bases-de-dades/</guid>
  <pubDate>Fri, 28 Jun 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-06-29-BD01-tipus-de-bases-de-dades/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>ORDBMS amb Oracle</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-06-29-BD03-ordbms-amb-oracle/</link>
  <description><![CDATA[ 





<p>Tota la informació està disponible al web de Oracle:</p>
<ul>
<li><a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28371/adobjint.htm">Introduction to Oracle Objects</a></li>
<li><a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28371/adobjenv.htm">Object Support in Oracle Programming Environments</a></li>
</ul>



 ]]></description>
  <category>bases de dades</category>
  <category>oodbms</category>
  <category>ordbms</category>
  <category>oracle</category>
  <guid>https://www.flx.cat/posts/2013-06-29-BD03-ordbms-amb-oracle/</guid>
  <pubDate>Fri, 28 Jun 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-06-29-BD03-ordbms-amb-oracle/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>XML i Java amb StaX i JAXB</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-06-29-BD04-xml-java-stax-jaxb/</link>
  <description><![CDATA[ 





<section id="arxius-xml" class="level2">
<h2 class="anchored" data-anchor-id="arxius-xml">1. Arxius XML</h2>
<section id="característiques-principals" class="level3">
<h3 class="anchored" data-anchor-id="característiques-principals">1.1. Característiques principals</h3>
<p>XML són les sigles de <strong><em>eXtensible Markup Language</em></strong>, i va ser definit el 1998 pel <strong><em>World Wide Web Consortium</em> (W3C)</strong>.</p>
<p>Els documents XML estan formats per una col·lecció d’elements. Cadascun d’ells està delimitat entre marques d’inici i de final (aquestes marques habitualment s’anomenen <strong><em>tags</em></strong>).</p>
<p>Tot document XML ha de presentar un únic element arrel, que encerclarà tots els altres elements. Aquest element arrel és únic (un i només un) i serà l’arrel de l’arbre d’elements que conformen el document.</p>
<p>S’ha de tenir en compte que l’especificació dels arxius XML diferencia entre majúscules i minúscules i cal tenir això present en la seva definició i manipulació.</p>
<p>Característiques d’un arxiu XML correctament formatat:</p>
<ul>
<li>Sempre comença per un pròleg.</li>
<li>Cada marca d’apertura té la seva corresponent de tancament.</li>
<li>Totes les marques estan completament niades (estructurades en arbre).</li>
</ul>
<p>Característiques d’un arxiu XML <strong>vàlid</strong>:</p>
<ul>
<li>Ha de ser correctament formatat (criteris anteriors).</li>
<li>Ha de contenir un enllaç a un esquema XML i ha de ser vàlid respecte d’aquell esquema.</li>
</ul>
</section>
<section id="exemple-darxiu-xml" class="level3">
<h3 class="anchored" data-anchor-id="exemple-darxiu-xml">1.2. Exemple d’arxiu XML</h3>
<p>El següent és un arxiu XML correctament formatat i vàlid:</p>
<p><strong>Arxiu biblio.xml</strong></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>biblio.xml</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="biblio.xml" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;!DOCTYPE</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">biblioteca</span> SYSTEM "biblio.dtd"<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- Un exemple de base de dades bibliogràfica --&gt;</span></span>
<span id="cb1-4">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">biblioteca</span>&gt;</span>
<span id="cb1-5">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'978-0156837507'</span>&gt;</span>
<span id="cb1-6">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;en&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb1-7">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Solaris&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb1-8">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Stanislaw Lem&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb1-9">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb1-10">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'978-2070575923'</span>&gt;</span>
<span id="cb1-11">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;fr&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb1-12">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Le Petit Prince&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb1-13">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Antoine de Saint-Exupéry&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb1-14">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb1-15">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'978-8474103656'</span>&gt;</span>
<span id="cb1-16">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;ca&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb1-17">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span>La fi de l'eternitat<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb1-18">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Isaac Asimov&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb1-19">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb1-20">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'978-0441010622'</span>&gt;</span>
<span id="cb1-21">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;en&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb1-22">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Dune&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb1-23">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Frank Herbert&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb1-24">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb1-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- més llibres ... --&gt;</span></span>
<span id="cb1-26">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">biblioteca</span>&gt;</span></code></pre></div>
</div>
</section>
<section id="consideracions-de-sintaxi" class="level3">
<h3 class="anchored" data-anchor-id="consideracions-de-sintaxi">1.3. Consideracions de sintaxi</h3>
<p>Observant l’exemple mostrat, destaquem les següents característiques en el seu format:</p>
<ul>
<li><p>Els arxius XML, com es veu, sempre comencen per un pròleg que descriu l’arxiu XML mateix. Aquest pròleg pot ser mínim, com:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span></code></pre></div>
<p>O pot contenir altre informació, com la codificació dels caràcters i altres propietats:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> standalone=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span></code></pre></div></li>
<li><p>També s’ha de tenir en compte que un <em>tag</em> que no conté contingut al seu interior es coneix com a <strong><em>tag</em> buit</strong>. Per exemple: “<code>&lt;logo/&gt;</code>”.</p></li>
<li><p>Els <strong>comentaris</strong> en XML es defineixen així: <code>&lt;!-- comentari --&gt;</code>.</p></li>
<li><p>Si hem d’incloure algun caràcter que pugui ser interpretat per la mateixa sintaxi de XML, haurem d’escapar-lo per prevenir la confusió amb el significat estàndard. Els caràcters que presenten escapament són els següents:</p></li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Caràcter</th>
<th style="text-align: left;">Codi escapat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>&amp;</code> (ampersand)</td>
<td style="text-align: left;"><code>&amp;amp;</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>&lt;</code> (menor que)</td>
<td style="text-align: left;"><code>&amp;lt;</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>&gt;</code> (major que)</td>
<td style="text-align: left;"><code>&amp;gt;</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>'</code> (cometa simple)</td>
<td style="text-align: left;"><code>&amp;apos;</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>"</code> (cometa doble)</td>
<td style="text-align: left;"><code>&amp;quot;</code></td>
</tr>
</tbody>
</table>
</section>
<section id="seccions-cdata" class="level3">
<h3 class="anchored" data-anchor-id="seccions-cdata">1.4. Seccions <code>CDATA</code></h3>
<p>En un arxiu o document XML, una secció <code>CDATA</code> és una secció de contingut d’un element que és marcat com a dades exclusivament, de manera que no s’interpreti el seu contingut com a ordres o marques de sintaxi.</p>
<p>Per tant, una secció <code>CDATA</code> és simplement una alternativa de sintaxi per expressar dades textuals, on cap caràcter especial hagi hagut de ser escapat (sense necessitat de <code>&lt;</code> o <code>&amp;</code>, per exemple).</p>
<p>La secció marcada <code>CDATA</code> ha d’estar encerclada de la següent manera:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb4-1"><span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span> ... text ... <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span></span></code></pre></div>
<p>Tot el text inclòs en la secció <code>CDATA</code> serà interpretat com a caràcters literal, sense marques o referència a entitats.</p>
<p>Així doncs, si en un document XML haguéssim d’enregistrar una condició com <code>(edat&lt;40) &amp;&amp; (tipus&gt;3)</code>, ho podríem fer de dues maneres:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb5-1">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">condicio</span>&gt; (edat<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;lt;</span>40) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;amp;&amp;amp;</span> (tipus<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;gt;</span>3) &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">condicio</span>&gt;</span>
<span id="cb5-2">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">condicio</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span> (edat&lt;40) &amp;&amp; (tipus&gt;3) <span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">condicio</span>&gt;</span></code></pre></div>
<p>Com es veu, la segona permet una lectura immediata, però ha d’estar encerclada entre les marques que defineixen la secció <code>CDATA</code>.</p>
</section>
<section id="esquemes-xml" class="level3">
<h3 class="anchored" data-anchor-id="esquemes-xml">1.5. Esquemes XML</h3>
<p>El mecanisme més senzill per proporcionar una sintaxi per a l’estructura d’un document XML determinat és la definició d’un <strong>DTD (<em>Document Type Definition</em>)</strong>. N’hi ha altres tècniques, però aquesta és la més senzilla i còmoda, a més de formar part de l’estàndard original XML.</p>
<p>En aquest sentit, un esquema XML especifica formalment l’estructura del document XML, permetent:</p>
<ul>
<li><strong>Validació</strong>: Assegurem que conté les dades correctes en els llocs correctes.</li>
<li><strong>Interoperativitat</strong>: Com que disposar de la sintaxi de l’estructura no genera dubtes, diferents equips de persones poden treballar en el document sabent de quina manera quedarà estructurada la informació.</li>
<li><strong>Generació de codi</strong>: Es poden utilitzar els esquemes XML per generar codi que permeti als desenvolupadors llegir i escriure documents XML seguint l’estructuració descrita. A aquesta tècnica se la coneix com <strong><em>Binding</em></strong> i serà estudiada en el curs. Existeix <em>Binding</em> XML de dades per a C#, C++, Java, Visual Basic, VB.Net, entre altres.</li>
<li><strong>Visualitzacions</strong>: És possible mostrar de manera adient l’estructura d’un arxiu XML si coneixem la seva sintaxi estructural. Així podem generar vistes sobre les dades del document o automatitzar processos de visualització de forma senzilla.</li>
<li><strong>Documentació</strong>: Un esquema XML pot contenir documentació, que serà processada a altres formats segons convingui.</li>
</ul>
<p>Un exemple d’esquema XML en format DTD podria ser el següent:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>biblio.dtd</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="biblio.dtd" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!-- Aquesta és la DTD de la biblioteca --&gt;</span></span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>!ELEMENT biblioteca (llibre)*&gt;</span>
<span id="cb6-5"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>!ELEMENT llibre (idioma, titol, autor)&gt;</span>
<span id="cb6-6"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>!ATTLIST llibre isbn CDATA #REQUIRED&gt;</span>
<span id="cb6-7"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>!ELEMENT idioma (#PCDATA)&gt;</span>
<span id="cb6-8"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>!ELEMENT titol (#PCDATA)&gt;</span>
<span id="cb6-9"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>!ELEMENT autor (#PCDATA)&gt;</span></code></pre></div>
</div>
<p>Observi com s’indica que una biblioteca està formada per un o més llibres, que els llibres han de presentar tres elements al seu interior (idioma, títol i autor) i un atribut (el ISBN).</p>
<p>Observi també com s’ha especificat el tipus de dades dels diferents elements: el ISBN és <code>CDATA</code> (text directe) mentre que els elements idioma, títol i autor són text interpretat (que pot escapar-se o encerclar-se amb una secció <code>CDATA</code>).</p>
</section>
<section id="conclusions-sobre-lús-de-xml" class="level3">
<h3 class="anchored" data-anchor-id="conclusions-sobre-lús-de-xml">1.6. Conclusions sobre l’ús de XML</h3>
<p>Els <strong>avantatges</strong> més importants de fer servir arxius XML sobre altres tipus de format són:</p>
<ul>
<li>El contingut dels arxius XML és text pla.</li>
<li>Representa dades sense definir com han de ser mostrades.</li>
<li>Pot ser transformat en altres formats aplicant XSL.</li>
<li>Pot ser fàcilment processat mitjançant <em>parsers</em> estàndard.</li>
<li>Presenta una estructura jeràrquica.</li>
</ul>
<p>Només destaca un <strong>inconvenient</strong>, i és que en alguns tipus de documents i dades genera un gran volum de marques per descriure correctament el contingut de dades del mateix. Un exemple d’això és <strong>MathML</strong> (que molt poca gent fa servir en productes comercials).</p>
<p>Observi el següent exemple de MathML:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb7-1">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">math</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> xmlns=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://www.w3.org/1998/Math/MathML"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> display=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"block"</span>&gt;</span>
<span id="cb7-2">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-3">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;x&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;</span>
<span id="cb7-4">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;=&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;</span>
<span id="cb7-5">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mfrac</span>&gt;</span>
<span id="cb7-6">      &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-7">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;#x2212;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;</span>
<span id="cb7-8">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;b&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;</span>
<span id="cb7-9">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;#xB1;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;</span>
<span id="cb7-10">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">msqrt</span>&gt;</span>
<span id="cb7-11">          &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-12">            &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">msup</span>&gt;</span>
<span id="cb7-13">              &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;b&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;</span>
<span id="cb7-14">              &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mn</span>&gt;2&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mn</span>&gt;</span>
<span id="cb7-15">            &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">msup</span>&gt;</span>
<span id="cb7-16">            &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;#x2212;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mo</span>&gt;</span>
<span id="cb7-17">            &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mn</span>&gt;4&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mn</span>&gt;</span>
<span id="cb7-18">            &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;a&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;</span>
<span id="cb7-19">            &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;c&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;</span>
<span id="cb7-20">          &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-21">        &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">msqrt</span>&gt;</span>
<span id="cb7-22">      &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-23">      &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-24">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mn</span>&gt;2&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mn</span>&gt;</span>
<span id="cb7-25">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;a&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mi</span>&gt;</span>
<span id="cb7-26">      &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-27">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mfrac</span>&gt;</span>
<span id="cb7-28">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">mrow</span>&gt;</span>
<span id="cb7-29">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">math</span>&gt;</span></code></pre></div>
<p>El resultat d’aquest XML, aplicant-li un renderitzador adequat (per exemple, el navegador Safari n’incorpora un per defecte), serà visualitzat com a:</p>
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2013-06-29-BD04-xml-java-stax-jaxb/images/captura_formula_xml.png" class="img-fluid figure-img"></p>
<figcaption>Formula MathML renderitzada</figcaption>
</figure>
</div>
</div>
<p>Aquesta mateixa fórmula, codificada en LaTeX, simplement és:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb8-1">x=<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\frac</span>{-b<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">\pm\sqrt</span>{b^2-4ac}}{2a}</span></code></pre></div>
<p>Resultant en:</p>
<p><img src="https://latex.codecogs.com/png.latex?%20x=%5Cfrac%7B-b%5Cpm%5Csqrt%7Bb%5E2-4ac%7D%7D%7B2a%7D%20"></p>
<p>Podem dir que XML és útil sempre i quan és evident aplicar-lo. Si quan l’apliquem, l’estructura és complexa i difícil de seguir i llegir, aleshores és millor alguna altra alternativa, excepte el cas en què volem un format uniforme que sempre tingui el mateix aspecte i estructura.</p>
<p>No és la finalitat d’aquest curs aprendre les interioritats i detalls menors en l’estructura de XML, però sí en farem ús i per tant hem d’estar familiaritzats amb els seus trets bàsics. D’aquí que s’hagi presentat una introducció al tema i no una anàlisi en profunditat.</p>
</section>
</section>
<section id="mètodes-daccés-a-arxius-xml" class="level2">
<h2 class="anchored" data-anchor-id="mètodes-daccés-a-arxius-xml">2. Mètodes d’accés a arxius XML</h2>
<p>Per accedir a les dades que estan emmagatzemades en un document XML, podem triar entre dues tècniques bàsiques:</p>
<ul>
<li><p>El <strong><em>parser</em></strong> o <strong>analitzador sintàctic</strong>: Aquest mecanisme consisteix en recórrer l’arxiu XML per extreure la informació seguint les característiques estructurals que presenta. Requereix codificar (d’una manera o altre) la sintaxi de l’esquema utilitzat o proporcionar l’esquema externament, de manera que el <em>parser</em> pugui interpretar l’estructura de manera adequada.</p></li>
<li><p>El <strong><em>binding</em></strong> o <strong>vinculació de dades</strong>: Aquest altre mecanisme permet vincular les dades dels objectes i estructures del llenguatge amb els seus corresponents elements del document XML. D’alguna manera es realitza una <strong>sincronització</strong> entre la rèplica en memòria utilitzada pel llenguatge d’alt nivell i la representació emmagatzemada en el document XML al disc dur.</p></li>
</ul>
<p>De la primera tècnica, el <em>parser</em>, nosaltres treballarem sobre la API de Java anomenada <code>StaX</code>; mentre que sobre la part de <em>binding</em> treballarem amb el API anomenat <code>JAXB</code>.</p>
</section>
<section id="una-api-java-de-parser-stax" class="level2">
<h2 class="anchored" data-anchor-id="una-api-java-de-parser-stax">3. Una API Java de <em>parser</em>: <code>StaX</code></h2>
<p>La tècnica de <em>parser</em> consisteix en recórrer l’arxiu XML i anar descobrint els elements i <em>tags</em> que s’hi troben. En funció de cada cas, el lector anirà enviant la informació trobada a la variable, estructura o classe adient.</p>
<p>Per tant, el programador ha de tenir un coneixement clar de l’estructura del document XML (el seu esquema) i codificar l’anàlisi de l’esquema en el codi del programa. Per a estructures senzilles això no és gaire complicat, però per documents XML amb múltiples nivells jeràrquics, la cosa pot ser força incòmoda i feixuga.</p>
<p>Com a exemple, vegem la següent situació: Disposem de l’arxiu de biblioteca anterior <code>biblio.xml</code> i volem escriure un lector i un escriptor d’aquest format de document.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple número 4</p>
</div>
</div>
<p>Com es veu, el programa desitjat hauria de llegir la biblioteca de l’arxiu, afegir dos llibres més i escriure la biblioteca en un nou arxiu anomenat <code>biblio2.xml</code>.</p>
<p>Tal i com s’ha codificat el programa, necessitem de dues classes noves: <code>Biblioteca</code> i <code>Llibre</code> per mantenir la informació en memòria.</p>
<p>La classe <code>Llibre</code> simplement és una típica classe POJO amb els mètodes <em>setter</em> i <em>getter</em> corresponents per a cada atribut del llibre. A més, una funció <code>toString()</code> que mostra la informació del llibre per pantalla.</p>
<p>Quant a la biblioteca, la cosa ja és més complexa, perquè no només és una llista de llibres, sinó que també hi implementem la lectura i escriptura en arxius XML. Aquesta classe presenta dues parts ben diferenciades:</p>
<ul>
<li><p>Per una banda, tenim el fet que “<em>una biblioteca és una col·lecció de llibres</em>” i això ens comporta una declaració i uns mètodes relacionats.</p></li>
<li><p>Per altra banda, necessitem els mètodes que llegeixen i escriure la informació en arxius XML, i són les funcions <code>carregarXML()</code> i <code>desarXML()</code>. Les dues reben el nom d’arxiu de què es vol llegir o on es vol escriure, respectivament.</p></li>
</ul>
<p>Parlem ara dels mètodes relacionats amb XML (la part prèvia hauria de ser evident a la vista del codi).</p>
<section id="càrrega-darxius-xml" class="level3">
<h3 class="anchored" data-anchor-id="càrrega-darxius-xml">3.1. Càrrega d’arxius XML</h3>
<p>Quant a la càrrega des d’un arxiu XML, podrà observar en la codificació de la funció <code>carregarXML()</code> que requerim un objecte <code>XMLEventReader</code> que és el que va llegint i trobant elements dins de l’arxiu XML. Aquest objecte s’instancia a partir d’un lector d’arxiu de tipus <code>FileInputStream</code>.</p>
<p>Cada vegada que trobem un esdeveniment (amb <code>er.hasNext()</code>), hem de gestionar el seu significat en funció del <em>tag</em> o estructura que contingui:</p>
<ul>
<li>Si és un inici de <em>tag</em> <code>&lt;llibre&gt;</code>, haurem de llegir l’atribut ISBN.</li>
<li>Si és un inici de <em>tag</em> <code>&lt;idioma&gt;</code>, <code>&lt;titol&gt;</code> o <code>&lt;autor&gt;</code>, simplement llegim la dada continguda com a bloc de text.</li>
<li>Si és un tancament de <em>tag</em> <code>&lt;llibre&gt;</code>, haurem de desar el llibre llegit a la biblioteca (cridant <code>afegirLlibre()</code>).</li>
</ul>
</section>
<section id="escriptura-darxius-xml" class="level3">
<h3 class="anchored" data-anchor-id="escriptura-darxius-xml">3.2. Escriptura d’arxius XML</h3>
<p>Quant a l’escriptura a un arxiu XML, podrà veure a la funció <code>desarXML()</code> que hem de realitzar el procés invers al de lectura, generant esdeveniments (elements i atributs) que vagin afegint-se a l’arxiu. És un procés semblant al d’anar escrivint text mesclat amb variables amb funcions bàsiques com <code>println()</code>, però amb mètodes relacionats amb XML.</p>
<p>Observi com definim un <code>XMLEventWriter</code> que és l’encarregat de gestionar l’escriptura en arxiu amb un <code>FileOutputStream</code> com a destí de l’escriptura.</p>
<p>Observarà com es van enviant els diferents elements (inici de document, definició del DTD, afegir un comentari, inici del <em>tag</em> principal <code>&lt;biblioteca&gt;</code>) i aleshores passem a escriure, un a un, tots els llibres de la biblioteca. Posteriorment tancarem el <em>tag</em> de <code>&lt;biblioteca&gt;</code> i el document.</p>
<p>En el cas del format de sortida, s’ha volgut modificar el format, de manera que ara l’idioma sigui un atribut del llibre i no un element diferenciat. Per tant, per a cada llibre s’escriurà el <em>tag</em> d’obertura juntament amb el ISBN i l’idioma, i després el títol i l’autor en <em>tags</em> diferenciats. A més, tots els títols han d’aparèixer escapats dins d’un <em>tag</em> <code>CDATA</code>.</p>
<p>Observi també com s’han anat afegint tabuladors i finals de línia.</p>
<p>L’arxiu generat ha quedat així:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>biblio2.xml</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="biblio2.xml" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span>
<span id="cb9-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;!DOCTYPE</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">biblioteca</span> SYSTEM "biblio.dtd"<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!--Un exemple de base de dades bibliogràfica--&gt;</span></span>
<span id="cb9-4">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">biblioteca</span>&gt;</span>
<span id="cb9-5">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-0156837507"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> idioma=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>&gt;</span>
<span id="cb9-6">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span>Solaris<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb9-7">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Stanislaw Lem&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb9-8">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb9-9">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-2070575923"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> idioma=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fr"</span>&gt;</span>
<span id="cb9-10">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span>Le Petit Prince<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb9-11">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Antoine de Saint-Exupéry&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb9-12">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb9-13">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-8474103656"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> idioma=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ca"</span>&gt;</span>
<span id="cb9-14">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span>La fi de l'eternitat<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb9-15">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Isaac Asimov&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb9-16">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb9-17">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-0441010622"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> idioma=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>&gt;</span>
<span id="cb9-18">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span>Dune<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb9-19">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Frank Herbert&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb9-20">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb9-21">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-84-615-9841-0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> idioma=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ca"</span>&gt;</span>
<span id="cb9-22">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span>Oracle SQL és fàcil!<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb9-23">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Fèlix Galindo Allué&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb9-24">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb9-25">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-13-027363-5"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> idioma=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>&gt;</span>
<span id="cb9-26">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;![CDATA[</span>Thinking in Java<span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">]]&gt;</span>&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb9-27">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Bruce Eckel&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb9-28">  &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb9-29">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">biblioteca</span>&gt;</span></code></pre></div>
</div>
<p>Com veu, la tècnica és senzilla, però es fa llarga la codificació del programa si l’estructura jeràrquica té molts nivells intermedis. Pensi, per exemple, com s’hauria d’implementar un lector per a la fórmula MathML mostrada anteriorment!!!</p>
</section>
</section>
<section id="una-api-java-per-a-binding-jaxb" class="level2">
<h2 class="anchored" data-anchor-id="una-api-java-per-a-binding-jaxb">4. Una API Java per a <em>binding</em>: <code>JAXB</code></h2>
<p>La tècnica anomenada <em>binding</em> consisteix en vincular un objecte o un grup d’objectes amb un document XML, de manera que pugui ser importat cap a aquests objectes i després exportat de nou cap al document:</p>
<ul>
<li><p>Quan s’<strong>importa</strong> el document XML (<strong><em>unmarshalling</em></strong>), es crearan objectes Java associats a aquelles dades XML i amb els atributs assignats als valors que correspongui segons el contingut de l’arxiu XML.</p></li>
<li><p>Quan s’<strong>exporta</strong> el document XML (<strong><em>marshalling</em></strong>), els atributs i valors dels objectes Java seran desats a l’arxiu XML resseguint l’estructura de dades present als objectes.</p></li>
</ul>
<p>Per a que tot això sigui possible, Java ha de conèixer els atributs i els seus noms associats al document XML. A més, els tipus de dada han de ser senzills: enters, text, llistes bàsiques, etc.</p>
<p>Per poder marcar aquestes qüestions s’utilitza una tècnica addicional anomenada <strong><em>annotation</em></strong>. Amb aquesta tècnica s’inclouen directrius que ajuden a discernir característiques i condicions sobre la vinculació dades–XML.</p>
<p>Vegem ara com es construiria una aplicació semblant a la anteriorment mostrada per al cas StaX. Considerem el mateix programa de prova i adaptem-lo a la nova tècnica.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Observi ara l’exemple número 5</p>
</div>
</div>
<p>Quant a la classe <code>ProvaBiblioteca</code> (el programa principal), només hi ha dos canvis importants: S’ha canviat la manera de carregar la biblioteca a un mètode estàtic i s’ha canviat el nom de l’arxiu resultant.</p>
<p>Per a la declaració de la classe <code>Llibre</code> observarà que, com abans, aquesta classe conté la definició dels atributs i els seus corresponents mètodes <em>setter</em> i <em>getter</em>.</p>
<p>A més, trobarà les següents <strong><em>annotations</em></strong>:</p>
<ul>
<li><p>Amb <code>@XmlRootElement(name = "llibre")</code> (línia 5) indiquem que el nom de l’element XML associat a aquesta classe és el <em>tag</em> <code>&lt;llibre&gt;</code>. Observi que la classe té la primera lletra en majúscules i Java és sensible a majúscules. Per això cal indicar la traducció.</p></li>
<li><p>Amb <code>@XmlType(propOrder = { "idioma", "autor", "titol" })</code> (línia 6) indiquem que aquesta classe té aquestes tres propietats associades amb els atributs del mateix nom. Això vol dir que haurà de cercar al document XML aquests tres elements dins del <em>tag</em> assignat a cada llibre.</p></li>
<li><p>Amb <code>@XmlAttribute</code> (línia 22) indiquem que el <em>getter</em> indicat a la línia següent correspon a un atribut del <em>tag</em> <code>&lt;llibre&gt;</code>, a diferència dels altres tres elements.</p></li>
</ul>
<p>I per a la classe <code>Biblioteca</code> tindrem també algunes <strong><em>annotations</em></strong>:</p>
<ul>
<li><p>Amb <code>@XmlRootElement(name = "biblioteca")</code> (línia 8) indiquem com abans que el nom del <em>tag</em> associat a aquesta classe es dirà <code>&lt;biblioteca&gt;</code>.</p></li>
<li><p>Amb <code>@XmlElement(name = "llibre")</code> (línia 14) indiquem que aquesta classe és un receptacle de <em>tags</em> <code>&lt;llibre&gt;</code>. Com abans, s’indica just abans del <em>getter</em> d’aquest element. Els elements descoberts seran enregistrats internament al <code>ArrayList</code> indicat a la línia 10.</p></li>
</ul>
<p>Quan a les funcions de lectura i escriptura del document XML, comentar que:</p>
<ul>
<li>S’ha fet la funció de càrrega en forma estàtica, perquè la lectura que realitza JAXB ja retorna un objecte de la classe arrel.</li>
<li>Sobre la forma de fer la lectura, veurà que el procés és força planer un cop es coneix. S’indica la classe arrel del document (en aquest cas la classe <code>Biblioteca</code>) i el nom de l’arxiu al procés de <em>unmarshalling</em>.</li>
<li>Sobre la forma de fer l’escriptura, veurà que el procés és idèntic al de lectura, canviant el mètode al de <em>marshalling</em>.</li>
<li>A més, en l’escriptura, s’ha indicat amb la propietat adient que volem que faci un bon formatat del document (amb tabuladors i retorns de línia). Si no es posa, el document XML resultant queda tot en una sola línia seguida.</li>
</ul>
<p>El resultat de l’execució d’aquest programa és idèntic a l’anterior. El document XML resultant quedarà així:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>biblio3.xml</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="biblio3.xml" style="background: #f1f3f5;"><pre class="sourceCode numberSource xml number-lines code-with-copy"><code class="sourceCode xml"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">&lt;?xml</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> version=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> encoding=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> standalone=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">?&gt;</span></span>
<span id="cb10-2">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">biblioteca</span>&gt;</span>
<span id="cb10-3">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-0156837507"</span>&gt;</span>
<span id="cb10-4">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;en&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb10-5">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Stanislaw Lem&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb10-6">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Solaris&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb10-7">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb10-8">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-2070575923"</span>&gt;</span>
<span id="cb10-9">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;fr&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb10-10">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Antoine de Saint-Exupéry&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb10-11">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Le Petit Prince&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb10-12">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb10-13">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-8474103656"</span>&gt;</span>
<span id="cb10-14">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;ca&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb10-15">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Isaac Asimov&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb10-16">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;La fi de l'eternitat&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb10-17">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb10-18">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-0441010622"</span>&gt;</span>
<span id="cb10-19">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;en&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb10-20">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Frank Herbert&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb10-21">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Dune&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb10-22">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb10-23">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"978-84-615-9841-0"</span>&gt;</span>
<span id="cb10-24">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;ca&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb10-25">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Fèlix Galindo Allué&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb10-26">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Oracle SQL és fàcil!&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb10-27">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb10-28">    &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> isbn=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-13-027363-5"</span>&gt;</span>
<span id="cb10-29">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;en&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">idioma</span>&gt;</span>
<span id="cb10-30">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;Bruce Eckel&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">autor</span>&gt;</span>
<span id="cb10-31">        &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;Thinking in Java&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">titol</span>&gt;</span>
<span id="cb10-32">    &lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">llibre</span>&gt;</span>
<span id="cb10-33">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">biblioteca</span>&gt;</span></code></pre></div>
</div>
<p>Com veu, inclou els 6 llibres correctament formatats seguint l’estructura dels objectes i les seves dades.</p>
<p>Evidentment aquesta tècnica és aparentment més còmoda, però es complica quan volem utilitzar tipus de dades diferents dels bàsics, o quan volem realitzar estructures XML complexes. No obstant, el codi generat ha estat mínim i resulta una bona primera aproximació per a la lectura i escriptura d’arxius XML senzills.</p>


</section>

 ]]></description>
  <category>bases de dades</category>
  <category>rdbms</category>
  <category>ordbms</category>
  <category>mysql</category>
  <category>java</category>
  <category>jdbc</category>
  <category>stax</category>
  <category>jaxb</category>
  <guid>https://www.flx.cat/posts/2013-06-29-BD04-xml-java-stax-jaxb/</guid>
  <pubDate>Fri, 28 Jun 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-06-29-BD04-xml-java-stax-jaxb/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Curs BBDD i Java (índex)</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-05-10-BD00-curs-bbdd-i-java/</link>
  <description><![CDATA[ 





<div class="column" style="width:30%;">
<p><img src="https://www.flx.cat/posts/2013-05-10-BD00-curs-bbdd-i-java/images/featured.jpg" class="img-fluid"></p>
</div>
<section id="temari-i-distribució-horària" class="level2">
<h2 class="anchored" data-anchor-id="temari-i-distribució-horària">Temari i distribució horària</h2>
<p>DIA 1: Introducció i conceptes bàsics (4h)</p>
<ul>
<li><a href="../2013-06-29-BD01-tipus-de-bases-de-dades">Tipus de BD: discusió i ús i aproximació als punts clau del curs</a></li>
<li><a href="../2013-06-29-BD02-jdbc-amb-sql">BD relacionals (MySQL + Java): JDBC amb SQL</a></li>
<li><a href="../2013-06-29-BD03-ordbms-amb-oracle">BD objecte-relacionals: Oracle</a></li>
<li><a href="../2013-06-29-BD04-xml-java-stax-jaxb">BD natives XML (arxius XML): StaX i JAXB</a></li>
</ul>
<p>DIA 2: Hibernate i persistència (4h)</p>
<ul>
<li><a href="../2013-07-01-BD05-hibernate-mapatge-objecte-relacional">BD relacionals (MySQL + Java): Hibernate</a></li>
<li><a href="../2013-07-01-BD06-hibernate-i-jpa">BD relacionals (MySQL + Java): Hibernate/JPA</a></li>
</ul>
<p>DIA 3: BDOO (4h)</p>
<ul>
<li><a href="../2013-07-02-BD07-oodbms-amb-db4o-i-java">BD orientades a objecte (db4o + Java)</a></li>
</ul>
<p>DIA 4: XND (4h)</p>
<ul>
<li><a href="../2013-07-03-BD08-xnd-xpath-i-xquery">BD natives XML (BaseX + Java): XND: XPath/XQuery</a></li>
<li><a href="../2013-07-03-BD09-xnd-basex-i-java">BD natives XML (BaseX + Java): API Java</a></li>
</ul>
</section>
<section id="arxius-del-curs" class="level2">
<h2 class="anchored" data-anchor-id="arxius-del-curs">Arxius del curs</h2>
<ul>
<li>Sessió número 1 (JDBC, StaX i JAXB): <a href="curset_dia1.zip">curset_dia1.zip</a></li>
<li>Sessió número 2 (Hibernate, JPA): <a href="curset_dia2.zip">curset_dia2.zip</a></li>
<li>Sessió número 3 (db4o): <a href="curset_dia3.zip">curset_dia3.zip</a></li>
<li>Sessió número 4 (BaseX, XPath/XQuery): <a href="curset_dia4.zip">curset_dia4.zip</a></li>
</ul>
</section>
<section id="recursos-externs" class="level2">
<h2 class="anchored" data-anchor-id="recursos-externs">Recursos externs</h2>
<p>General:</p>
<ul>
<li>Bruce Eckel, <strong><em>Thinking in Java</em></strong>, Ed. Prentice Hall, 2000, ISBN: 0-13-027363-5</li>
<li>Diversos autors, <strong><em>Aprenda Java como si estuviera en primero</em></strong>, Escuela Superior de Ingenieros Industriales, Universitat de Navarra, 2000: <a href="http://www.tecnun.es/asignaturas/Informat1/AyudaInf/aprendainf/Java/Java2.pdf"><code>http://www.tecnun.es/asignaturas/Informat1/AyudaInf/aprendainf/Java/Java2.pdf</code></a></li>
</ul>
<p>Sobre bases de dades, tipus de bases de dades i classificacions</p>
<ul>
<li><strong>Concepte de OODBMS</strong>: <a href="http://en.wikipedia.org/wiki/Object_database"><code>http://en.wikipedia.org/wiki/Object_database</code></a></li>
<li><strong>Fonaments de OODBMS: ODL, OML, OCL</strong>: <a href="http://www.xtec.cat/~iguixa/materialsGenerics/USAL_BDOO_MATISSE.pdf"><code>http://www.xtec.cat/~iguixa/materialsGenerics/USAL_BDOO_MATISSE.pdf</code></a></li>
</ul>
<p>Sobre JDBC:</p>
<ul>
<li><strong>The Java Tutorials: JDBC Basics</strong>: <a href="http://docs.oracle.com/javase/tutorial/jdbc/basics/index.html"><code>http://docs.oracle.com/javase/tutorial/jdbc/basics/index.html</code></a></li>
</ul>
<p>Sobre patrons de disseny i DAO:</p>
<ul>
<li><strong>DAO</strong>: <a href="http://en.wikipedia.org/wiki/Data_access_object"><code>http://en.wikipedia.org/wiki/Data_access_object</code></a></li>
<li><strong>Data Access object (DAO) Design Pattern</strong>: <a href="http://www.roseindia.net/tutorial/java/jdbc/dataaccessobjectdesignpattern.html"><code>http://www.roseindia.net/tutorial/java/jdbc/dataaccessobjectdesignpattern.html</code></a></li>
<li><strong>Core J2EE Patterns - Data Access Object</strong>: <a href="http://java.sun.com/blueprints/corej2eepatterns/Patterns/DataAccessObject.html"><code>http://java.sun.com/blueprints/corej2eepatterns/Patterns/DataAccessObject.html</code></a></li>
</ul>
<p>Sobre ORDBMS amb Oracle:</p>
<ul>
<li><strong>Introduction to Oracle Objects</strong>: <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28371/adobjint.htm"><code>http://docs.oracle.com/cd/B28359_01/appdev.111/b28371/adobjint.htm</code></a></li>
<li><strong>Object Support in Oracle Programming Environments</strong>: <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28371/adobjenv.htm"><code>http://docs.oracle.com/cd/B28359_01/appdev.111/b28371/adobjenv.htm</code></a></li>
</ul>
<p>Sobre XML, JAXB i StaX:</p>
<ul>
<li>Lars Vogel, <strong><em>Java and XML - Tutorial</em></strong>: <a href="http://www.vogella.com/articles/JavaXML/article.html"><code>http://www.vogella.com/articles/JavaXML/article.html</code></a></li>
<li>Lars Vogel, <strong><em>JAXB Tutorial</em></strong>: <a href="http://www.vogella.com/articles/JAXB/article.html"><code>http://www.vogella.com/articles/JAXB/article.html</code></a></li>
</ul>
<p>Sobre Hibernate, JPA, HQL, JPQL i CriteriaQuery:</p>
<ul>
<li><strong>Hibernate (Tutorial oficial)</strong>: <a href="http://www.jboss.org/jdf/examples/ticket-monster/tutorial/DataPersistence"><code>http://www.jboss.org/jdf/examples/ticket-monster/tutorial/DataPersistence</code></a></li>
</ul>
<p>Sobre OODBMS:</p>
<ul>
<li><strong>Tutorial oficial de db4o</strong>: <a href="http://community.versant.com/Documentation/Reference/db4o-8.0/java/tutorial/"><code>http://community.versant.com/Documentation/Reference/db4o-8.0/java/tutorial/</code></a></li>
</ul>
<p>Sobre XND:</p>
<ul>
<li><strong>Exemples Java de BaseX</strong>: <a href="http://docs.basex.org/wiki/Java_Examples"><code>http://docs.basex.org/wiki/Java_Examples</code></a></li>
<li><strong>Especificació de XQuery 3.0</strong>: <a href="http://www.w3.org/TR/xquery-30/"><code>http://www.w3.org/TR/xquery-30/</code></a></li>
<li><strong>Tutorial de XQuery</strong>: <a href="http://www.w3schools.com/xquery/default.asp"><code>http://www.w3schools.com/xquery/default.asp</code></a></li>
<li><strong>Funcions XPath</strong>: <a href="http://www.w3.org/TR/xpath-functions-30/"><code>http://www.w3.org/TR/xpath-functions-30/</code></a></li>
<li><strong>Funcions XQuery</strong>: <a href="http://www.xqueryfunctions.com"><code>http://www.xqueryfunctions.com</code></a></li>
</ul>


</section>

 ]]></description>
  <category>bases de dades</category>
  <category>rdbms</category>
  <category>oodbms</category>
  <category>ordbms</category>
  <category>mysql</category>
  <category>java</category>
  <category>jdbc</category>
  <category>jaxb</category>
  <category>stax</category>
  <category>hibernate</category>
  <category>jpa</category>
  <category>criteriabuilder</category>
  <category>jpql</category>
  <category>db4o</category>
  <category>soda</category>
  <category>xpath</category>
  <category>xquery</category>
  <category>xnd</category>
  <guid>https://www.flx.cat/posts/2013-05-10-BD00-curs-bbdd-i-java/</guid>
  <pubDate>Thu, 09 May 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-05-10-BD00-curs-bbdd-i-java/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Creating a new Grub2 background image (menu only) in Ubuntu &gt;11.10</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2013-04-22-creating-a-new-grub2-background-image/</link>
  <description><![CDATA[ 





<p><img src="https://www.flx.cat/posts/2013-04-22-creating-a-new-grub2-background-image/images/featured.jpg" class="img-fluid"></p>
<section id="procedure" class="level1">
<h1>Procedure</h1>
<p>Install the <code>desktop-base</code> package (if not already installed):</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> aptitude install desktop-base</span></code></pre></div>
<p>If you reboot the system, the boot menu will show an <em>ugly</em> background. Right. We’ll change it!</p>
<p>First, we will prepare the image. Get a photo, search your albums, whatever will serve. We will consider the image as if it will reside on <code>/shared/photos/myphoto.jpg</code>. We will keep the grub version under the same directory and then link with it, so follow the next steps.</p>
<p>If your monitor ratio is 16:9, and the original photo is 4:3, you can run the following line in the terminal prompt:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> /shared/photos</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">convert</span> myphoto.jpg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-resize</span> 600x450 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-gravity</span> center <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-background</span> Black <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-extent</span> 800x450 myphoto-grub.png</span></code></pre></div>
<p>But, if your monitor is 16:10, you can run the next variation:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">convert</span> myphoto.jpg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-resize</span> 640x480 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-gravity</span> center <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-background</span> Black <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-extent</span> 768x480 myphoto-grub.png</span></code></pre></div>
<p>As you can see, I’ve used the convert command (from <strong>ImageMagick</strong>), resizing the image to an intermediate size and centering on to the final layout, making the left and right extra bands filled with black.</p>
<p>Adapt it to your needs: maybe the original image is 16:9 or 16:10 already, or your computer has a 4:3 monitor. In such cases, change the resize part and remove the rest of parameters.</p>
<p>Remember the <code>bc</code> command to make simple (or not so-simple) calculations:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scale=10; 450*16/9"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bc</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">800</span></span></code></pre></div>
<p>In my case, I have a photo of one of my sons, and I want to put it bottom-right to the menu, bordered and filling with a similar color of its background:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">convert</span> joan.jpg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-resize</span> 120x90 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-bordercolor</span> White <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-2">-border 1x1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-gravity</span> SouthEast <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-3">-background <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">convert</span> joan.jpg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-format</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%[pixel:s.p{0,0}]"</span> info:<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-4">-extent 800x450 joan_grub.png</span></code></pre></div>
<p>First, I resize it to 120x90 (1/5 in the final image height, 4:3 ratio), I enclose it with a white border, and then put it to the bottom-right of the final extent of 800x450. For the background color, I use another convert execution, that extracts the rgb of the pixel at coordinates (0,0) of the original image. Suit yourself to adapt it to what you want.</p>
<p>In any case, you now have the image at a good (sufficient) resolution for the boot menu. We’ll reassign the link to that image.</p>
<p>By default, the image can be found as <code>/usr/share/images/desktop-base/desktop-grub.png</code>, but this is only a sym-link, so we’ll change the target:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> /usr/share/images/desktop-base</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> rm desktop-grub.png</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> /shared/photos/myphoto-grub.png desktop-grub.png</span></code></pre></div>
<p>As you see, we destroy the original link and then recreate it with our own image path.</p>
<p>If you want to change the default text colors of the menu, edit the <code>/usr/share/desktop-base/grub_background.sh</code> script:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gksudo</span> gedit /usr/share/desktop-base/grub_background.sh</span></code></pre></div>
<p>You can change the two color definition lines:</p>
<ul>
<li><code>COLOR_NORMAL</code> defines the normal color of the menu entries (foreground/background).</li>
<li><code>COLOR_HIGHLIGHT</code> defines the foreground/background colors of the selected entry.</li>
</ul>
<p>For example, I want to make the highlighted with yellow color, so I change only that line:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">COLOR_HIGHLIGHT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>yellow/black</span></code></pre></div>
<p>When a background image is active, background color doesn’t work, so leave it black, as it doesn’t matter.</p>
<p>The color is specified according to RGB codes (“#c3e28a”) or common names (“light-blue”), and are found at <a href="http://www.gnu.org/software/grub/manual/html_node/Theme-file-format.html#Theme-file-format">theming grub</a> …with lots of other interesting configuration parameters!!!</p>
<p>And finally, we re-run the <code>update-grub</code> script:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> update-grub</span></code></pre></div>
<p>And… voilà! Restart the system and enjoy!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2013-04-22-creating-a-new-grub2-background-image/images/foto_grub_amb_joan.jpg" class="img-fluid figure-img"></p>
<figcaption>Foto Grub amb en Joan</figcaption>
</figure>
</div>
<p>Consider the fact that now your boot-menu background-image is redirected to the path you entered, so you can substitute with another (or edit the image with some image-editing tool), and rerun the <code>update-grub</code> script.</p>
<p>Easy, simple, direct, right?</p>


</section>

 ]]></description>
  <category>Linux</category>
  <category>Ubuntu</category>
  <category>Grub</category>
  <guid>https://www.flx.cat/posts/2013-04-22-creating-a-new-grub2-background-image/</guid>
  <pubDate>Sun, 21 Apr 2013 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2013-04-22-creating-a-new-grub2-background-image/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Oracle SQL és fàcil!</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2012-07-19-oracle-sql-es-facil/</link>
  <description><![CDATA[ 





<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2012-07-19-oracle-sql-es-facil/images/frontcover.png" class="img-fluid figure-img"></p>
<figcaption>Portada del llibre</figcaption>
</figure>
</div>
</div><div class="column" style="width:3%;">

</div><div class="column" style="width:67%;">
<p><strong>Oracle SQL és fàcil!</strong></p>
<p>Manual i exemples d’Oracle SQL per a Oracle 10g/11g</p>
<p>ISBN: 978-84-615-9841-0</p>
<p>Publicat: Juliol del 2012</p>
<p><a href="http://www.bubok.es/ver/preview/215522">Veure índex</a> <a href="http://www.bubok.es/libros/215522/Oracle-SQL-es-facil">Més info</a></p>
<p><a href="https://www.safecreative.org/work/1207101946551"><img src="https://www.flx.cat/posts/2012-07-19-oracle-sql-es-facil/images/safecreative.png" style="height:4em"></a></p>
</div>
</div>
<section id="resum" class="level1">
<h1>Resum</h1>
<p>Aquest llibre permet al lector iniciar-se en l’ús de les bases de dades Oracle mitjançant el llenguatge SQL. No s’assumeix cap coneixement previ, tret de nocions generals bàsiques sobre els sistemes operatius.</p>
<p>El llibre cobreix des de les consultes més senzilles fins a objectes complexos com vistes i índexs, passant per subconsultes, unions entre taules, funcions d’agrupació, manipulació de les dades, definició de taules i restriccions, entre d’altres.</p>
<p>#&nbsp;Índex</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;">Part</th>
<th style="text-align: left;">Títol</th>
<th style="text-align: right;">Pàgina</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">&nbsp;</td>
<td style="text-align: left;">Índex</td>
<td style="text-align: right;">Pàg. i</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;</td>
<td style="text-align: left;">&nbsp;Prefaci</td>
<td style="text-align: right;">Pàg. xii</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;1</td>
<td style="text-align: left;">&nbsp;SQL i l’accés a la informació</td>
<td style="text-align: right;">Pàg. 1</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;2</td>
<td style="text-align: left;">&nbsp;Filtrat i ordenació de les dades</td>
<td style="text-align: right;">Pàg. 37</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;3</td>
<td style="text-align: left;">&nbsp;Funcions d’una sola fila</td>
<td style="text-align: right;">Pàg. 57</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;4</td>
<td style="text-align: left;">&nbsp;Consultes amb més d’una taula</td>
<td style="text-align: right;">Pàg. 115</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;5</td>
<td style="text-align: left;">&nbsp;Agrupació, funcions de grup i estadístiques</td>
<td style="text-align: right;">Pàg. 161</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;6</td>
<td style="text-align: left;">&nbsp;Subconsultes</td>
<td style="text-align: right;">Pàg. 189</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;7</td>
<td style="text-align: left;">&nbsp;Personalització de l’entorn SQL*Plus</td>
<td style="text-align: right;">Pàg. 211</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;8</td>
<td style="text-align: left;">&nbsp;Manipulació de les dades</td>
<td style="text-align: right;">Pàg. 267</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;9</td>
<td style="text-align: left;">&nbsp;Definició i gestió de taules</td>
<td style="text-align: right;">Pàg. 299</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;10</td>
<td style="text-align: left;">&nbsp;Restriccions</td>
<td style="text-align: right;">Pàg. 339</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;11</td>
<td style="text-align: left;">&nbsp;Vistes</td>
<td style="text-align: right;">Pàg. 377</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;12</td>
<td style="text-align: left;">&nbsp;Altres objectes de base de dades</td>
<td style="text-align: right;">Pàg. 399</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;</td>
<td style="text-align: left;">&nbsp;Apèndixs</td>
<td style="text-align: right;">Pàg. 423</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;A</td>
<td style="text-align: left;">&nbsp;Bases de dades utilitzades</td>
<td style="text-align: right;">Pàg. 423</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;B</td>
<td style="text-align: left;">&nbsp;Resum de funcions SQL</td>
<td style="text-align: right;">Pàg. 431</td>
</tr>
<tr class="even">
<td style="text-align: right;">&nbsp;C</td>
<td style="text-align: left;">&nbsp;Solucions als exercicis d’autoavaluació</td>
<td style="text-align: right;">Pàg. 441</td>
</tr>
<tr class="odd">
<td style="text-align: right;">&nbsp;</td>
<td style="text-align: left;">&nbsp;Bibliografia</td>
<td style="text-align: right;">Pàg. 477</td>
</tr>
</tbody>
</table>
<section id="arxius-associats-al-llibre" class="level2">
<h2 class="anchored" data-anchor-id="arxius-associats-al-llibre">Arxius associats al llibre</h2>
<p>Pot descarregar els arxius de base de dades associats al llibre amb l’arxiu ZIP següent: <a href="oracle-sql-es-facil-arxius.zip">Arxiu ZIP de contingut</a></p>
</section>
<section id="errades-i-comentaris" class="level2">
<h2 class="anchored" data-anchor-id="errades-i-comentaris">Errades i comentaris</h2>
<p>Encara no s’ha detectat cap errada important…</p>


</section>
</section>

 ]]></description>
  <category>Llibres</category>
  <category>Oracle</category>
  <category>SQL</category>
  <guid>https://www.flx.cat/posts/2012-07-19-oracle-sql-es-facil/</guid>
  <pubDate>Wed, 18 Jul 2012 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2012-07-19-oracle-sql-es-facil/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Format Intel HEX</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2010-11-17-format-intel-hex/</link>
  <description><![CDATA[ 





<section id="format-de-larxiu" class="level2">
<h2 class="anchored" data-anchor-id="format-de-larxiu">Format de l’arxiu</h2>
<p>Els arxius <em>Intel HEX</em> són en realitat arxius de text que segueixen el format anomenat “<em>Intel HEX format</em>”.</p>
<p>Cada línia d’aquests arxius conté un registre HEX. Aquests registres estan formats per nombres expressats en base hexadecimal que representen el codi de llenguatge màquina i/o dades constants.</p>
<p>Els arxius <em>Intel HEX</em> s’utilitzen habitualment per transferir programes i dades que podran ser emmagatzemats en una memòria ROM o EPROM. La majoria de programadors EPROM o emuladors fan servir arxius <em>Intel HEX</em> com a entrada.</p>
</section>
<section id="el-format-dels-registres" class="level2">
<h2 class="anchored" data-anchor-id="el-format-dels-registres">El format dels registres</h2>
<p><img src="https://www.flx.cat/posts/2010-11-17-format-intel-hex/images/hex_format.jpg" class="img-fluid"></p>
<p>Un arxiu <em>Intel HEX</em> està format per qualsevol nombre de registres <em>HEX</em>. Cada registre està format per 5 camps que segueixen la següent disposició:</p>
<pre><code>:llaaaatt[dd...]cc</code></pre>
<p>Cada grup de lletres correspon a un camp diferent, i cada lletra representa un únic dígit hexadecimal. Cada camp està format per un mínim de dos dígits hexadecimals (que formen un byte) tal i com es descriu tot seguit:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 45%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Camp</th>
<th style="text-align: left;">Descripció</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>:</code></td>
<td style="text-align: left;">Marca l’inici de cada registre <em>Intel HEX</em></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ll</code></td>
<td style="text-align: left;">És el camp de longitud de registre i representa el nombre de bytes de dades (<code>dd</code>) en el registre</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>aaaa</code></td>
<td style="text-align: left;">És el camp d’adreça que representa l’adreça inicial per al bloc de dades del registre</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>tt</code></td>
<td style="text-align: left;">És el camp que representa el tipus de registre, que pot ser qualsevol d’entre els següents casos: <br><code>00</code> - registre de dades <br> <code>01</code> - registre de final d’arxiu <br> <code>02</code> - Registre d’adreça de segment extensa <br> <code>04</code> - Registre d’adreça lineal extensa</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>dd</code></td>
<td style="text-align: left;">És el camp de dades que representa un byte de dades. Un registre pot tenir molts bytes de dades. El nombre de bytes de dades del registre ha de coincidir amb la quantitat especificada pel camp <code>ll</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cc</code></td>
<td style="text-align: left;">És el camp de suma de comprovació del registre. Es calcula sumant els valors de totes les parelles de dígits hexadecimals del registre, en mòdul 256, i prenent el complement a 2 del resultat.</td>
</tr>
</tbody>
</table>
</section>
<section id="registres-de-dades" class="level2">
<h2 class="anchored" data-anchor-id="registres-de-dades">Registres de dades</h2>
<p>Un arxiu <em>Intel HEX</em> està format per qualsevol quantitat de registres de dades que terminen amb un retorn de línia i un avanç de línia (CR+LF).</p>
<p>Els registres de dades apareixen així:</p>
<pre><code> :10246200464C5549442050524F46494C4500464C33</code></pre>
<p>Aquest exemple està codificat tal i com s’indica tot seguit:</p>
<pre><code> :10246200464C5549442050524F46494C4500464C33
 |||||||||{&lt;-------- DD (Dades) --------&gt;}||
 |||||||||                                ||
 |||||||TT (Tipus de registre)            CC (Suma de comprovació)
 |||AAAA (Adreça inicial)
 |LL (Longitud del registre)
 : (Inici de registre)</code></pre>
<p>Per tant:</p>
<ul>
<li><code>10</code> és el nombre de bytes de dades en el registre (16 bytes).</li>
<li><code>2462</code> és l’adreça on les dades hauran de ser col·locades a memòria.</li>
<li><code>00</code> és el tipus de registre (un registre de dades en aquest cas).</li>
<li><code>33</code> és la suma de comprovació del registre.</li>
</ul>
</section>
<section id="registres-dadreça-lineal-extensa-hex386" class="level2">
<h2 class="anchored" data-anchor-id="registres-dadreça-lineal-extensa-hex386">Registres d’adreça lineal extensa (HEX386)</h2>
<p>Els registres d’adreça lineal extensa són també coneguts com a “registres d’adreça de 32 bits” o registres HEX386. Aquests registres contenen els 16 bits de la part alta (bits 16-31) de l’adreça de les dades.</p>
<p>Els registres d’adreça lineal extensa presenten sempre dos bytes de dades i apareixen com es mostra en aquest exemple:</p>
<pre><code> :02000004FFFFFC</code></pre>
<p>On:</p>
<ul>
<li><p><code>02</code> és la quantitat de bytes de dades del registre.</p></li>
<li><p><code>0000</code> és el camp d’adreça. En aquests registres aquest camp és sempre 0000.</p></li>
<li><p><code>04</code> és el tipus de registre pels registres d’adreça lineal extensa.</p></li>
<li><p><code>FFFF</code> és la part alta de l’adreça en aquest exemple.</p></li>
<li><p><code>FC</code> és la suma de comprovació del registre, calculada com a:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Coverline%7B%200x02%20+%200x00%20+%200x00%20+%200x04%20+%200xFF%20+%200xFF%20%7D%20+%200x01%20=%200xFC"></p></li>
</ul>
<p>Quan es llegeix un registre d’adreça lineal extensa, la part alta llegida del registre en el camp de dades s’aplica en el càlcul d’adreça completa dels registres següents de l’arxiu <em>Intel HEX</em>. L’adreça lineal extensa roman efectiva fins que no es canviï per una altra amb un nou registre d’aquest tipus.</p>
<p>L’adreça absoluta de memòria d’un registre de dades s’obtindrà afegint el camp d’adreça del registre a l’adreça de les dades del registre d’adreça lineal extensa. L’exemple següent il·lustra aquest procés:</p>
<pre><code> Adreça del camp d'adreça del registre de dades        2462
 Adreça lineal extensa activa                      FFFF
                                                   --------
 Adreça de memòria absoluta                        FFFF2462</code></pre>
</section>
<section id="registre-dadreça-de-segment-extensa-hex86" class="level2">
<h2 class="anchored" data-anchor-id="registre-dadreça-de-segment-extensa-hex86">Registre d’adreça de segment extensa (HEX86)</h2>
<p>Els registres d’adreça de segment extensa, també coneguts com a registres HEX86, contenen els bits 4-19 de l’adreça de segment de les dades.</p>
<p>Els registres d’adreça de segment extensa sempre presenten dos bytes de dades i apareixen com es mostra aquí:</p>
<pre><code> :020000021200EA</code></pre>
<p>On:</p>
<ul>
<li><p><code>02</code> és la quantitat de bytes de dades del registre.</p></li>
<li><p><code>0000</code> és el camp d’adreça. En aquests registres aquest camp és sempre 0000.</p></li>
<li><p><code>02</code> és el tipus de registre pels registres d’adreça de segment extensa.</p></li>
<li><p><code>1200</code> és la part alta de l’adreça en aquest exemple.</p></li>
<li><p><code>EA</code> és la suma de comprovació del registre, calculada com a:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Coverline%7B%200x02%20+%200x00%20+%200x00%20+%200x02%20+%200x12%20+%200x00%20%7D%20+%200x01%20=%200xEA"></p></li>
</ul>
<p>Quan es llegeix un registre d’adreça de segment extensa, l’adreça de segment extensa emmagatzemada en el camp de dades es desa i s’aplica als registres llegits a continuació en l’arxiu HEX. El segment d’adreça roman efectiu fins que no es canviï per un altre registre d’adreça de segment.</p>
<p>L’adreça de memòria absoluta d’un registre de dades s’obté afegint el camp d’adreça del registre amb l’adreça de segment del registre d’adreça de segment extensa. El següent exemple il·lustra aquest procés:</p>
<pre><code> Adreça del camp d'adreça del registre de dades        2462
 Adreça de segment extensa activa                     1200
                                                   --------
 Adreça de memòria absoluta                        00014462</code></pre>
</section>
<section id="registre-de-final-darxiu-eof" class="level2">
<h2 class="anchored" data-anchor-id="registre-de-final-darxiu-eof">Registre de final d’arxiu (EOF)</h2>
<p>Un arxiu <em>Intel HEX</em> ha d’acabar amb un registre de final d’arxiu (EOF, <em>End-Of-File</em>). Aquest registre ha de tenir el valor <code>01</code> com a tipus de registre, i sempre apareix com es mostra aquí:</p>
<pre><code> :00000001FF</code></pre>
<p>On:</p>
<ul>
<li><p><code>00</code> és la quantitat de bytes de dades del registre.</p></li>
<li><p><code>0000</code> és el camp d’adreça. En aquests registres aquest camp no té cap significat i és ignorat. Sol fer-se servir 0000.</p></li>
<li><p><code>01</code> és el tipus de registre pel registre de final d’arxiu.</p></li>
<li><p><code>FF</code> és la suma de comprovació del registre, calculada com a:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Coverline%7B%200x00%20+%200x00%20+%200x00%20+%200x01%20%7D%20+%200x01%20=%200xFF"></p></li>
</ul>
</section>
<section id="exemple-darxiu-intel-hex" class="level2">
<h2 class="anchored" data-anchor-id="exemple-darxiu-intel-hex">Exemple d’arxiu Intel HEX</h2>
<p>A continuació es mostra l’exemple d’un arxiu complet <em>Intel HEX</em>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>example.hex</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="example.hex" style="background: #f1f3f5;"><pre class="sourceCode numberSource plain number-lines code-with-copy"><code class="sourceCode"><span id="cb9-1">:10001300AC12AD13AE10AF1112002F8E0E8F0F2244</span>
<span id="cb9-2">:10000300E50B250DF509E50A350CF5081200132259</span>
<span id="cb9-3">:03000000020023D8</span>
<span id="cb9-4">:0C002300787FE4F6D8FD7581130200031D</span>
<span id="cb9-5">:10002F00EFF88DF0A4FFEDC5F0CEA42EFEEC88F016</span>
<span id="cb9-6">:04003F00A42EFE22CB</span>
<span id="cb9-7">:00000001FF</span></code></pre></div>
</div>
<p>Si fa les comprovacions, aquest arxiu és tot un arxiu de dades, amb diferents fragments declarats a cada línia de l’arxiu:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1">0x0013 : AC 12 AD 13 AE 10 AF 11 12 00 2F 8E 0E 8F 0F 22</span>
<span id="cb10-2">0x0003 : E5 0B 25 0D F5 09 E5 0A 35 0C F5 08 12 00 13 22</span>
<span id="cb10-3">0x0000 : 02 00 23</span>
<span id="cb10-4">0x0023 : 78 7F E4 F6 D8 FD 75 81 13 02 00 03</span>
<span id="cb10-5">0x002F : EF F8 8D F0 A4 FF ED C5 F0 CE A4 2E FE EC 88 F0</span>
<span id="cb10-6">0x003F : A4 2E FE 22</span></code></pre></div>
<p>Redreçant tot el bloc en ordre, posant-lo en línies de 16 bytes per línia, composaria el següent arxiu binari (mostrat aquí en notació <code>hexdump</code>):</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1">00000000  02 00 23 e5 0b 25 0d f5  09 e5 0a 35 0c f5 08 12  |..#..%.....5....|</span>
<span id="cb11-2">00000010  00 13 22 ac 12 ad 13 ae  10 af 11 12 00 2f 8e 0e  |.."........../..|</span>
<span id="cb11-3">00000020  8f 0f 22 78 7f e4 f6 d8  fd 75 81 13 02 00 03 ef  |.."x.....u......|</span>
<span id="cb11-4">00000030  f8 8d f0 a4 ff ed c5 f0  ce a4 2e fe ec 88 f0 a4  |................|</span>
<span id="cb11-5">00000040  2e fe 22                                          |.."|</span></code></pre></div>


</section>

 ]]></description>
  <category>Electrònica</category>
  <category>Intel HEX format</category>
  <category>flash</category>
  <category>compilació</category>
  <category>assemblador</category>
  <category>microcontrolador</category>
  <category>microprocessador</category>
  <category>pic</category>
  <category>memòria</category>
  <category>programació</category>
  <guid>https://www.flx.cat/posts/2010-11-17-format-intel-hex/</guid>
  <pubDate>Tue, 16 Nov 2010 23:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2010-11-17-format-intel-hex/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Elements de sortida electrònics (I)</title>
  <dc:creator>Fèlix </dc:creator>
  <link>https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/</link>
  <description><![CDATA[ 





<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/featured.jpg" class="img-fluid"></p>
<section id="el-led" class="level2">
<h2 class="anchored" data-anchor-id="el-led">El LED</h2>
<p>Sense entrar en consideracions físiques o electròniques sobre el silici i els diferents dopants que fan possible l’existència dels LEDs, tots sabem que n’existeixen de diferents mides i colors. Podem trobar actualment fins i tot aquells que tenen la possibilitat de mostrar-nos més d’un color (bi-color, tri-color), o fins i tot els LEDs RGB, que permeten la construcció de qualsevol color activant independentment cadascun dels tres colors bàsics (vermell, verd i blau) a diferents nivells d’intensitat.</p>
<p>Per al nostre estudi inicial considerarem només els LEDs d’un sol color, els tradicionals. Pensi’s, per tant, en el típic LED de color vermell, de 5mm de diàmetre.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/Diode_LED_Vermell.png" class="centered img-fluid figure-img"></p>
<figcaption>LED vermell de 5mm</figcaption>
</figure>
</div>
<p>Aquests LEDs tenen, com a característica principal, que amb només 10mA de corrent al seu través i un mínim d’entre 1.7V i 2.2V entre els seus terminals, ja donen prou llum com per a considerar-los plenament encesos.</p>
<p>Per tant, el mecanisme de càlcul és senzill:</p>
<ul>
<li>Hem d’assegurar-nos que la tensió disponible és superior als 1.7V – 2.2V</li>
<li>La intensitat de llum generada és proporcional al corrent que passa al seu través</li>
<li>Si tenim més de 1.7V – 2.2V, hem de col·locar una resistència limitadora que es quedi amb la resta de tensió; aprofitant-la, de retruc, per a fixar el corrent que passarà a través del LED</li>
</ul>
<p>Amb tot el que s’ha dit, assumeixi’s el circuit de la figura següent:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/circuit_led_senzill.png" class="img-fluid figure-img"></p>
<figcaption>Circuit senzill amb LED</figcaption>
</figure>
</div>
<p>En aquesta simulació de Proteus pot veure’s com, amb una alimentació de 5V, una resistència de 220Ω fa que el corrent que passa a través del LED sigui d’aproximadament 14mA. En la majoria de casos, aquest nivell de brillantor és més que suficient.</p>
<p>El càlcul involucrat és el següent:</p>
<ul>
<li>Suposem que volem encendre el LED amb 15mA de corrent (nivell de llum intens, però no extrem)</li>
<li>Considerem que el LED treballa a 1.7V</li>
</ul>
<p>Aleshores,</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%20R=%5Cfrac%7B5-1.7%7D%7B0.015%7D=220%5COmega%20"></p>
<p>Així es fa per trobar la resistència adequada per a cada cas de tensió i corrent desitjats.</p>
<p>El valor més habitual de resistència limitadora és de 220Ω o 330Ω, per a una alimentació a 5V. A vegades 470Ω per a il·luminació suau:</p>
<ul>
<li>Amb R=220Ω: <img src="https://latex.codecogs.com/png.latex?I=%5Cfrac%7B5-1.7%7D%7B220%7D=15%5Ctextrm%7BmA%7D"></li>
<li>Amb R=330Ω: <img src="https://latex.codecogs.com/png.latex?I=%5Cfrac%7B5-1.7%7D%7B330%7D=10%5Ctextrm%7BmA%7D"></li>
<li>Amb R=470Ω: <img src="https://latex.codecogs.com/png.latex?I=%5Cfrac%7B5-1.7%7D%7B470%7D=7%5Ctextrm%7BmA%7D"></li>
</ul>
<p>També podem posar el LED a la part superior, i deixar la resistència a sota. És a dir, intercanviant els papers de resistència i LED.</p>
<p>Els circuits de lògica digital, els microprocessadors i altres components d’altes prestacions, lliuren un “0” o un “1” lògics, que queden codificats amb una tensió baixa i una tensió alta, respectivament.</p>
<p>Podem aprofitar el cas de sortida “1” per encendre un LED, connectant-lo al zero a través d’una resistència, com abans. Si el terminal treu un “0”, el LED romandrà apagat.</p>
<p>Però també podem aprofitar el cas de sortida a “0” per a encendre el LED, ara connectant-lo a través d’una resistència al positiu de l’alimentació. El terminal treurà un “0” lògic, que serà una tensió baixa, i el LED s’encendrà. Si el terminal treu un “1”, el LED romandrà apagat.</p>
<p>Els valors concrets amb què això succeeix poden variar, considerant que el nivell mínim d’operació d’un transistor és de 0.6V. Això comporta que, habitualment, el “0” queda codificat amb un nivell baix de 0.6V aproximadament; mentre que el “1”, nivell alt, és d’uns 4V.</p>
<p>Això permet que, de fet, els circuits lògics podem actuar directament sobre un LED, sempre i quan el circuit integrat determinat tingui prou corrent disponible a les seves sortides. Això <strong>sempre</strong> s’ha de comprovar prèviament, perquè podria fer malbé el dispositiu, sobretot en el cas de microprocessadors d’alta capacitat quant a càlcul i velocitats.</p>
<p>Els paràmetres per a aquesta comprovació són:</p>
<ul>
<li>El corrent màxim permès per terminal de sortida, considerant el corrent sortint (LED encès amb “1” lògic). Normalment anomenat <img src="https://latex.codecogs.com/png.latex?I_%7BOH,max%7D">, o sota la terminologia “<em>Max. current (source)</em>”</li>
<li>El corrent màxim permès per terminal de sortida, considerant el corrent entrant (LED encès amb “0” lògic). Normalment anomenat <img src="https://latex.codecogs.com/png.latex?I_%7BOL,max%7D">, o sota la terminologia “<em>Max. current (sink)</em>”</li>
<li>El màxim de corrent sortint global de tot el dispositiu (la suma de tots els corrents sortints de tots els terminals): Alguns dispositius tenen un màxim global per qüestions de dissipació de calor</li>
<li>El màxim de corrent entrant global de tot el dispositiu (la suma de tots els corrents entrants de tots els terminals)</li>
</ul>
<p>No obstant això, la majoria de circuits integrats permetran els 10mA necessaris per a il·luminar un LED en algun terminal de sortida. I, de fet, uns quants LEDs situats en diferents terminals. Observi’s la figura següent:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/circuit_led_complex.png" class="img-fluid figure-img"></p>
<figcaption>Circuit amb diversos LEDs</figcaption>
</figure>
</div>
<p>En aquest cas s’ha considerat que, si el microprocessador lliura un “1” lògic per un terminal determinat dels utilitzats (<code>RA0</code>, <code>RA1</code>, <code>RA2</code> o <code>RA3</code>), aleshores el LED corresponent s’encendrà.</p>
<p>Podem commutar la polaritat dels LEDs i connectar al positiu, redreçant el circuit tal i com es mostra a la figura següent:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/circuit_led_complex_neg.png" class="img-fluid figure-img"></p>
<figcaption>Circuit amb diversos LEDs, per a nivell baix</figcaption>
</figure>
</div>
<p>En aquest cas, per encendre un LED s’haurà de treure un “0” lògic pel terminal corresponent.</p>
</section>
<section id="la-barra-de-leds" class="level2">
<h2 class="anchored" data-anchor-id="la-barra-de-leds">La barra de LEDs</h2>
<p>Als circuits on es necessiti un nombre elevat de LEDs, o si volem construir un indicador de nivell amb LEDs (un termòmetre, per exemple), podem fer servir les barres de LEDs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/array_leds.png" class="img-fluid figure-img"></p>
<figcaption>Array de LEDs</figcaption>
</figure>
</div>
<p>Aquests elements disposen d’un determinat nombre de LEDs en un encapsulat únic (típicament 10), cosa que millora el disseny del circuit físic, permetent reduir la seva mida.</p>
<p>Típicament poden trobar-se de colors vermell o verd en configuracions de 10 LEDs.</p>
<p>El tipus d’encapsulat (<em>footprint</em>) és el mateix que el d’un circuit integrat de 20 terminals (10 a cada banda), si és un <em>array</em> de 10 LEDs. Per tant, podria col·locar-se amb un sòcol DIL20.</p>
<p>En aquest punt és interessant notar l’existència dels <em>arrays</em> de resistències fixes; que, a diferència de la barra de LEDs, en aquest cas es disposa d’un dels dos terminals de les resistències en forma compartida.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/array_resistencies.png" class="img-fluid figure-img"></p>
<figcaption>Array de resistències fixes</figcaption>
</figure>
</div>
<p>Aquests grups de resistències, combinats amb els <em>arrays</em> de LEDs, permeten una reducció molt important de l’espai necessari per als senyalitzadors del nostre circuit.</p>
<p>Quant a les consideracions tècniques referents a tensions i corrents, els paràmetres dels <em>arrays</em> de LEDs solen ser semblants als dels LEDs individuals; de manera que requerirem, novament, resistències limitadores de corrent de valors similars als anteriors.</p>
<p>Les caigudes de tensió necessàries per a fer-los funcionar són les habituals, d’entre 1.7V i 2.2V, segons el tipus de LED que contenen (sobretot depenent del color, perquè els verds normalment requereixen una tensió més alta que els vermells).</p>
<p>La figura següent mostra un circuit de microprocessador amb una barra de LEDs i <em>array</em> de resistències.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/circuit_barra_leds.png" class="img-fluid figure-img"></p>
<figcaption>Circuit amb barra de LEDs</figcaption>
</figure>
</div>
<p>La figura següent mostra com queda una placa de circuit imprès fent servir aquests elements.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/barra_leds_3d.png" class="img-fluid figure-img"></p>
<figcaption>Aprofitament de l’espai amb barres de LED</figcaption>
</figure>
</div>
</section>
<section id="el-led-a-través-de-transistor" class="level2">
<h2 class="anchored" data-anchor-id="el-led-a-través-de-transistor">El LED a través de transistor</h2>
<p>No tots els dispositius electrònics són capaços d’oferir a les seves sortides una intensitat de corrent sortint o entrant elevats. Existeix el cas de dispositius que gairebé no arriben als pocs mil·liampers i que, per tant, són incapaços d’alimentar adequadament LEDs i altres dispositius senyalitzadors de sortida.</p>
<p>També pot donar-se el cas que la suma de tots els corrents generats o absorbits pels diferents terminals del circuit integrat en qüestió és superior al límit recomanat pel fabricant, sobretot relacionant-ho amb la dissipació de potència en el seu interior i el perill que això comporta sobre la longevitat del C.I. mateix.</p>
<p>La solució que sempre tenim disponible és cedir la responsabilitat d’oferir corrent a un altre dispositiu. I el cas més senzill és el simple transistor BJT, ja sigui en configuració NPN com PNP.</p>
<p>Com sabem, un transistor BJT presenta un factor de guany en corrent que segueix l’expressió:</p>
<p><img src="https://latex.codecogs.com/png.latex?I_C=%5Cbeta_F%5Ccdot%20I_B"></p>
<p>El paràmetre de guany de col·lector, <img src="https://latex.codecogs.com/png.latex?%5Cbeta_F"> es pot trobar també escrit com a <img src="https://latex.codecogs.com/png.latex?h_%7Bfe%7D">, corresponent al mateix paràmetre en tots dos casos.</p>
<p>Així doncs, en termes generals, el que ens interessa és aplicar el transistor de manera que el corrent de col·lector sigui el necessari per a fer funcionar el dispositiu que hi posem; i a la vegada, fer que el mateix transistor es quedi amb el mínim potencial aplicat entre col·lector i emissor, de manera que la seva dissipació d’energia sigui la mínima possible. A aquest punt de treball dels transistors se l’anomena <strong>saturació</strong>.</p>
<p>De manera similar, quan el transistor no ha de conduir, ha de quedar-se amb tot el potencial disponible, fent que el corrent sigui exactament zero. A aquest punt de treball dels transistors se l’anomena <strong>tall</strong>.</p>
<p>Commutar a un transistor de tall a saturació serà possible amb configuracions com les mostrades aquí:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/configuracions_transistor.png" class="img-fluid figure-img"></p>
<figcaption>Configuracions amb transistor NPN(esquerra) i PNP(dreta)</figcaption>
</figure>
</div>
<p>Quant als càlculs necessaris per a ajustar les resistències que hi són presents, prendrem el cas NPN (el PNP és exactament igual, canviant “1” per “0” i viceversa).</p>
<p>En primer lloc volem que quan el transistor estigui en tall, aquest no provoqui el pas de corrent. Això ja ho aconsegueix la configuració mostrada.</p>
<p>En segon lloc, volem que quan el transistor condueixi (activem el LED des de l’entrada aplicant un “1” a la resistència del terminal de base del transistor), aleshores ho faci en saturació. La saturació consisteix en una mínima caiguda de potencial entre col·lector i emissor. El valor habitual és de 0.2V.</p>
<p>Si el circuit està en saturació, quedaran disponibles per al LED i la resistència de col·lector un total de: <img src="https://latex.codecogs.com/png.latex?5V-0.2V=4.8V"></p>
<p>(Estem considerant una alimentació de 5V).</p>
<p>De la mateixa manera, el LED mateix necessitarà 1.7V per encendre’s, de manera que la caiguda de potencial desitjat a la resistència quedarà reduïda a:</p>
<p><img src="https://latex.codecogs.com/png.latex?%204.8V-1.7V=3.1V%20"></p>
<p>Si volem que el LED s’encengui amb uns 15mA de corrent (lluminositat mitja-alta), aleshores necessitem una resistència de col·lector de:</p>
<p><img src="https://latex.codecogs.com/png.latex?R_C=%5Cfrac%7B3.1%7D%7B0.015%7D=206.%5Cwidehat%7B6%7D%5Capprox%20220%5COmega"></p>
<p>Per tant, el corrent real que en resultarà serà de:</p>
<p><img src="https://latex.codecogs.com/png.latex?I_C=%5Cfrac%7B3.1%7D%7B220%7D=0.0141=14.1mA"></p>
<p>Si treballem amb un transistor NPN de guany <img src="https://latex.codecogs.com/png.latex?h_%7Bfe%7D=100"> (els transistors presenten guanys com aquest o superiors), aleshores el corrent de base que ha d’existir serà de:</p>
<p><img src="https://latex.codecogs.com/png.latex?I_B=%5Cfrac%7BI_C%7D%7Bh_%7Bfe%7D%7D=%5Cfrac%7B0.0141%7D%7B100%7D=0.000141=0.141mA"></p>
<p>En la base del transistor, aquest sempre es quedarà amb una tensió de 0.7V per l’efecte díode present entre base i emissor. Així doncs, la resistència de la base presentarà una caiguda de tensió de</p>
<p><img src="https://latex.codecogs.com/png.latex?5V-0.7V=4.3V"></p>
<p>(Considerant que el “1” sigui exactament 5V).</p>
<p>Així doncs, sabem corrent i tensió i, aplicant llei d’Ohm, podem trobar la resistència de base necessària:</p>
<p><img src="https://latex.codecogs.com/png.latex?R_B=%5Cfrac%7B4.3%7D%7B0.000141%7D=30496.45%20%5Capprox%2027k%5COmega"></p>
<p>Observi’s que hem arrodonit cap avall. Això és perquè la saturació s’aconsegueix amb valors més baixos de resistència, no més elevats. Si els dispositius presenten derives dels seus paràmetres, anirem més segurs si utilitzem una resistència més baixa.</p>
<p>Els paràmetres que fan que aquests càlculs no siguin precisos són:</p>
<ul>
<li>La tensió base-emissor no és constant de 0.7V</li>
<li>La tensió que necessita el LED per encendre’s no és sempre 1.7V</li>
<li>La <img src="https://latex.codecogs.com/png.latex?h_%7Bfe%7D"> no és independent de la tensió aplicada i presenta una tolerància elevada</li>
</ul>
<p>Per tot això, cal fer un arrodoniment de la resistència de base, <img src="https://latex.codecogs.com/png.latex?R_B">, cap avall; i així assegurar-nos que s’assoleix saturació o s’està molt aprop.</p>
<p>Si s’observa la característica tècnica d’un transistor real, com el BC547, s’observarà que la seva <img src="https://latex.codecogs.com/png.latex?h_%7Bfe%7D"> pot oscil·lar entre 110 i 800!!! Si considerem <img src="https://latex.codecogs.com/png.latex?h_%7Bfe%7D"> de 110, la resistència de base hauria de ser de 33kΩ, mentre que si considerem que <img src="https://latex.codecogs.com/png.latex?h_%7Bfe%7D"> és 800, la resistència de base hauria de pujar als 240kΩ. Evidentment ens quedaríem amb el cas més baix, el de 33kΩ.</p>
<p>A més, pensi’s que 0.2V entre col·lector i emissor, amb 20mA de corrent, provoquen una dissipació de potència de 4mW. Si ens equivoquem i cauen entre col·lector i emissor més Volts per no trobar-se en saturació, estarem provocant una dissipació de potència molt major, que podria superar el màxim permès pel dispositiu concret triat. Això és molt important en muntatge miniatura superficial (transistors SMD).</p>
</section>
<section id="el-relé" class="level2">
<h2 class="anchored" data-anchor-id="el-relé">El relé</h2>
<p>Un relé és un dispositiu electrònic-mecànic que fa d’interruptor control·lat. Si passa corrent a través de la seva bobina en quantitat suficient, és capaç de tancar un contacte mecànic que activa un altre circuit, totalment independent elèctricament del primer.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/rele.png" class="img-fluid figure-img"></p>
<figcaption>Un relé convencional</figcaption>
</figure>
</div>
<p>Així doncs, amb relés, podem controlar motors de 24V, bombetes de 220V i altres mecanismes simplement des d’un senyal digital tipus “0”/“1” lògic.</p>
<p>Malauradament, un circuit electrònic digital no pot comandar de manera directa la bobina del relé; i necessitem, forçosament, d’un transistor per a proporcionar el corrent requerit.</p>
<p>Com que un relé consta d’una bobina, i aquesta bobina ha de ser capaç de moure el mecanisme del contacte mecànic. Això vol dir que la resistència equivalent de la bobina és d’uns pocs Ohms. A més, la bobina ha de ser alimentat a una tensió que dependrà del model concret de relé que es triï.</p>
<p>Així doncs, podem trobar relés de 12V amb una bobina que presenta una resistència equivalent de 240Ω, per exemple.</p>
<p>Un circuit per a condicionar la sortida digital d’algun circuit electrònic i alimentar adequadament un relé pot ser com el mostrat a la figura següent (de fet, podria construir-se l’equivalent amb transistor PNP)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/circuit_rele.png" class="img-fluid figure-img"></p>
<figcaption>Circuit de control d’un relé</figcaption>
</figure>
</div>
<p>En aquest cas hem de calcular la resistència de base necessària per a fer funcionar el relé, minimitzant la caiguda de tensió entre col·lector i emissor del transistor.</p>
<p>A continuació es mostren els càlculs per a un relé de 12V, 240Ω, amb transistor BC547.</p>
<p>Si el transistor ha d’estar en saturació, aleshores el corrent de col·lector ha de ser:</p>
<p><img src="https://latex.codecogs.com/png.latex?I_C=%5Cfrac%7B12-0.2%7D%7B240%7D=0.04917=49.17mA"></p>
<p>Assumint una <img src="https://latex.codecogs.com/png.latex?h_%7Bfe%7D"> del transistor de 100, aleshores el corrent de base haurà de ser:</p>
<p><img src="https://latex.codecogs.com/png.latex?I_B=%5Cfrac%7BI_C%7D%7Bh_%7Bfe%7D%7D=0.04917/100=0.0004917%20=%200.4917mA"></p>
<p>Com que en el terminal de base el senyal digital considerem que és de 5V per a codificar un “1” lògic, aleshores, tenint present la caiguda de 0.7V a la base del transistor, tindrem:</p>
<p><img src="https://latex.codecogs.com/png.latex?R_C=%5Cfrac%7B5-0.7%7D%7B0.0004917%7D=8745.17%5Capprox%208k2%5COmega"></p>
<p>Això vol dir que necessitarem una resistència a la base del transistor d’uns 8k2Ω.</p>
<p>Evidentment, succeeix el que es comentava amb els LEDs: els transistors presenten guanys no constants, de la mateixa manera que els 0.7V de base són un valor mitjà.</p>
<p>També s’haurà observat el díode col·locat en polarització inversa en paral·lel amb el relé. Aquest díode és imprescindible perquè protegeix el transistor i l’alimentació dels pics provocats per la commutació de la bobina del relé. No oblidem que es tracta d’una bobina i el seu efecte sobre el circuit pot ser destructiu des del punt de vista de contaminar els senyals. El díode anul·la aquests espuris, protegint transistor, circuits lògics i alimentació global.</p>
</section>
<section id="els-leds-multiplexats" class="level2">
<h2 class="anchored" data-anchor-id="els-leds-multiplexats">Els LEDs multiplexats</h2>
<p>En un circuit complex, amb molts LEDs que puguin estar encesos a la vegada, ens podem trobar amb la limitació que el consum global de tots els LEDs és excessiu, o pot arribar a ser-ho en cas que tots ells s’encenguin. Això provoca que el circuit que els ha d’alimentar hagi d’estar preparat per a suportar una dissipació de potència elevada.</p>
<p>No obstant això, els LEDs són indicadors per a l’ull humà, i aquest últim presenta una limitació que ens afavoreix, i és que si un LED està encenent-se i apagant-se a una freqüència superior als 50Hz, l’ull considera que està permanentment encès. A això se li diu “<strong>persistència de la visió</strong>”, i és un fenomen conegut i estudiat en extrem.</p>
<p>Podem aprofitar aquest fet, de manera que només un o uns pocs LEDs estiguin encesos a la vegada i la resta apagats, i fer un recorregut per tots els LEDs, de manera que la freqüència total (corresponent al recorregut per tots els LEDs) sigui superior a aquests 50Hz.</p>
</section>
<section id="un-a-un" class="level2">
<h2 class="anchored" data-anchor-id="un-a-un">Un a un</h2>
<p>Un circuit que podria explotar la característica esmentada fins ara, de manera individual per a cada LED, seria el de la figura següent:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/circuit_16leds.png" class="img-fluid figure-img"></p>
<figcaption>Un circuit amb 16 LEDs</figcaption>
</figure>
</div>
<p>Considerant els 16 LEDs del circuit mostrat anteriorment, podríem fer el cronograma corresponent a la representació de la combinació “<code>1110 1011 1001 1011</code>”, on el bit mostrat primer és el del LED numerat <code>D1</code>; i on “1” representa “LED encès”, perquè en el circuit s’encén el LED per nivell baix. Això és mostrat a la figura següent:</p>
<!--
\pspicture(12,8)
%\psgrid[gridcolor=orange,subgridcolor=yellow]
\multido{\na=0.25+0.50,\nb=16+-1}{16}{\rput(0.5,\na){D\nb} \rput(1.3,\na){\ldots} \rput(11.2,\na){\ldots}}
\psline(1.5,7.9)(1.5,7.6)(2.0,7.6)(2.0,7.9)(9.5,7.9)(9.5,7.6)(10.0,7.6)(10.0,7.9)(11.0,7.9)
\psline(1.5,7.4)(2.0,7.4)(2.0,7.1)(2.5,7.1)(2.5,7.4)(10.0,7.4)(10.0,7.1)(10.5,7.1)(10.5,7.4)(11.0,7.4)
\psline(1.5,6.9)(2.5,6.9)(2.5,6.6)(3.0,6.6)(3.0,6.9)(10.5,6.9)(10.5,6.6)(11.0,6.6)(11.0,6.9)
\psline(1.5,6.4)(11.0,6.4)
\psline(1.5,5.9)(3.5,5.9)(3.5,5.6)(4.0,5.6)(4.0,5.9)(11.0,5.9)
\psline(1.5,5.4)(11.0,5.4)
\psline(1.5,4.9)(4.5,4.9)(4.5,4.6)(5.0,4.6)(5.0,4.9)(11.0,4.9)
\psline(1.5,4.4)(5.0,4.4)(5.0,4.1)(5.5,4.1)(5.5,4.4)(11.0,4.4)
\psline(1.5,3.9)(5.5,3.9)(5.5,3.6)(6.0,3.6)(6.0,3.9)(11.0,3.9)
\psline(1.5,3.4)(11.0,3.4)
\psline(1.5,2.9)(11.0,2.9)
\psline(1.5,2.4)(7.0,2.4)(7.0,2.1)(7.5,2.1)(7.5,2.4)(11.0,2.4)
\psline(1.5,1.9)(7.5,1.9)(7.5,1.6)(8.0,1.6)(8.0,1.9)(11.0,1.9)
\psline(1.5,1.4)(11.0,1.4)
\psline(1.5,0.9)(8.5,0.9)(8.5,0.6)(9.0,0.6)(9.0,0.9)(11.0,0.9)
\psline(1.5,0.4)(9.0,0.4)(9.0,0.1)(9.5,0.1)(9.5,0.4)(11.0,0.4)
\psline[linestyle=dashed](1.5,0)(1.5,8)
\psline[linestyle=dashed](9.5,0)(9.5,8)
\endpspicture
-->
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/crono_16leds.png" class="img-fluid figure-img"></p>
<figcaption>Cronograma de 16 LEDs multiplexats mostrant “1110 1011 1001 1011”</figcaption>
</figure>
</div>
<p>La contrapartida és que, com cada LED individual estarà apagat durant un temps (el temps que s’estigui tractant la resta de LEDs), aquest presentarà una nivell de lluminositat més baix. En funció de la relació entre el temps encès i el temps apagat, tindrem un nivell de llum efectiu determinat.</p>
<p>Podem veure això també com un “<em>duty cicle</em>” si mirem el senyal que afecta a cada LED.</p>
<p>Si observem el LED <code>D1</code>, aquest estarà encès (si ho ha d’estar) només 1/16 del temps. Això vol dir que el <strong>nivell de lluminositat efectiva</strong> (en mitjana) és una setzena part de la que presentaria si estigués alimentat contínuament durant tot el temps. Passarà el mateix amb qualsevol altre LED que hagi de mostrar-se encès.</p>
<p>Aquesta reducció de lluminositat efectiva del LED pot contrarestar-se reduint la resistència limitadora del LED. En comptes de 220Ω, podríem posar una resistència 16 vegades menor (uns 13.75Ω) o, fins i tot, traient les resistències limitadores!</p>
<p>I és que en alguns circuits, on la reducció de lluminositat efectiva és molt gran, s’eliminen les resistències limitadores i es treballa sota el supòsit que el mateix dispositiu de sortida digital tindrà algun tipus de limitació de corrent sortint. Per exemple, que limiti a 50mA per terminal. Aleshores, el LED s’encendrà durant 1/16 del temps a un nivell de lluminositat de 50mA, cosa que equivaldria a un nivell de lluminositat efectiu d’uns 3.125mA.</p>
</section>
<section id="en-agrupacions" class="level2">
<h2 class="anchored" data-anchor-id="en-agrupacions">En agrupacions</h2>
<p>Com que una reducció de 1/16 pot ser massa forta en alguns LEDs de poca lluminositat, es pot optar per agrupar els LEDs en grups d’unes poques unitats.</p>
<p>Suposem que triem una mida de grup de 4. Aleshores els LEDs s’encendran de 4 en 4 i, globalment el temps de cicle és reduirà en una quarta part. El nivell de lluminositat efectiu serà doncs de només 1/4.</p>
<p>Per fer això hem de controlar quin grup de LEDs pot estar encès o no, i per tant necessitem que l’alimentació ja no sigui directament la de la font d’alimentació. Requerim ara un transistor controlat per un terminal que alimenti al grup individual que s’ha d’encendre.</p>
<p>La figura següent mostra una possible solució a l’esmentat aquí.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/multiplex4x4.png" class="img-fluid figure-img"></p>
<figcaption>Circuit multiplexat amb grups de 4 LEDs</figcaption>
</figure>
</div>
<p>Si s’observa aquest disseny, individualment cada LED està controlat per dos terminals del microprocessador: El terminal de grup (per exemple, <code>G2</code>), i el terminal de LED dins del grup (per exemple, <code>L3</code>). Així doncs, per a encendre un LED determinat hem de donar tensió baixa (un “0”) als dos terminals que adrecen el LED concret.</p>
<p>El motiu del transistor és el de seleccionar el grup que volem adreçar, activant el grup amb un “0” en el terminal de control apropiat; mantenint a “1” la resta, evidentment.</p>
<p>Amb un grup activat, podem seleccionar la combinació de LEDs d’aquell grup que volem encendre, posant a nivell baix els terminals corresponents <code>L1</code>, <code>L2</code>, <code>L3</code> i <code>L4</code>. Això permet activar els quatre LEDs simultàniament si es desitgés.</p>
<p>La figura següent mostra com s’encendrien els 16 LEDs en aquesta disposició per a mostrar la combinació de “<code>1110 1011 1001 1011</code>”. De nou, un “1” indica “LED encès”. Això en aquest circuit es tradueix en una combinació determinada de nivells baixos en els terminals de selecció de grup i LED individual.</p>
<!--
\pspicture(11.5,4)
%\psgrid[gridcolor=orange,subgridcolor=yellow]
\multido{\na=0.25+0.50,\nb=4+-1}{4}{\rput(0.5,\na){L\nb}}
\multido{\na=2.25+0.50,\nb=4+-1}{4}{\rput(0.5,\na){G\nb}}
\multido{\na=0.25+0.50,\nb=4+-1}{8}{\rput(1.3,\na){\ldots} \rput(10.7,\na){\ldots}}
\psline(1.5,3.9)(1.5,3.9)(1.5,3.6)(2.5,3.6)(2.5,3.9)(5.5,3.9)(5.5,3.6)(6.5,3.6)(6.5,3.9)(9.5,3.9)(9.5,3.6)(10.5,3.6)(10.5,3.9)
\psline(1.5,3.4)(2.5,3.4)(2.5,3.1)(3.5,3.1)(3.5,3.4)(6.5,3.4)(6.5,3.1)(7.5,3.1)(7.5,3.4)(10.5,3.4)
\psline(1.5,2.9)(3.5,2.9)(3.5,2.6)(4.5,2.6)(4.5,2.9)(7.5,2.9)(7.5,2.6)(8.5,2.6)(8.5,2.9)(10.5,2.9)
\psline(1.5,2.4)(4.5,2.4)(4.5,2.1)(5.5,2.1)(5.5,2.4)(8.5,2.4)(8.5,2.1)(9.5,2.1)(9.5,2.4)(10.5,2.4)

\psline(1.5,1.6)(10.5,1.6)
\psline(1.5,1.4)(1.5,1.1)(2.5,1.1)(2.5,1.4)(5.5,1.4)(5.5,1.1)(6.5,1.1)(6.5,1.4)(9.5,1.4)(9.5,1.1)(10.5,1.1)(10.5,1.4)
\psline(1.5,0.9)(1.5,0.6)(3.5,0.6)(3.5,0.9)(4.5,0.9)(4.5,0.6)(4.5,0.6)(7.5,0.6)(7.5,0.9)(8.5,0.9)(8.5,0.6)(10.5,0.6)
\psline(1.5,0.4)(2.5,0.4)(2.5,0.1)(5.5,0.1)(5.5,0.4)(6.5,0.4)(6.5,0.1)(9.5,0.1)(9.5,0.4)(10.5,0.4)(10.5,0.1)
\psline[linestyle=dashed](1.5,0)(1.5,4)
\psline[linestyle=dotted](2.5,0)(2.5,4)
\psline[linestyle=dotted](3.5,0)(3.5,4)
\psline[linestyle=dotted](4.5,0)(4.5,4)
\psline[linestyle=dashed](5.5,0)(5.5,4)
\psline[linestyle=dotted](6.5,0)(6.5,4)
\psline[linestyle=dotted](7.5,0)(7.5,4)
\psline[linestyle=dotted](8.5,0)(8.5,4)
\psline[linestyle=dashed](9.5,0)(9.5,4)
\endpspicture
-->
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/crono_16leds_grups4.png" class="img-fluid figure-img"></p>
<figcaption>Cronograma de 16 LEDs multiplexats en grups de 4 mostrant “1110 1011 1001 1011”</figcaption>
</figure>
</div>
<p>Lògicament el corrent que passa per cada transistor variarà en funció de la combinació de LEDs que s’encenen, des de cap LED (0mA) fins a 4 LEDs (4 vegades la intensitat que defineixen les resistències limitadores).</p>
<p>En aquest cas concret, amb els dispositius mostrats, el corrent que passa per cada LED, quan s’encén, és d’uns 15mA, aproximadament.</p>
<p>El corrent, en termes reals, variarà en funció de la combinació, però d’una manera lleugera (1mA de diferència entre 1 LED i 4 LEDs, per al cas mostrat).</p>
<p>A més, el microprocessador hauria de ser capaç de donar individualment els 15mA per cadascun dels 4 terminals que adrecen els LEDs, i uns 1.5mA per al terminal d’activació de grup. A més, no s’ha de superar el límit global amb el corrent total, que en aquest cas seria de 4 vegades 15mA més els 1.5mA, és a dir, uns 62mA.</p>
</section>
<section id="leds-i-registres" class="level2">
<h2 class="anchored" data-anchor-id="leds-i-registres">LEDs i registres</h2>
<p>Una manera de reduir el consum de corrent del microprocessador i traspassar-lo a algun altre dispositiu podria ser tenir registres lògics que emmagatzemin la seqüència de LEDs que s’ha de mostrar. Podríem fer una construcció com la mostrada a la figura aquí:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/circuit_16leds_registres.png" class="img-fluid figure-img"></p>
<figcaption>Circuit amb 16 LEDs a través de registres</figcaption>
</figure>
</div>
<p>Es pot observar que la càrrega dels registres fa que en el microprocessador només fem servir 3 terminals: Un per a la dada, un altre per al rellotge, i un altre per a controlar el <em>reset</em> dels registres.</p>
<p>Els registres, per la seva part, estan encadenats en cascada. La sortida de major pes (<code>Q7</code>) del primer element (<code>U1</code>) està disposada com a entrada de dades del següent element de registre (<code>U2</code>).</p>
<p>També és important notar que en aquest sistema tots els LEDs poden estar il·luminats. Això provocaria un elevat consum que, potser, el circuit integrat de registres no podria tolerar. Pensem que 8 LEDs a 20mA genera un consum total de 160mA…</p>
<p>Per evitar aquest problema podem triar un circuit integrat que faci la funció de “<em>driver</em>” de corrent. Aquest es veu en la forma de <code>U4</code> i <code>U5</code> en el circuit de la figura anterior, i és el circuit integrat ULN2803. Aquest circuit consta de 8 transistors NPN en configuració Darlington i és ideal per a aquest tipus de configuracions.</p>
<p>El circuit integrat ULN2803 serà l’encarregat de lliurar als LEDs tot el corrent que demanin, i tot segons el senyal lògic present als terminals d’entrada (que són les sortides del registre de desplaçament).</p>
<p>La figura següent mostra el cronograma associat a aquest circuit per a mostrar la seqüència binària “<code>1110 1011 1001 1011</code>”.</p>
<!--
\pspicture(11.5,1.5)
%\psgrid[gridcolor=orange,subgridcolor=yellow]
\rput(0.5,0.25){CLR} \rput(1.3,0.25){\ldots} \rput(10.7,0.25){\ldots}
\rput(0.5,0.75){CLK} \rput(1.3,0.75){\ldots} \rput(10.7,0.75){\ldots}
\rput(0.5,1.25){DATA} \rput(1.3,1.25){\ldots} \rput(10.7,1.25){\ldots}
\multido{\na=1.5+0.5,\nb=1.75+0.50,\nc=2.0+0.5}{18}{\psline(\na,0.6)(\nb,0.6)(\nb,0.9)(\nc,0.9)(\nc,0.6)}

\psline(1.5,1.4)(1.5,1.1)(2.5,1.1)(2.5,1.4)(3,1.4)(3,1.1)(4,1.1)(4,1.4)(5,1.4)(5,1.1)(6.5,1.1)(6.5,1.4)(7,1.4)(7,1.1)(7.5,1.1)(7.5,1.4)(8,1.4)(8,1.1)(10.5,1.1)
\psline(1.5,0.4)(1.5,0.1)(1.6,0.1)(1.6,0.4)(9.5,0.4)(9.5,0.1)(9.6,0.1)(9.6,0.4)(10.5,0.4)
\psline[linestyle=dashed](1.5,0)(1.5,1.5)
\multido{\na=1.5+0.5}{19}{\psline[linestyle=dotted](\na,0)(\na,1.5)}
\psline[linestyle=dashed](9.5,0)(9.5,1.5)
\endpspicture
-->
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/crono_16leds_drivers.png" class="img-fluid figure-img"></p>
<figcaption>Cronograma de 16 LEDs amb registres i drivers mostrant “1110 1011 1001 1011”</figcaption>
</figure>
</div>
<p>Noti’s que el CLR és enviat a l’inici de cada bloc d’actualització, però que en realitat seria millor no fer-lo servir. En aquest cas el registre de desplaçament 74164 fa el <em>reset</em> amb zeros; i això provocaria que, durant un breu període de temps, tots els LEDs estarien encesos.</p>
<p>Podríem invertir aquesta situació fent que els LEDs s’encenguessin per “1”, disposant el terminal comú del <em>pack</em> de resistències a GND, i canviant la polaritat dels LEDs. Malauradament, això és impracticable si volem fer servir el circuit integrat ULN2803, perquè es tracta d’un grup de 8 Darlington tipus NPN. Hauríem de substituir-lo també per un circuit integrat Darlington però de tipus PNP.</p>
</section>
<section id="la-tècnica-del-charlieplexing" class="level2">
<h2 class="anchored" data-anchor-id="la-tècnica-del-charlieplexing">La tècnica del <em>charlieplexing</em></h2>
<p>En el cas de sistemes amb una quantitat de terminals reduït, on la mida del circuit és important, podem optar per tècniques addicionals que milloren tot això.</p>
<p>Fins ara s’ha vist que:</p>
<ul>
<li>Fer servir <strong>multiplexació</strong> presenta un important avantatge: La quantitat de terminals utilitzats es redueix enormement, però no a un extrem mínim.</li>
<li>Sí és mínim, si fem servir <strong>registres</strong>; però el consum és constant i força elevat amb, en algun cas, tots els LEDs encesos a la vegada.</li>
<li>La multiplexació redueix l’<strong>índex de lluminositat</strong> en funció de la quantitat de LEDs que simultàniament s’encenen.</li>
</ul>
<p>Ens interessaria un sistema que permeti la multiplexació per l’avantatge que suposa en termes de consum d’energia, però amb la reducció màxima de terminals. Amb, evidentment, el cicle més curt possible per aprofitar el màxim d’il·luminació.</p>
<p>Això és possible si estudiem com funciona el LED i com podem alimentar-lo.</p>
<p>Suposem en primer lloc, dos LEDs disposats en paral·lel i amb polaritats invertides. Això es mostra a la figura següent.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/charlieplex2.png" class="img-fluid figure-img"></p>
<figcaption>Charlieplexing amb 2 terminals</figcaption>
</figure>
</div>
<p>Si cada extrem l’alimentem des d’un terminal del microprocessador, podem optar per les següents combinacions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>T1</strong></th>
<th><strong>T2</strong></th>
<th><strong>Led 1</strong></th>
<th><strong>Led 2</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>Apagat</td>
<td>Apagat</td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td><strong>Encès</strong></td>
<td>Apagat</td>
</tr>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>Apagat</td>
<td><strong>Encès</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>Apagat</td>
<td>Apagat</td>
</tr>
</tbody>
</table>
<p>Com es veu, les resistències en sèrie amb els terminals del microprocessador permeten limitar el corrent que passa a través dels LEDs.</p>
<p>Que, amb dos terminals, alimentem dos LEDs no sembla gaire engrescador, però analitzant el cas de 3 terminals, la cosa canvia. La figura següent mostra una configuració de 6 LEDs controlats per només tres terminals.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/charlieplex3.png" class="img-fluid figure-img"></p>
<figcaption>Charlieplexing amb 3 terminals</figcaption>
</figure>
</div>
<p>La taula següent recull com s’haurà d’alimentar cada terminal per a aconseguir les diferents combinacions d’encesa de LEDs:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th><strong>T1</strong></th>
<th><strong>T2</strong></th>
<th><strong>T3</strong></th>
<th><strong>Led 1</strong></th>
<th><strong>Led 2</strong></th>
<th><strong>Led 3</strong></th>
<th><strong>Led 4</strong></th>
<th><strong>Led 5</strong></th>
<th><strong>Led 6</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>Z</td>
<td><strong>Encès</strong></td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>Z</td>
<td>Apagat</td>
<td><strong>Encès</strong></td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
</tr>
<tr class="odd">
<td>Z</td>
<td>1</td>
<td>0</td>
<td>Apagat</td>
<td>Apagat</td>
<td><strong>Encès</strong></td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
</tr>
<tr class="even">
<td>Z</td>
<td>0</td>
<td>1</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td><strong>Encès</strong></td>
<td>Apagat</td>
<td>Apagat</td>
</tr>
<tr class="odd">
<td>1</td>
<td>Z</td>
<td>0</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td><strong>Encès</strong></td>
<td>Apagat</td>
</tr>
<tr class="even">
<td>0</td>
<td>Z</td>
<td>1</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td><strong>Encès</strong></td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
<td>Apagat</td>
</tr>
</tbody>
</table>
<p>Observi’s que s’ha tingut en compte la possibilitat de què el microprocessador sigui capaç d’emetre un estat d’alta impedància a les seves sortides.</p>
<p>La figura següent mostra la situació amb 4 terminals, que permet disposar de 12 LEDs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/charlieplex4.png" class="img-fluid figure-img"></p>
<figcaption>Charlieplexing amb 4 terminals</figcaption>
</figure>
</div>
<p>En general, per a <img src="https://latex.codecogs.com/png.latex?n"> terminals en el microprocessador, s’obté la possibilitat d’adreçar <img src="https://latex.codecogs.com/png.latex?n%5Ccdot(n-1)"> LEDs.</p>
<p><img src="https://latex.codecogs.com/png.latex?%20%20n%5Ctextrm%7B%20terminals%7D%20%5CLongrightarrow%20n%5Ccdot%20(n-1)%20%5Ctextrm%7B%20LEDs%7D%20%20"></p>
<p>Així, amb només 10 terminals podrem adreçar un total de 90 LEDs, per exemple.</p>
<p>Aquests totals, fora de sorprendre’ns per veure com augmenta la quantitat de LEDs de manera increïble, ens porta a una problemàtica associada; i és que la tècnica per a adreçar aquests LEDs no deixa de ser com una multiplexació i, per tant, patirem una reducció d’il·luminació important. Haurem de triar una freqüència alta d’actualització per a recórrer, un a un, tots i cadascun dels LEDs, i fer que el període complet d’escombrat sigui suficientment alt com per a donar la sensació de persistència de la visió.</p>
<p>No s’ha d’oblidar que, per a multiplexar una gran quantitat de LEDs, aquests romandran gran part del temps apagats; i per tant, el nivell d’il·luminació serà molt baix. Podem compensar-ho també augmentant el corrent per LED, i això pot portar-nos a anular-la directament. Això no és perillós, perquè el temps d’encesa del LED és baix i el que importa és el consum mitjà. A més, el consum del dispositiu que proporciona el senyal estarà control·lat pels seus propis mecanismes interns de protecció. Molts dispositius no poden proporcionar més de 25mA en els seus terminals gràcies als dispositius limitadors que incorporen.</p>
<p>Un exemple d’aplicació de la tècnica de <em>charlieplexing</em> pot ser la construcció d’un rellotge amb LEDs disposats circularment, consistent en:</p>
<ul>
<li>60 LEDs per a indicar els minuts. Els LEDs es poden tenir encesos tots des del 0, o només aquell que sigui el del minut actual.</li>
<li>12 LEDs bicolor per a indicar les hores. Un color servirà per indicar l’hora actual, mentre que l’altre serà sempre encès per a indicar on estan les marques quan s’estigui amb poca llum ambiental.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/charlieclock_layout.png" class="img-fluid figure-img"></p>
<figcaption>Layout d’un rellotge amb charlieplexing</figcaption>
</figure>
</div>
<p>Això comporta que s’han de controlar, en realitat, 84 LEDs (60+12+12). Podem dividir aquest total en dues meitats, per a millorar la persistència de visió i augmentar la il·luminació resultant, a més de simplificar el <em>layout</em> del circuit.</p>
<p>Amb dos grups de 42 LEDs necessitarem 7 terminals per a cada grup. O sigui, un total de 14 terminals de microprocessador (dos grups independents de 7 terminals).</p>
<p>Això és el mostrat a la figura anterior (<em>layout</em>); i la vista 3D resultant a les figures següents:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/charlieclock_3d_components.png" class="img-fluid figure-img"></p>
<figcaption>Vista 3D d’un rellotge amb charlieplexing (cara components)</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/charlieclock_3d_pistes.png" class="img-fluid figure-img"></p>
<figcaption>Vista 3D d’un rellotge amb charlieplexing (cara pistes)</figcaption>
</figure>
</div>
<p>… continuarà …</p>


</section>

 ]]></description>
  <category>Electrònica</category>
  <category>sortida</category>
  <category>LED</category>
  <category>multiplexació</category>
  <category>charlieplexing</category>
  <category>alfanumèric</category>
  <category>transistor</category>
  <category>relé</category>
  <category>microprocessador</category>
  <category>microcontrolador</category>
  <category>PIC</category>
  <guid>https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/</guid>
  <pubDate>Thu, 21 Oct 2010 22:00:00 GMT</pubDate>
  <media:content url="https://www.flx.cat/posts/2010-10-22-elements-de-sortida-electronics-1/images/featured.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
